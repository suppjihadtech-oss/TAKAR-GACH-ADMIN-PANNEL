<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ó‡¶æ‡¶õ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® V9.0 (Pro)</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           1. ROOT VARIABLES & GLOBAL STYLES
           ========================================= */
        :root {
            --primary-color: #10b981; 
            --primary-hover: #059669;
            --secondary-color: #3B82F6;
            --accent-color: #F59E0B;
            --danger-color: #EF4444;
            --dark-bg: #1F2937;
            --body-bg: #F3F4F6;
            --card-bg: #FFFFFF;
            --text-main: #111827;
            --text-light: #6B7280;
            --border-color: #E5E7EB;
            --shadow-light: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-medium: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
        }

        * { 
            box-sizing: border-box; 
            outline: none; 
            -webkit-tap-highlight-color: transparent; 
        }

        body { 
            margin: 0; 
            padding: 0;
            background-color: var(--body-bg); 
            font-family: 'Poppins', 'Hind Siliguri', sans-serif; 
            color: var(--text-main); 
            padding-bottom: 100px; 
            user-select: none; 
        }

        /* =========================================
           2. ANIMATIONS & SPLASH SCREEN
           ========================================= */
        #splash-screen { 
            position: fixed; 
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--body-bg); 
            z-index: 9999; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            flex-direction: column; 
        }

        .growing-tree { 
            font-size: 0px; 
            color: var(--primary-color); 
            margin-bottom: 25px; 
            animation: growTreeAnimation 2.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; 
            transform-origin: bottom center; 
            filter: drop-shadow(0 10px 20px rgba(16, 185, 129, 0.4));
        }

        @keyframes growTreeAnimation {
            0% { 
                font-size: 0px; 
                opacity: 0; 
                transform: translateY(50px) scale(0.1); 
            }
            30% { 
                font-size: 40px; 
                opacity: 0.5; 
                transform: translateY(20px) scale(0.5);
            }
            60% { 
                font-size: 70px; 
                opacity: 0.8; 
                transform: translateY(10px) scale(0.8);
            }
            100% { 
                font-size: 100px; 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }

        /* =========================================
           3. AUTHENTICATION VIEW
           ========================================= */
        #auth-view { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background-color: var(--body-bg); 
            z-index: 5000; 
            display: none; 
            justify-content: center; 
            align-items: center; 
            padding: 20px; 
        }

        .login-box { 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(15px); 
            padding: 40px 30px; 
            border-radius: var(--radius-xl); 
            width: 100%; 
            max-width: 380px; 
            text-align: center; 
            box-shadow: var(--shadow-medium); 
            border: 1px solid rgba(255,255,255,0.5); 
        }

        .inp { 
            width: 100%; 
            padding: 16px; 
            margin-bottom: 15px; 
            border: 1.5px solid var(--border-color); 
            border-radius: var(--radius-md); 
            background: #ffffff; 
            font-size: 15px; 
            transition: all 0.3s ease; 
            color: var(--text-main);
        }

        .inp:focus { 
            border-color: var(--primary-color); 
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1); 
        }

        .btn { 
            width: 100%; 
            padding: 16px; 
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover)); 
            color: white; 
            border: none; 
            border-radius: var(--radius-md); 
            font-weight: 700; 
            font-size: 16px; 
            cursor: pointer; 
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3); 
            transition: transform 0.2s, box-shadow 0.2s; 
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:active { 
            transform: scale(0.98); 
            box-shadow: 0 2px 5px rgba(16, 185, 129, 0.2);
        }

        /* =========================================
           4. MAIN DASHBOARD LAYOUT
           ========================================= */
        .header { 
            position: sticky; 
            top: 0; 
            background: linear-gradient(135deg, var(--primary-color), var(--dark-bg)); 
            padding: 25px 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            color: white; 
            border-radius: 0 0 30px 30px; 
            z-index: 100; 
            box-shadow: var(--shadow-medium); 
            margin-bottom: 25px; 
        }

        .header h2 { 
            margin: 0; 
            font-size: 22px; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            font-weight: 700;
        }

        .content-area { 
            padding: 0 20px; 
            display: none; 
            animation: slideUpFade 0.5s ease forwards; 
        }

        .content-area.active { 
            display: block; 
        }

        @keyframes slideUpFade { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        /* =========================================
           5. DASHBOARD WIDGETS
           ========================================= */
        .stat-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 15px; 
            margin-bottom: 25px; 
        }

        .stat-box { 
            background: var(--card-bg); 
            padding: 20px; 
            border-radius: var(--radius-lg); 
            text-align: center; 
            box-shadow: var(--shadow-light); 
            position: relative; 
            overflow: hidden; 
            border: 1px solid rgba(0,0,0,0.02);
        }

        .stat-box h1 { 
            margin: 8px 0; 
            font-size: 24px; 
            color: var(--text-main); 
            font-weight: 800; 
        }

        .stat-box p { 
            margin: 0; 
            font-size: 11px; 
            color: var(--text-light); 
            font-weight: 700; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
        }

        /* MENU GRID */
        .menu-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 12px; 
            margin-bottom: 30px; 
        }

        .menu-btn { 
            background: var(--card-bg); 
            border-radius: var(--radius-lg); 
            padding: 15px 5px; 
            text-align: center; 
            cursor: pointer; 
            transition: all 0.2s ease; 
            box-shadow: var(--shadow-light); 
            border: 1px solid var(--border-color); 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 95px;
        }

        .menu-btn:active { 
            transform: scale(0.95); 
            border-color: var(--primary-color); 
            background: #ECFDF5; 
        }

        .menu-btn i { 
            font-size: 26px; 
            margin-bottom: 10px; 
            display: block;
        }

        .menu-btn span { 
            font-size: 10px; 
            font-weight: 700; 
            color: var(--text-light); 
        }

        /* CARD STYLES */
        .card { 
            background: var(--card-bg); 
            border-radius: var(--radius-lg); 
            padding: 20px; 
            margin-bottom: 15px; 
            box-shadow: var(--shadow-light); 
            border: 1px solid var(--border-color); 
        }

        /* =========================================
           6. LIST ITEMS & BUTTONS
           ========================================= */
        .list-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 15px; 
            background: #FFFFFF; 
            border-radius: var(--radius-md); 
            margin-bottom: 10px; 
            border: 1px solid var(--border-color); 
            box-shadow: 0 2px 5px rgba(0,0,0,0.02); 
            transition: background 0.2s;
        }
        
        .list-item:hover {
            background: #F9FAFB;
        }

        .btn-sm { 
            padding: 8px 14px; 
            border-radius: 8px; 
            font-size: 12px; 
            border: none; 
            color: white; 
            cursor: pointer; 
            margin-left: 5px; 
            font-weight: 600; 
            transition: 0.2s;
        }
        
        .btn-sm:active { transform: scale(0.9); }

        /* BADGES */
        .badge { 
            padding: 4px 10px; 
            border-radius: 20px; 
            font-size: 10px; 
            font-weight: 700; 
            text-transform: uppercase; 
            display: inline-block;
        }
        .badge-vip { background: var(--accent-color); color: white; } 
        .badge-success { background: #D1FAE5; color: #059669; } 
        .badge-reject { background: #FEE2E2; color: #DC2626; }

        /* =========================================
           7. TOGGLE SWITCH & NAV
           ========================================= */
        .switch { 
            position: relative; 
            display: inline-block; 
            width: 52px; 
            height: 28px; 
        }
        
        .switch input { opacity: 0; width: 0; height: 0; }
        
        .slider { 
            position: absolute; 
            cursor: pointer; 
            top: 0; left: 0; right: 0; bottom: 0; 
            background-color: #E5E7EB; 
            transition: .4s; 
            border-radius: 34px; 
        }
        
        .slider:before { 
            position: absolute; 
            content: ""; 
            height: 22px; width: 22px; 
            left: 3px; bottom: 3px; 
            background-color: white; 
            transition: .4s; 
            border-radius: 50%; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(24px); }
        .switch-red input:checked + .slider { background-color: var(--danger-color); }

        /* BOTTOM NAV */
        .bottom-nav { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            width: 100%; 
            background: rgba(255,255,255,0.98); 
            padding: 12px 20px; 
            display: flex; 
            justify-content: space-around; 
            z-index: 1000; 
            backdrop-filter: blur(15px); 
            border-radius: 25px 25px 0 0; 
            box-shadow: 0 -5px 25px rgba(0,0,0,0.08); 
            border-top: 1px solid rgba(0,0,0,0.05);
        }

        .nav-item { 
            text-align: center; 
            color: var(--text-light); 
            cursor: pointer; 
            transition: 0.3s; 
            position: relative; 
            width: 60px;
        }

        .nav-item i { 
            font-size: 24px; 
            margin-bottom: 5px; 
            display: block; 
        }
        
        .nav-item span { font-size: 10px; font-weight: 700; }
        .nav-item.active { color: var(--primary-color); transform: translateY(-5px); }
        
        .nav-badge { 
            position: absolute; 
            top: -8px; 
            right: -5px; 
            background: var(--danger-color); 
            color: white; 
            font-size: 10px; 
            padding: 3px 7px; 
            border-radius: 10px; 
            font-weight: bold; 
            border: 2px solid white; 
        }

        /* =========================================
           8. MODAL WINDOWS
           ========================================= */
        .modal { 
            position: fixed; 
            inset: 0; 
            background: rgba(0,0,0,0.7); 
            backdrop-filter: blur(5px); 
            z-index: 9999; 
            display: none; 
            justify-content: center; 
            align-items: center; 
            padding: 20px; 
        }

        .modal-box { 
            background: white; 
            width: 100%; 
            max-width: 400px; 
            padding: 30px; 
            border-radius: 24px; 
            box-shadow: 0 25px 50px rgba(0,0,0,0.3); 
            animation: zoomInModal 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            max-height: 85vh; 
            overflow-y: auto; 
        }

        @keyframes zoomInModal { 
            from { transform: scale(0.9); opacity: 0; } 
            to { transform: scale(1); opacity: 1; } 
        }
    </style>
</head>
<body>

    <div id="splash-screen">
        <i class="fas fa-tree growing-tree"></i>
        <h1 style="color:var(--text-main); font-weight:800; margin:0; font-size:32px;">‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ó‡¶æ‡¶õ</h1>
        <small style="color:var(--text-light); font-weight:600; letter-spacing:1px;">Admin Panel V9.0</small>
    </div>

    <div id="auth-view">
        <div class="login-box">
            <div style="width:80px; height:80px; background:#ECFDF5; border-radius:50%; display:flex; justify-content:center; align-items:center; margin:0 auto 20px; font-size:35px; color:var(--primary-color);">
                <i class="fas fa-user-shield"></i>
            </div>
            <h2 style="margin:0 0 25px; color:var(--text-main); font-weight:800;">‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h2>
            <input id="u" class="inp" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ">
            <input id="p" type="password" class="inp" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
            <button class="btn" onclick="login()">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <div id="dashboard" style="display:none">
        
        <div class="header">
            <h2>
                <i class="fas fa-tree" style="color:rgba(255,255,255,0.9)"></i> 
                ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ó‡¶æ‡¶õ
            </h2>
            <div onclick="location.reload()" style="background:rgba(255,255,255,0.2); padding:10px; border-radius:50%; cursor:pointer; width:40px; height:40px; display:flex; justify-content:center; align-items:center;">
                <i class="fas fa-sync-alt"></i>
            </div>
        </div>

        <div id="home-view" class="content-area active">
            <div class="stat-grid">
                <div class="stat-box">
                    <h1 id="total-u">0</h1>
                    <p>‡¶Æ‡ßã‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</p>
                </div>
                <div class="stat-box">
                    <h1 id="total-b" style="color:var(--secondary-color)">‡ß≥0</h1>
                    <p>‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p>
                </div>
                <div class="stat-box">
                    <h1 id="total-dep" style="color:var(--primary-color)">‡ß≥0</h1>
                    <p>‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</p>
                </div>
                <div class="stat-box">
                    <h1 id="total-wd" style="color:var(--danger-color)">‡ß≥0</h1>
                    <p>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</p>
                </div>
            </div>
            
            <div class="card" style="background:linear-gradient(135deg, #1F2937, #000000); color:white; text-align:center; padding:30px; border:none;">
                <p style="margin:0; opacity:0.8; font-size:12px; text-transform:uppercase; letter-spacing:2px; font-weight:700;">Net Profit</p>
                <h1 id="net-profit" style="margin:10px 0; font-size:40px; font-weight:800;">‡ß≥0</h1>
            </div>

            <div class="menu-grid">
                <div class="menu-btn" onclick="nav('users')">
                    <i class="fas fa-users" style="color:var(--secondary-color)"></i>
                    <span>‡¶á‡¶â‡¶ú‡¶æ‡¶∞</span>
                </div>
                <div class="menu-btn" onclick="nav('plans')">
                    <i class="fas fa-crown" style="color:var(--accent-color)"></i>
                    <span>VIP ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®</span>
                </div>
                <div class="menu-btn" onclick="nav('deposits')">
                    <i class="fas fa-arrow-circle-down" style="color:var(--primary-color)"></i>
                    <span>‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</span>
                </div>
                <div class="menu-btn" onclick="nav('withdraws')">
                    <i class="fas fa-arrow-circle-up" style="color:var(--danger-color)"></i>
                    <span>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</span>
                </div>
                <div class="menu-btn" onclick="nav('tasks')">
                    <i class="fas fa-tasks" style="color:#8B5CF6"></i>
                    <span>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</span>
                </div>
                <div class="menu-btn" onclick="nav('job_reqs')">
                    <i class="fas fa-briefcase" style="color:#EC4899"></i>
                    <span>‡¶ú‡¶¨ ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠‡¶æ‡¶≤</span>
                </div>
                <div class="menu-btn" onclick="nav('history')">
                    <i class="fas fa-history" style="color:var(--text-light)"></i>
                    <span>‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø</span>
                </div>
                <div class="menu-btn" onclick="nav('settings')">
                    <i class="fas fa-cog" style="color:var(--text-main)"></i>
                    <span>‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</span>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;">‡¶®‡¶§‡ßÅ‡¶® ‡¶ú‡ßü‡ßá‡¶®‡¶ø‡¶Ç</h3>
                <div id="recent-list"></div>
            </div>
            
            <button class="btn" style="background:var(--danger-color); margin-top:20px; box-shadow:0 5px 15px rgba(239, 68, 68, 0.3);" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> ‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü
            </button>
        </div>

        <div id="dynamic-view" class="content-area">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                <h3 id="page-title" style="margin:0; color:var(--text-main); font-weight:800; font-size:20px;">...</h3>
                <button class="btn-sm" style="background:#374151" onclick="goHome()">
                    <i class="fas fa-arrow-left"></i> ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï
                </button>
            </div>
            <div id="page-content"></div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" onclick="goHome()">
                <i class="fas fa-home"></i>
                <span>‡¶π‡ßã‡¶Æ</span>
            </div>
            <div class="nav-item" onclick="nav('users')">
                <i class="fas fa-users"></i>
                <span>‡¶á‡¶â‡¶ú‡¶æ‡¶∞</span>
            </div>
            <div class="nav-item" onclick="nav('job_reqs')">
                <i class="fas fa-check-circle"></i>
                <span>‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠‡¶æ‡¶≤</span>
                <span id="nav-badge" class="nav-badge" style="display:none">0</span>
            </div>
            <div class="nav-item" onclick="nav('history')">
                <i class="fas fa-history"></i>
                <span>‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø</span>
            </div>
        </div>
    </div>

    <div id="user-modal" class="modal">
        <div class="modal-box">
            <h3 style="margin-top:0; text-align:center;">‡¶è‡¶°‡¶ø‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</h3>
            <input type="hidden" id="e-uid">
            
            <label style="font-size:12px; color:#666; font-weight:600; display:block; margin-bottom:5px;">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</label>
            <input id="e-bal" type="number" class="inp">
            
            <label style="font-size:12px; color:#666; font-weight:600; display:block; margin-bottom:5px;">‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶®‡¶æ‡¶Æ</label>
            <input id="e-plan" class="inp">
            
            <label style="font-size:12px; color:#666; font-weight:600; display:block; margin-bottom:5px;">‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
            <input id="e-pass" class="inp" placeholder="‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
            
            <div style="display:flex; gap:15px; margin-top:20px;">
                <button class="btn" style="background:var(--danger-color); box-shadow:none;" onclick="doBan()" id="ban-btn">‡¶¨‡ßç‡¶Ø‡¶æ‡¶®</button>
                <button class="btn" onclick="saveUser()">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
            <button onclick="closeModal('user-modal')" style="background:transparent; border:none; color:#999; width:100%; margin-top:15px; font-weight:600; cursor:pointer;">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>
    
    <div id="plan-modal" class="modal">
        <div class="modal-box">
            <h3 style="margin-top:0; text-align:center;">‡¶®‡¶§‡ßÅ‡¶® ‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®</h3>
            <input id="p-name" class="inp" placeholder="‡¶®‡¶æ‡¶Æ (‡¶Ø‡ßá‡¶Æ‡¶®: Gold VIP)">
            <input id="p-price" type="number" class="inp" placeholder="‡¶¶‡¶æ‡¶Æ (‡¶ü‡¶æ‡¶ï‡¶æ)">
            <input id="p-inc" type="number" class="inp" placeholder="‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ (‡¶ü‡¶æ‡¶ï‡¶æ)">
            <input id="p-val" type="number" class="inp" placeholder="‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ (‡¶¶‡¶ø‡¶®)">
            
            <button class="btn" onclick="savePlan()">‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button onclick="closeModal('plan-modal')" style="background:transparent; border:none; color:#999; width:100%; margin-top:15px; font-weight:600; cursor:pointer;">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>
    
    <div id="detail-modal" class="modal">
        <div class="modal-box">
            <div style="text-align:center; margin-bottom:20px;">
                <div style="width:60px; height:60px; background:#F3F4F6; border-radius:50%; display:flex; justify-content:center; align-items:center; margin:0 auto 10px; color:var(--text-main);">
                    <i class="fas fa-file-invoice" style="font-size:25px;"></i>
                </div>
                <h3 style="margin:0;">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</h3>
            </div>
            
            <div id="rec-content" style="font-size:14px; color:#4B5563;"></div>
            
            <button onclick="closeModal('detail-modal')" class="btn" style="margin-top:25px;">‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá</button>
        </div>
    </div>

    <script>
        // =========================================
        // 1. FIREBASE CONFIGURATION
        // =========================================
        const firebaseConfig = { 
            apiKey: "AIzaSyDgI-d8iwWr40tmknbY6jhH0oRb2Tvg4d0", 
            authDomain: "takar-gach-a1d84.firebaseapp.com", 
            databaseURL: "https://takar-gach-a1d84-default-rtdb.firebaseio.com", 
            projectId: "takar-gach-a1d84", 
            storageBucket: "takar-gach-a1d84.firebasestorage.app", 
            messagingSenderId: "637802367074", 
            appId: "1:637802367074:web:2e7f6c0670ec47f3a1693b", 
            measurementId: "G-0QL9LB7BSK" 
        };
        
        firebase.initializeApp(firebaseConfig); 
        const db = firebase.database();

        // ADMIN CREDENTIALS
        const CREDENTIALS = { 
            username: 'JIHAD', 
            password: '198373' 
        };

        // GLOBAL VARIABLES
        let allHistoryData = [];
        let currentEditUid = '';

        // =========================================
        // 2. INITIALIZATION & AUTHENTICATION
        // =========================================
        window.onload = function() { 
            setTimeout(() => { 
                // Hide Splash Screen
                document.getElementById('splash-screen').style.display = 'none'; 
                
                // Check Session
                if(sessionStorage.getItem('admin_session_active')) {
                    showDashboard(); 
                } else {
                    document.getElementById('auth-view').style.display = 'flex'; 
                }
            }, 2500); 
        };

        function login() { 
            const u = document.getElementById('u').value; 
            const p = document.getElementById('p').value; 
            
            if(u === CREDENTIALS.username && p === CREDENTIALS.password) { 
                sessionStorage.setItem('admin_session_active', true); 
                showDashboard(); 
            } else {
                Swal.fire({
                    icon: 'error',
                    title: '‡¶≠‡ßÅ‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø!',
                    text: '‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡ßü‡•§',
                    confirmButtonColor: '#EF4444'
                }); 
            }
        }

        function logout() { 
            sessionStorage.removeItem('admin_session_active'); 
            location.reload(); 
        }

        function showDashboard() { 
            document.getElementById('auth-view').style.display = 'none'; 
            document.getElementById('dashboard').style.display = 'block'; 
            loadHomeStatistics(); 
            updatePendingCount(); 
        }

        // =========================================
        // 3. NAVIGATION CONTROLLER
        // =========================================
        function goHome() { 
            document.getElementById('dynamic-view').classList.remove('active'); 
            document.getElementById('home-view').classList.add('active'); 
            
            // Update Active Nav State
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.querySelector('.nav-item:first-child').classList.add('active');
            
            loadHomeStatistics(); 
        }

        function nav(page) {
            // Switch View
            document.getElementById('home-view').classList.remove('active'); 
            document.getElementById('dynamic-view').classList.add('active');
            
            const contentDiv = document.getElementById('page-content'); 
            const titleDiv = document.getElementById('page-title');
            
            // Show Loading State
            contentDiv.innerHTML = `
                <div style="text-align:center; padding:50px">
                    <i class="fas fa-circle-notch fa-spin fa-3x" style="color:var(--primary)"></i>
                    <p style="color:#666; margin-top:10px;">‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                </div>
            `;

            // ---------------- PAGE LOGIC ----------------

            // ‚û§ PAGE: ALL USERS
            if(page === 'users') {
                titleDiv.innerText = "‡¶∏‡¶ï‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ";
                db.ref('users').once('value', snapshot => { 
                    const users = snapshot.val() || {}; 
                    let html = `
                        <input onkeyup="searchUser(this)" class="inp" placeholder="üîç ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶´‡ßã‡¶® ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...">
                        <div id="user-list-container">
                    `;
                    
                    Object.keys(users).forEach(key => {
                        const u = users[key];
                        const vipBadge = u.isVip ? '<span class="badge badge-vip">VIP</span>' : '';
                        
                        html += `
                        <div class="list-item user-row" data-search="${u.name.toLowerCase()} ${u.phone}">
                            <div>
                                <div style="font-weight:700; font-size:15px; color:#111;">${u.name} ${vipBadge}</div>
                                <div style="font-size:12px; color:#666; margin-top:2px;">${u.phone}</div>
                            </div>
                            <div style="text-align:right;">
                                <div style="font-weight:800; color:var(--primary); font-size:16px;">‡ß≥${u.balance}</div>
                                <button class="btn-sm" style="background:#3B82F6; margin-top:5px;" onclick="openEditUser('${key}')">
                                    <i class="fas fa-edit"></i> ‡¶è‡¶°‡¶ø‡¶ü
                                </button>
                            </div>
                        </div>`;
                    });
                    
                    html += '</div>';
                    contentDiv.innerHTML = html; 
                });
            }

            // ‚û§ PAGE: HISTORY (ALL)
            else if(page === 'history') {
                titleDiv.innerText = "‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏";
                db.ref('users').once('value', snapshot => {
                    const users = snapshot.val() || {}; 
                    let historyList = []; 
                    allHistoryData = [];

                    Object.keys(users).forEach(uid => { 
                        const history = users[uid].history || {}; 
                        Object.keys(history).forEach(hid => { 
                            const item = history[hid];
                            // Only show completed/rejected items in history page
                            if(item.status !== 'Pending') { 
                                historyList.push({
                                    ...item,
                                    uid: uid,
                                    name: users[uid].name,
                                    phone: users[uid].phone
                                }); 
                            } 
                        }); 
                    });

                    // Sort by newest first
                    historyList.reverse(); 
                    allHistoryData = historyList;

                    if(historyList.length === 0) {
                        contentDiv.innerHTML = '<div style="text-align:center; color:#999; padding:20px;">‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</div>';
                    } else {
                        contentDiv.innerHTML = historyList.map((item, index) => {
                            const badgeClass = item.status === 'Success' ? 'badge-success' : 'badge-reject';
                            return `
                            <div class="list-item">
                                <div>
                                    <div style="font-weight:700;">${item.type}</div>
                                    <div style="font-size:12px; color:#666;">${item.name} (${item.phone})</div>
                                    <div style="font-size:10px; color:#999;">${item.date}</div>
                                </div>
                                <div style="text-align:right;">
                                    <div style="font-weight:800;">‡ß≥${item.amount}</div>
                                    <span class="badge ${badgeClass}">${item.status}</span><br>
                                    <button class="btn-sm" style="background:#374151; margin-top:5px;" onclick="viewReceipt(${index})">
                                        ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§
                                    </button>
                                </div>
                            </div>`;
                        }).join('');
                    }
                });
            }

            // ‚û§ PAGE: PENDING REQUESTS (Deposit / Withdraw / Jobs)
            else if(page === 'deposits' || page === 'withdraws' || page === 'job_reqs') {
                let typeLabel = '';
                if(page === 'job_reqs') typeLabel = '‡¶ú‡¶¨ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü';
                else if(page === 'deposits') typeLabel = '‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü';
                else typeLabel = '‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü';
                
                titleDiv.innerText = typeLabel;

                db.ref('users').once('value', snapshot => {
                    let html = ''; 
                    const users = snapshot.val() || {};
                    let hasData = false;

                    Object.keys(users).forEach(uid => {
                        const history = users[uid].history || {};
                        Object.keys(history).forEach(hid => {
                            const item = history[hid];
                            
                            // Check if Pending
                            if(item.status === 'Pending') {
                                let shouldShow = false;
                                if(page === 'job_reqs' && item.type === 'Task Reward') shouldShow = true;
                                if(page === 'deposits' && item.type.includes('Buy')) shouldShow = true;
                                if(page === 'withdraws' && item.type === 'Withdraw') shouldShow = true;

                                if(shouldShow) {
                                    hasData = true;
                                    // Validity Badge for VIP
                                    const validityHtml = item.validity ? `<br><span style="color:#059669; font-weight:bold;">‡¶Æ‡ßá‡ßü‡¶æ‡¶¶: ${item.validity} ‡¶¶‡¶ø‡¶®</span>` : '';
                                    
                                    html += `
                                    <div class="card">
                                        <div style="display:flex; justify-content:space-between; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;">
                                            <div style="font-weight:700;">${users[uid].name}</div>
                                            <div style="font-weight:800; color:var(--primary);">‡ß≥${item.amount}</div>
                                        </div>
                                        <div style="background:#F3F4F6; padding:12px; border-radius:10px; font-size:13px; color:#4B5563; margin-bottom:15px;">
                                            ${page === 'job_reqs' ? `<b>Proof:</b> ${item.proof}` : `<b>Details:</b> ${item.trx || item.sender} (${item.method || 'System'})`}
                                            ${validityHtml}
                                            <div style="font-size:10px; color:#999; margin-top:5px;">${item.date}</div>
                                        </div>
                                        <div style="display:flex; gap:10px;">
                                            <button class="btn" style="flex:1; background:#10B981; padding:10px;" onclick="processAction('${uid}', '${hid}', 'Success', '${item.type}', ${item.amount})">
                                                Approve
                                            </button>
                                            <button class="btn" style="flex:1; background:#EF4444; padding:10px;" onclick="processAction('${uid}', '${hid}', 'Rejected', '${item.type}', ${item.amount})">
                                                Reject
                                            </button>
                                        </div>
                                    </div>`;
                                }
                            }
                        });
                    });
                    
                    contentDiv.innerHTML = hasData ? html : '<div style="text-align:center; color:#999; padding:30px;">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§</div>';
                });
            }

            // ‚û§ PAGE: SETTINGS (Config + Language)
            else if(page === 'settings') {
                titleDiv.innerText = "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏";
                db.ref('settings').once('value', snapshot => {
                    const settings = snapshot.val() || {}; 
                    const config = settings.config || {};
                    const isMaintenance = settings.maintenance ? 'checked' : ''; 
                    const isEnglish = settings.language === 'en' ? 'checked' : ''; // Check Language

                    contentDiv.innerHTML = `
                    <div class="card" style="border: 2px solid #EF4444; background:#FEF2F2;">
                        <h3 style="color:#DC2626; margin-top:0;">‚ö†Ô∏è ‡¶á‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡ßá‡¶®‡ßç‡¶∏‡¶ø ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤</h3>
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span>‡¶Æ‡ßá‡¶á‡¶®‡¶ü‡ßá‡¶®‡ßá‡¶®‡ßç‡¶∏ ‡¶Æ‡ßã‡¶° (App OFF)</span>
                            <label class="switch switch-red">
                                <input type="checkbox" id="set-maint" ${isMaintenance}>
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>

                    <div class="card">
                        <h3 style="margin-top:0;">üåê ‡¶≠‡¶æ‡¶∑‡¶æ (Language)</h3>
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span>App Language (Bangla / English)</span>
                            <label class="switch">
                                <input type="checkbox" id="set-lang" ${isEnglish}>
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>

                    <div class="card">
                        <h3>‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï (Usernames)</h3>
                        <label style="font-size:12px; color:#666;">Admin Username (Telegram)</label>
                        <input id="set-sup" class="inp" value="${config.supportLink || ''}">
                        
                        <label style="font-size:12px; color:#666;">Channel Username</label>
                        <input id="set-ch" class="inp" value="${config.channelLink || ''}">
                        
                        <label style="font-size:12px; color:#666;">Group Username</label>
                        <input id="set-grp" class="inp" value="${config.groupLink || ''}">
                    </div>

                    <div class="card">
                        <h3>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞</h3>
                        <label style="font-size:12px; color:#666;">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞</label>
                        <input id="set-bk" class="inp" value="${config.bkash || ''}">
                        
                        <label style="font-size:12px; color:#666;">‡¶®‡¶ó‡¶¶ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞</label>
                        <input id="set-ng" class="inp" value="${config.nagad || ''}">
                    </div>

                    <div class="card">
                        <h3>‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶ì ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</h3>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                            <div>
                                <label style="font-size:12px; color:#666;">‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</label>
                                <input id="set-minW" class="inp" type="number" value="${config.minWithdraw || 20}">
                            </div>
                            <div>
                                <label style="font-size:12px; color:#666;">‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</label>
                                <input id="set-wch" class="inp" type="number" value="${config.withdrawCharge || 5}">
                            </div>
                        </div>
                        <label style="font-size:12px; color:#666;">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</label>
                        <input id="set-ref" class="inp" type="number" value="${config.refBonus || 2}">
                    </div>

                    <div class="card">
                        <h3>‡¶π‡ßã‡¶Æ‡¶™‡ßá‡¶ú ‡¶®‡ßã‡¶ü‡¶ø‡¶∏</h3>
                        <textarea id="set-nt" class="inp" rows="4" placeholder="‡¶®‡ßã‡¶ü‡¶ø‡¶∏ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">${settings.notice || ''}</textarea>
                        <button class="btn" onclick="saveSettings()">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>`;
                });
            }

            // ‚û§ PAGE: VIP PLANS
            else if(page === 'plans') {
                titleDiv.innerText = "VIP ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü";
                contentDiv.innerHTML = `
                    <button class="btn" style="width:100%; margin-bottom:20px;" onclick="document.getElementById('plan-modal').style.display='flex'">
                        <i class="fas fa-plus-circle"></i> ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
                    </button>
                    <div id="plans-list"></div>
                `;
                
                db.ref('settings/vipPlans').on('value', snapshot => { 
                    const plans = snapshot.val() || {};
                    let html = '';
                    
                    Object.keys(plans).forEach(key => {
                        const p = plans[key];
                        html += `
                        <div class="card" style="text-align:center; border:2px solid var(--primary); padding:25px;">
                            <h3 style="margin:0; font-size:20px;">${p.name}</h3>
                            <h1 style="color:var(--primary); margin:10px 0; font-size:30px;">‡ß≥${p.price}</h1>
                            <div style="font-size:13px; color:#666; margin-bottom:15px;">
                                ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ: ‡ß≥${p.dailyIncome}<br>
                                ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶: ${p.validity} ‡¶¶‡¶ø‡¶®
                            </div>
                            <button class="btn-sm" style="background:#EF4444; width:100%; padding:10px;" onclick="deletePlan('${key}')">
                                ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                            </button>
                        </div>`;
                    });
                    
                    document.getElementById('plans-list').innerHTML = html || '<div style="text-align:center; color:#999;">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶®‡ßá‡¶á‡•§</div>';
                });
            }

            // ‚û§ PAGE: TASKS
            else if(page === 'tasks') {
                titleDiv.innerText = "‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü";
                contentDiv.innerHTML = `
                    <div class="card">
                        <h3>‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                        <input id="t-ti" class="inp" placeholder="‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ (Title)">
                        <input id="t-rw" type="number" class="inp" placeholder="‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ (‡¶ü‡¶æ‡¶ï‡¶æ)">
                        <input id="t-ln" class="inp" placeholder="‡¶≤‡¶ø‡¶Ç‡¶ï (Link)">
                        <input id="t-hint" class="inp" placeholder="‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶á‡¶®‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶æ‡¶ï‡¶∂‡¶® (‡¶Ø‡ßá‡¶Æ‡¶®: Screenshot ‡¶¶‡¶ø‡¶®)">
                        
                        <label style="font-size:12px; color:#666;">‡¶ï‡¶æ‡¶∞‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá?</label>
                        <select id="t-tg" class="inp">
                            <option value="free">‡¶´‡ßç‡¶∞‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</option>
                            <option value="vip">‡¶∏‡¶ï‡¶≤ VIP ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</option>
                            <option value="bronze">Bronze VIP</option>
                            <option value="silver">Silver VIP</option>
                            <option value="gold">Gold VIP</option>
                        </select>
                        <button class="btn" onclick="addNewTask()">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>
                    <div id="tasks-list"></div>
                `;
                
                db.ref('settings/tasks').on('value', snapshot => { 
                    const tasks = snapshot.val() || {};
                    let html = '';
                    
                    Object.keys(tasks).forEach(key => {
                        const t = tasks[key];
                        html += `
                        <div class="list-item">
                            <div>
                                <div style="font-weight:bold;">${t.title}</div>
                                <div style="font-size:11px; color:#666;">Reward: ‡ß≥${t.reward} | Target: ${t.target}</div>
                            </div>
                            <button class="btn-sm" style="background:#EF4444;" onclick="deleteTask('${key}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>`;
                    });
                    
                    document.getElementById('tasks-list').innerHTML = html || '<div style="text-align:center; color:#999; margin-top:20px;">‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶®‡ßá‡¶á‡•§</div>'; 
                });
            }
        }

        // =========================================
        // 4. CORE ACTION LOGIC (APPROVE / REJECT)
        // =========================================
        function processAction(uid, hid, status, type, amount) {
            
            // LOGIC FOR REJECTION
            if(status === 'Rejected') {
                Swal.fire({
                    title: '‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£?',
                    input: 'text',
                    inputPlaceholder: '‡¶ï‡¶æ‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶≠‡ßÅ‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞, ‡¶´‡ßá‡¶á‡¶ï ‡¶™‡ßç‡¶∞‡ßÅ‡¶´)',
                    showCancelButton: true,
                    confirmButtonText: '‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®',
                    cancelButtonText: '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤',
                    confirmButtonColor: '#EF4444',
                    cancelButtonColor: '#6B7280'
                }).then((result) => {
                    if (result.isConfirmed) {
                        const reason = result.value || '‡¶Ö‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶ï‡¶æ‡¶∞‡¶£'; // Default reason
                        
                        // Update status and reason in history
                        db.ref(`users/${uid}/history/${hid}`).update({
                            status: status, 
                            reason: reason
                        });

                        // If it was a Withdraw, refund the money
                        if(type === 'Withdraw') {
                            db.ref(`users/${uid}/balance`).transaction(bal => (bal || 0) + parseInt(amount));
                        }

                        Swal.fire('‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá', '‡¶ï‡¶æ‡¶∞‡¶£ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§', 'success');
                        
                        // Refresh current view
                        nav(type === 'Task Reward' ? 'job_reqs' : (type === 'Withdraw' ? 'withdraws' : 'deposits'));
                    }
                });
            } 
            
            // LOGIC FOR APPROVAL
            else {
                // Fetch the request data first to check Validity
                db.ref(`users/${uid}/history/${hid}`).once('value', snapshot => {
                    const reqData = snapshot.val() || {};
                    
                    // Update Status
                    db.ref(`users/${uid}/history/${hid}`).update({ status: status });

                    if(status === 'Success') {
                        
                        // If it's a VIP Purchase
                        if(type.includes('Buy')) {
                            // Use validity from request, or default to 30 days
                            const days = reqData.validity ? parseInt(reqData.validity) : 30;
                            
                            db.ref(`users/${uid}`).update({
                                isVip: true, 
                                currentPlan: type.replace('Buy ', ''), 
                                vipExpire: Date.now() + (days * 86400000) // Dynamic Calculation
                            });
                        } 
                        
                        // If it's a Task Reward
                        else if(type === 'Task Reward') {
                            db.ref(`users/${uid}/balance`).transaction(bal => (bal || 0) + parseInt(amount));
                        }
                    }

                    Swal.fire('‡¶∏‡¶´‡¶≤!', '‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§', 'success');
                    
                    // Refresh view
                    nav(type === 'Task Reward' ? 'job_reqs' : (type === 'Withdraw' ? 'withdraws' : 'deposits'));
                });
            }
        }

        // =========================================
        // 5. SETTINGS & CRUD FUNCTIONS
        // =========================================
        function saveSettings() {
            const maintenance = document.getElementById('set-maint').checked;
            const language = document.getElementById('set-lang').checked ? 'en' : 'bn'; // Toggle Logic
            const notice = document.getElementById('set-nt').value;

            // Update Root Settings
            db.ref('settings').update({ 
                maintenance: maintenance, 
                language: language,
                notice: notice 
            });

            // Update Config
            db.ref('settings/config').update({ 
                bkash: document.getElementById('set-bk').value, 
                nagad: document.getElementById('set-ng').value,
                supportLink: document.getElementById('set-sup').value,
                channelLink: document.getElementById('set-ch').value,
                groupLink: document.getElementById('set-grp').value,
                minWithdraw: parseInt(document.getElementById('set-minW').value),
                withdrawCharge: parseInt(document.getElementById('set-wch').value),
                refBonus: parseInt(document.getElementById('set-ref').value)
            });

            Swal.fire({ icon: 'success', title: '‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá', timer: 1500, showConfirmButton: false });
        }

        function savePlan() {
            const name = document.getElementById('p-name').value;
            const price = document.getElementById('p-price').value;
            const income = document.getElementById('p-inc').value;
            const validity = document.getElementById('p-val').value;

            if(!name || !price || !validity) {
                return Swal.fire('Error', '‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®', 'warning');
            }

            db.ref('settings/vipPlans').push({
                name: name,
                price: parseInt(price),
                dailyIncome: parseInt(income),
                validity: parseInt(validity)
            });

            closeModal('plan-modal');
            Swal.fire('‡¶∏‡¶´‡¶≤', '‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá', 'success');
        }

        function deletePlan(key) {
            if(confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶è‡¶á ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                db.ref('settings/vipPlans/' + key).remove();
            }
        }

        function addNewTask() {
            const title = document.getElementById('t-ti').value;
            const reward = document.getElementById('t-rw').value;
            const link = document.getElementById('t-ln').value;
            const target = document.getElementById('t-tg').value;
            const hint = document.getElementById('t-hint').value;

            if(!title || !reward || !link) {
                return Swal.fire('Error', '‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®', 'warning');
            }

            db.ref('settings/tasks').push({
                title: title,
                reward: parseInt(reward),
                link: link,
                target: target,
                proofHint: hint || '‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®'
            });

            Swal.fire('‡¶∏‡¶´‡¶≤', '‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶π‡ßü‡ßá‡¶õ‡ßá', 'success');
        }

        function deleteTask(key) {
            if(confirm('‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                db.ref('settings/tasks/' + key).remove();
            }
        }

        // =========================================
        // 6. USER MANAGEMENT FUNCTIONS
        // =========================================
        function openEditUser(uid) {
            currentEditUid = uid;
            
            db.ref('users/' + uid).once('value', snapshot => {
                const u = snapshot.val();
                document.getElementById('e-bal').value = u.balance;
                document.getElementById('e-plan').value = u.currentPlan || '';
                document.getElementById('e-pass').value = ''; // Reset pass field
                
                const banBtn = document.getElementById('ban-btn');
                if(u.banned) {
                    banBtn.innerText = "‡¶Ü‡¶®‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";
                    banBtn.style.background = "#10B981"; // Green
                } else {
                    banBtn.innerText = "‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";
                    banBtn.style.background = "#EF4444"; // Red
                }
                
                document.getElementById('user-modal').style.display = 'flex';
            });
        }

        function saveUser() {
            let updateData = {
                balance: parseInt(document.getElementById('e-bal').value),
                currentPlan: document.getElementById('e-plan').value,
                isVip: !!document.getElementById('e-plan').value // If plan exists, true
            };

            const newPass = document.getElementById('e-pass').value;
            if(newPass && newPass.length >= 6) {
                updateData.pass = newPass;
            }

            db.ref('users/' + currentEditUid).update(updateData);
            closeModal('user-modal');
            Swal.fire('‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá');
            nav('users'); // Refresh list
        }

        function doBan() {
            db.ref('users/' + currentEditUid).once('value', s => {
                const isBanned = s.val().banned;
                db.ref('users/' + currentEditUid).update({ banned: !isBanned });
                closeModal('user-modal');
                Swal.fire(isBanned ? '‡¶Ü‡¶®‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá' : '‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
                nav('users');
            });
        }

        function searchUser(e) {
            const val = e.value.toLowerCase();
            document.querySelectorAll('.user-row').forEach(row => {
                const txt = row.dataset.search;
                row.style.display = txt.includes(val) ? 'flex' : 'none';
            });
        }

        // =========================================
        // 7. HELPER FUNCTIONS
        // =========================================
        function loadHomeStatistics() {
            db.ref('users').once('value', snapshot => {
                const users = snapshot.val() || {};
                let totalBal = 0, totalDep = 0, totalWd = 0;

                Object.values(users).forEach(u => {
                    totalBal += (u.balance || 0);
                    
                    if(u.history) {
                        Object.values(u.history).forEach(h => {
                            if(h.status === 'Success') {
                                if(h.type.includes('Buy')) totalDep += parseInt(h.amount);
                                else if(h.type === 'Withdraw') totalWd += parseInt(h.amount);
                            }
                        });
                    }
                });

                document.getElementById('total-u').innerText = Object.keys(users).length;
                document.getElementById('total-b').innerText = '‡ß≥' + totalBal;
                document.getElementById('total-dep').innerText = '‡ß≥' + totalDep;
                document.getElementById('total-wd').innerText = '‡ß≥' + totalWd;
                document.getElementById('net-profit').innerText = '‡ß≥' + (totalDep - totalWd);
                
                // Recent List
                const recentList = Object.values(users).slice(-5).reverse();
                document.getElementById('recent-list').innerHTML = recentList.map(u => `
                    <div class="list-item">
                        <div><b>${u.name}</b><br><small>${u.phone}</small></div>
                        <b style="color:var(--primary)">‡ß≥${u.balance}</b>
                    </div>
                `).join('');
            });
        }

        function updatePendingCount() {
            db.ref('users').on('value', snapshot => {
                let count = 0;
                const users = snapshot.val() || {};
                
                Object.values(users).forEach(u => {
                    if(u.history) {
                        Object.values(u.history).forEach(h => {
                            // Count Pending Job Requests
                            if(h.status === 'Pending' && h.type === 'Task Reward') {
                                count++;
                            }
                        });
                    }
                });

                const badge = document.getElementById('nav-badge');
                badge.innerText = count;
                badge.style.display = count > 0 ? 'block' : 'none';
            });
        }

        function viewReceipt(index) {
            const d = allHistoryData[index];
            const reasonHtml = d.reason ? `<br><div style="margin-top:10px; padding:10px; background:#FEF2F2; color:#B91C1C; border-radius:8px; font-size:13px;"><b>‚ùå ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£:</b> ${d.reason}</div>` : '';
            
            document.getElementById('rec-content').innerHTML = `
                <div style="background:#F9FAFB; padding:20px; border-radius:15px; border:1px solid #E5E7EB; font-size:14px; line-height:1.8;">
                    <div style="text-align:center; margin-bottom:15px; padding-bottom:15px; border-bottom:1px dashed #ccc;">
                        <span class="badge ${d.status === 'Success' ? 'badge-success' : 'badge-reject'}" style="font-size:14px;">${d.status}</span>
                    </div>
                    <b>üë§ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞:</b> ${d.name} (${d.phone})<br>
                    <b>üìå ‡¶ß‡¶∞‡¶£:</b> ${d.type}<br>
                    <b>üí∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:</b> <span style="color:var(--primary); font-weight:bold;">‡ß≥${d.amount}</span><br>
                    <b>üìÖ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</b> ${d.date}<br>
                    <b>üìù ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ / ‡¶™‡ßç‡¶∞‡ßÅ‡¶´:</b><br>
                    <div style="background:white; padding:10px; border:1px solid #eee; border-radius:8px; margin-top:5px; word-break:break-all;">
                        ${d.proof || d.trx || 'N/A'}
                    </div>
                    ${d.validity ? `<br><b>‚è≥ ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶:</b> ${d.validity} ‡¶¶‡¶ø‡¶®` : ''}
                    ${reasonHtml}
                </div>
            `;
            document.getElementById('detail-modal').style.display = 'flex';
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }
    </script>
</body>
</html>


