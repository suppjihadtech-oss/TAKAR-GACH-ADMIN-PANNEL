<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin V15 - Ultimate</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #059669;
            --primary-dark: #047857;
            --secondary: #10b981;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text: #1f2937;
            --text-light: #6b7280;
            --danger: #ef4444;
            --warning: #f59e0b;
            --sidebar-width: 250px;
        }

        /* DARK MODE VARS */
        [data-theme="dark"] {
            --bg: #111827;
            --card-bg: #1f2937;
            --text: #f9fafb;
            --text-light: #9ca3af;
        }

        * { box-sizing: border-box; outline: none; font-family: 'Poppins', 'Hind Siliguri', sans-serif; transition: background 0.3s, color 0.3s; }
        body { margin: 0; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; }

        /* --- SIDEBAR --- */
        .sidebar { width: var(--sidebar-width); background: var(--card-bg); height: 100%; border-right: 1px solid rgba(0,0,0,0.05); display: flex; flex-direction: column; z-index: 100; transition: 0.3s; }
        .logo-area { padding: 25px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .logo-area i { font-size: 28px; color: var(--primary); }
        .logo-area h2 { margin: 0; font-size: 20px; font-weight: 700; color: var(--primary); }
        
        .nav-links { list-style: none; padding: 20px 10px; margin: 0; flex: 1; overflow-y: auto; }
        .nav-item { padding: 12px 15px; margin-bottom: 5px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; gap: 12px; color: var(--text-light); font-weight: 500; transition: 0.2s; }
        .nav-item:hover { background: rgba(5, 150, 105, 0.1); color: var(--primary); }
        .nav-item.active { background: var(--primary); color: white; box-shadow: 0 5px 15px rgba(5, 150, 105, 0.3); }
        .nav-item i { width: 20px; text-align: center; }

        /* --- MAIN CONTENT --- */
        .main-content { flex: 1; overflow-y: auto; padding: 20px; position: relative; }
        
        /* TOP BAR */
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .page-title h1 { margin: 0; font-size: 24px; }
        .page-title p { margin: 5px 0 0; color: var(--text-light); font-size: 14px; }
        .top-actions { display: flex; gap: 15px; }
        .icon-btn { width: 40px; height: 40px; border-radius: 50%; background: var(--card-bg); display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.05); color: var(--text); }

        /* --- CARDS & GRID --- */
        .grid-4 { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--card-bg); padding: 25px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.02); display: flex; align-items: center; gap: 20px; position: relative; overflow: hidden; }
        .stat-card::before { content: ''; position: absolute; right: -20px; top: -20px; width: 100px; height: 100px; border-radius: 50%; background: var(--primary); opacity: 0.1; }
        .stat-icon { width: 60px; height: 60px; border-radius: 15px; background: rgba(5, 150, 105, 0.1); display: flex; align-items: center; justify-content: center; font-size: 24px; color: var(--primary); }
        .stat-info h3 { margin: 0; font-size: 28px; font-weight: 700; }
        .stat-info p { margin: 5px 0 0; color: var(--text-light); font-size: 14px; }

        /* --- SECTIONS --- */
        .section { display: none; animation: fadeIn 0.4s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- FORMS & INPUTS --- */
        .form-group { margin-bottom: 15px; }
        .label { display: block; margin-bottom: 8px; font-size: 13px; font-weight: 600; color: var(--text-light); }
        .inp { width: 100%; padding: 12px 15px; border: 1px solid rgba(0,0,0,0.1); border-radius: 10px; background: var(--bg); color: var(--text); font-size: 14px; }
        .inp:focus { border-color: var(--primary); background: var(--card-bg); }
        
        .btn { padding: 12px 25px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: 0.2s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn:active { transform: scale(0.95); }

        /* --- TABLES & LISTS --- */
        .table-container { background: var(--card-bg); border-radius: 20px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.02); overflow-x: auto; }
        .custom-table { width: 100%; border-collapse: collapse; }
        .custom-table th { text-align: left; padding: 15px; color: var(--text-light); font-size: 13px; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .custom-table td { padding: 15px; border-bottom: 1px solid rgba(0,0,0,0.05); font-size: 14px; }
        .badge { padding: 5px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
        .badge-success { background: #d1fae5; color: #059669; }
        .badge-pending { background: #fef3c7; color: #d97706; }
        .badge-vip { background: linear-gradient(135deg, #facc15, #ca8a04); color: white; }

        /* --- REQUEST CARDS (GORGEOUS) --- */
        .req-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .req-card { background: var(--card-bg); padding: 20px; border-radius: 15px; border-left: 5px solid var(--warning); box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
        .req-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .req-body { font-size: 13px; color: var(--text-light); margin-bottom: 15px; line-height: 1.6; }
        .proof-box { background: rgba(0,0,0,0.03); padding: 10px; border-radius: 8px; margin: 10px 0; border: 1px dashed #ccc; color: var(--primary); font-family: monospace; }

        /* --- LOGIN SCREEN --- */
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #e0e7ff; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: white; padding: 40px; border-radius: 30px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.1); }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .sidebar { position: fixed; left: -250px; }
            .sidebar.show { left: 0; }
            body { display: block; }
        }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <i class="fas fa-shield-alt" style="font-size: 50px; color: var(--primary); margin-bottom: 20px;"></i>
            <h2 style="color: var(--primary); margin-bottom: 10px;">Admin Access</h2>
            <p style="color: var(--text-light); margin-bottom: 30px;">Takar Gach Control Panel</p>
            <input type="text" id="admin-user" class="inp" placeholder="Username" style="margin-bottom: 15px;">
            <input type="password" id="admin-pass" class="inp" placeholder="Password" style="margin-bottom: 25px;">
            <button class="btn btn-primary" style="width: 100%; justify-content: center;" onclick="doLogin()">Secure Login</button>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="logo-area">
            <i class="fas fa-tree"></i>
            <h2>Takar Gach</h2>
        </div>
        <ul class="nav-links">
            <li class="nav-item active" onclick="nav('dashboard', this)"><i class="fas fa-home"></i> ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</li>
            <li class="nav-item" onclick="nav('requests', this)"><i class="fas fa-bell"></i> ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü <span class="badge badge-pending" id="nav-badge" style="margin-left:auto">0</span></li>
            <li class="nav-item" onclick="nav('tasks', this)"><i class="fas fa-list-check"></i> ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞</li>
            <li class="nav-item" onclick="nav('users', this)"><i class="fas fa-users"></i> ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü</li>
            <li class="nav-item" onclick="nav('vip', this)"><i class="fas fa-gem"></i> VIP ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®</li>
            <li class="nav-item" onclick="nav('settings', this)"><i class="fas fa-cog"></i> ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</li>
        </ul>
        <div style="padding: 20px;">
            <button class="btn btn-danger" style="width: 100%; justify-content: center;" onclick="location.reload()"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>
    </div>

    <div class="main-content">
        <div class="top-bar">
            <div class="page-title">
                <h1 id="page-head">Dashboard</h1>
                <p>Welcome back, Admin!</p>
            </div>
            <div class="top-actions">
                <div class="icon-btn" onclick="toggleTheme()"><i class="fas fa-moon"></i></div>
                <div class="icon-btn" onclick="document.getElementById('sidebar').classList.toggle('show')"><i class="fas fa-bars"></i></div>
            </div>
        </div>

        <div id="dashboard" class="section active">
            <div class="grid-4">
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-users"></i></div>
                    <div class="stat-info"><h3 id="st-users">0</h3><p>Total Users</p></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="color:var(--warning); background:rgba(245,158,11,0.1)"><i class="fas fa-clock"></i></div>
                    <div class="stat-info"><h3 id="st-pending">0</h3><p>Pending Requests</p></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="color:var(--danger); background:rgba(239,68,68,0.1)"><i class="fas fa-crown"></i></div>
                    <div class="stat-info"><h3 id="st-vip">0</h3><p>VIP Members</p></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="color:#3b82f6; background:rgba(59,130,246,0.1)"><i class="fas fa-tasks"></i></div>
                    <div class="stat-info"><h3 id="st-tasks">0</h3><p>Active Tasks</p></div>
                </div>
            </div>
            
            <div class="table-container">
                <h3 style="margin-top:0;">üöÄ Quick Actions</h3>
                <div style="display:flex; gap:10px; flex-wrap:wrap;">
                    <button class="btn btn-primary" onclick="nav('tasks', document.querySelectorAll('.nav-item')[2])">+ Add Task</button>
                    <button class="btn btn-warning" onclick="nav('settings', document.querySelectorAll('.nav-item')[5])">Change Notice</button>
                </div>
            </div>
        </div>

        <div id="requests" class="section">
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <button class="btn btn-primary" onclick="filterReq('all')">All</button>
                <button class="btn btn-warning" onclick="filterReq('withdraw')">Withdraw</button>
                <button class="btn btn-primary" style="background:#3b82f6" onclick="filterReq('task')">Proofs</button>
            </div>
            <div id="req-container" class="req-grid">
                <p style="color:var(--text-light)">Loading Requests...</p>
            </div>
        </div>

        <div id="tasks" class="section">
            <div class="grid-4">
                <div class="stat-card" style="display:block;">
                    <h3 style="margin-top:0; color:var(--primary)">‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</h3>
                    <div class="form-group">
                        <label class="label">Target User</label>
                        <select id="t-target" class="inp">
                            <option value="free">Free User</option>
                            <option value="vip">VIP User</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="label">Platform</label>
                        <select id="t-type" class="inp">
                            <option value="youtube">YouTube</option>
                            <option value="telegram">Telegram</option>
                            <option value="facebook">Facebook</option>
                            <option value="website">Website</option>
                        </select>
                    </div>
                    <input id="t-title" class="inp" placeholder="Task Title (e.g. Subscribe Channel)" style="margin-bottom:10px;">
                    <div style="display:flex; gap:10px; margin-bottom:10px;">
                        <input id="t-reward" type="number" class="inp" placeholder="Reward (Tk)">
                        <input id="t-link" class="inp" placeholder="Link">
                    </div>
                    <button class="btn btn-primary" style="width:100%" onclick="addTask()">Publish Task</button>
                </div>

                <div class="table-container" style="grid-column: span 2;">
                    <h3>Live Tasks</h3>
                    <div id="task-list"></div>
                </div>
            </div>
        </div>

        <div id="users" class="section">
            <div class="table-container">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h3>All Users</h3>
                    <input id="search-user" class="inp" placeholder="Search by Phone..." style="width:200px;" onkeyup="searchUser()">
                </div>
                <table class="custom-table">
                    <thead><tr><th>Name</th><th>Phone</th><th>Balance</th><th>Status</th><th>Action</th></tr></thead>
                    <tbody id="user-table-body"></tbody>
                </table>
            </div>
        </div>

        <div id="vip" class="section">
            <div class="stat-card" style="display:block; max-width:500px; margin-bottom:20px;">
                <h3>Create Plan</h3>
                <input id="v-name" class="inp" placeholder="Plan Name (e.g. Gold)" style="margin-bottom:10px;">
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <input id="v-price" type="number" class="inp" placeholder="Price">
                    <input id="v-daily" type="number" class="inp" placeholder="Daily Income">
                    <input id="v-valid" type="number" class="inp" placeholder="Validity (Days)">
                </div>
                <button class="btn btn-warning" onclick="addVip()">Save Plan</button>
            </div>
            <div class="req-grid" id="vip-list-con"></div>
        </div>

        <div id="settings" class="section">
            <div class="stat-card" style="display:block; max-width:600px;">
                <h3>‚öôÔ∏è App Configuration</h3>
                <div class="form-group">
                    <label class="label">Bkash Number (Personal)</label>
                    <input id="c-bkash" class="inp" placeholder="017...">
                </div>
                <div class="form-group">
                    <label class="label">Nagad Number (Personal)</label>
                    <input id="c-nagad" class="inp" placeholder="018...">
                </div>
                <div class="form-group">
                    <label class="label">Marquee Notice</label>
                    <textarea id="c-notice" class="inp" rows="3"></textarea>
                </div>
                <div class="form-group" style="background: #fee2e2; padding:10px; border-radius:10px; display:flex; justify-content:space-between; align-items:center;">
                    <b style="color:var(--danger)">Maintenance Mode</b>
                    <input type="checkbox" id="c-maint" style="width:20px; height:20px;">
                </div>
                <button class="btn btn-primary" onclick="saveConf()">Update Settings</button>
            </div>
        </div>

    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyDgI-d8iwWr40tmknbY6jhH0oRb2Tvg4d0", authDomain: "takar-gach-a1d84.firebaseapp.com", databaseURL: "https://takar-gach-a1d84-default-rtdb.firebaseio.com", projectId: "takar-gach-a1d84", storageBucket: "takar-gach-a1d84.firebasestorage.app", messagingSenderId: "637802367074", appId: "1:637802367074:web:2e7f6c0670ec47f3a1693b", measurementId: "G-0QL9LB7BSK" };
        try { firebase.initializeApp(firebaseConfig); } catch(e) { console.log(e); }
        const db = firebase.database();

        // AUTH
        function doLogin() {
            const u = document.getElementById('admin-user').value;
            const p = document.getElementById('admin-pass').value;
            if(u === 'JIHAD' && p === '198373ZA') {
                document.getElementById('login-overlay').style.display = 'none';
                initAdmin();
            } else { alert('Wrong Credentials!'); }
        }

        // NAVIGATION
        function nav(id, el) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            if(el) el.classList.add('active');
            document.getElementById('page-head').innerText = id.charAt(0).toUpperCase() + id.slice(1);
            if(window.innerWidth < 768) document.getElementById('sidebar').classList.remove('show');
        }

        function toggleTheme() {
            const body = document.body;
            body.setAttribute('data-theme', body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
        }

        // MAIN LOGIC
        function initAdmin() {
            // USERS & REQUESTS STREAM
            db.ref('users').on('value', snap => {
                const users = snap.val() || {};
                const uKeys = Object.keys(users);
                document.getElementById('st-users').innerText = uKeys.length;

                let pending = 0, vipCount = 0, tasksActive = 0;
                let reqHTML = '';
                let userHTML = '';

                uKeys.forEach(uid => {
                    const u = users[uid];
                    if(u.isVip) vipCount++;

                    // Generate User List
                    userHTML += `
                    <tr>
                        <td>${u.name}</td>
                        <td>${u.phone}</td>
                        <td>‡ß≥${u.balance}</td>
                        <td>${u.isVip ? '<span class="badge badge-vip">VIP</span>' : '<span class="badge">Free</span>'}</td>
                        <td>
                            <button class="btn btn-primary" style="padding:5px 10px; font-size:12px;" onclick="editBal('${uid}', ${u.balance})">Edit Bal</button>
                        </td>
                    </tr>`;

                    // Requests
                    if(u.history) {
                        Object.keys(u.history).forEach(key => {
                            const h = u.history[key];
                            if(h.status === 'Pending') {
                                pending++;
                                let typeColor = h.type.includes('With') ? 'var(--danger)' : (h.type.includes('Buy') ? 'var(--primary)' : '#3b82f6');
                                let proofSec = h.proof ? `<div class="proof-box">üìù Proof: ${h.proof}</div>` : '';
                                
                                reqHTML += `
                                <div class="req-card">
                                    <div class="req-head">
                                        <div><b>${u.name}</b> <small>(${u.phone})</small></div>
                                        <b style="color:${typeColor}">${h.type}</b>
                                    </div>
                                    <div class="req-body">
                                        Amount: <b>‡ß≥${h.amount}</b><br>
                                        Method: ${h.method || 'N/A'} (${h.trx || ''})<br>
                                        Date: ${h.date}
                                        ${proofSec}
                                    </div>
                                    <div style="display:flex; gap:10px;">
                                        <button class="btn btn-primary" style="flex:1" onclick="actionReq('${uid}','${key}','Success','${h.type}')">Accept</button>
                                        <button class="btn btn-danger" style="flex:1" onclick="actionReq('${uid}','${key}','Rejected','${h.type}')">Reject</button>
                                    </div>
                                </div>`;
                            }
                        });
                    }
                });

                document.getElementById('st-pending').innerText = pending;
                document.getElementById('st-vip').innerText = vipCount;
                document.getElementById('nav-badge').innerText = pending;
                
                document.getElementById('req-container').innerHTML = reqHTML || '<p style="grid-column:1/-1;text-align:center;">No Pending Requests üéâ</p>';
                document.getElementById('user-table-body').innerHTML = userHTML;
            });

            // TASKS STREAM
            db.ref('settings/tasks').on('value', snap => {
                const tasks = snap.val() || {};
                document.getElementById('st-tasks').innerText = Object.keys(tasks).length;
                const list = document.getElementById('task-list');
                list.innerHTML = '';
                Object.keys(tasks).forEach(k => {
                    const t = tasks[k];
                    let icon = t.platform === 'youtube' ? '<i class="fab fa-youtube" style="color:red"></i>' : '<i class="fab fa-telegram" style="color:#229ED9"></i>';
                    list.innerHTML += `
                    <div style="background:var(--bg); padding:10px; border-radius:10px; margin-bottom:8px; display:flex; justify-content:space-between; align-items:center;">
                        <div style="display:flex; align-items:center; gap:10px;">
                            ${icon}
                            <div>
                                <span class="badge" style="background:${t.target=='vip'?'var(--warning)':'#9ca3af'}">${t.target.toUpperCase()}</span>
                                <b>${t.title}</b><br>
                                <small>Reward: ‡ß≥${t.reward}</small>
                            </div>
                        </div>
                        <i class="fas fa-trash" style="color:var(--danger); cursor:pointer;" onclick="db.ref('settings/tasks/${k}').remove()"></i>
                    </div>`;
                });
            });

            // SETTINGS & VIP
            db.ref('settings').on('value', snap => {
                const d = snap.val() || {};
                const c = d.config || {};
                document.getElementById('c-bkash').value = c.bkash || '';
                document.getElementById('c-nagad').value = c.nagad || '';
                document.getElementById('c-maint').checked = c.maint || false;
                document.getElementById('c-notice').value = d.notice || '';

                const vList = document.getElementById('vip-list-con');
                vList.innerHTML = '';
                if(d.vipPlans) {
                    Object.keys(d.vipPlans).forEach(k => {
                        const p = d.vipPlans[k];
                        vList.innerHTML += `
                        <div class="req-card" style="border-left-color:var(--primary)">
                            <div class="req-head"><b>${p.name}</b> <b style="color:var(--primary)">‡ß≥${p.price}</b></div>
                            <small>Daily: ‡ß≥${p.dailyIncome} | Validity: ${p.validity} Days</small>
                            <button class="btn btn-danger" style="width:100%; margin-top:10px; padding:8px;" onclick="db.ref('settings/vipPlans/${k}').remove()">Delete Plan</button>
                        </div>`;
                    });
                }
            });
        }

        // --- ACTIONS ---

        function addTask() {
            const data = {
                target: document.getElementById('t-target').value,
                platform: document.getElementById('t-type').value,
                title: document.getElementById('t-title').value,
                reward: parseInt(document.getElementById('t-reward').value),
                link: document.getElementById('t-link').value
            };
            if(!data.title || !data.reward) return alert('Fill all fields');
            db.ref('settings/tasks').push(data);
            alert('Task Published!');
        }

        function addVip() {
            const data = {
                name: document.getElementById('v-name').value,
                price: parseInt(document.getElementById('v-price').value),
                dailyIncome: parseInt(document.getElementById('v-daily').value),
                validity: parseInt(document.getElementById('v-valid').value)
            };
            if(!data.name) return alert('Name Required');
            db.ref('settings/vipPlans').push(data);
            alert('Plan Created!');
        }

        function saveConf() {
            db.ref('settings/config').update({
                bkash: document.getElementById('c-bkash').value,
                nagad: document.getElementById('c-nagad').value,
                maint: document.getElementById('c-maint').checked
            });
            db.ref('settings/notice').set(document.getElementById('c-notice').value);
            alert('Settings Saved!');
        }

        function actionReq(uid, key, status, type) {
            if(!confirm('Are you sure?')) return;
            const updates = {};
            updates[`users/${uid}/history/${key}/status`] = status;

            if(status === 'Success') {
                if(type.includes('Buy')) {
                    updates[`users/${uid}/isVip`] = true;
                    updates[`users/${uid}/currentPlan`] = type.replace('Buy ', '');
                }
                if(type.includes('Task Reward')) {
                    // Auto add balance for Approved VIP Tasks
                    db.ref(`users/${uid}/history/${key}`).once('value', s => {
                        const amt = s.val().amount;
                        db.ref(`users/${uid}/balance`).transaction(bal => (bal || 0) + amt);
                    });
                }
            }
            db.ref().update(updates);
        }

        function editBal(uid, old) {
            const newBal = prompt("Enter New Balance:", old);
            if(newBal !== null) {
                db.ref(`users/${uid}`).update({balance: parseInt(newBal)});
            }
        }

        function searchUser() {
            const q = document.getElementById('search-user').value.toLowerCase();
            const rows = document.querySelectorAll('#user-table-body tr');
            rows.forEach(r => {
                const phone = r.children[1].innerText;
                r.style.display = phone.includes(q) ? '' : 'none';
            });
        }

        // Helper filter function
        function filterReq(type) {
            const cards = document.querySelectorAll('.req-card');
            cards.forEach(c => {
                const text = c.innerText.toLowerCase();
                if(type === 'all') c.style.display = 'block';
                else if(type === 'withdraw' && text.includes('withdraw')) c.style.display = 'block';
                else if(type === 'task' && text.includes('proof')) c.style.display = 'block';
                else c.style.display = 'none';
            });
        }
    </script>
</body>
</html>

