<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ó‡¶æ‡¶õ ADMIN V5.2</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           1. PREMIUM ADMIN THEME
           ========================================= */
        :root {
            --primary: #10b981; 
            --primary-dark: #047857;
            --accent: #F59E0B;
            --danger: #EF4444;
            --bg-body: #F3F4F6;
            --text-main: #1F2937;
            --card-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg-body); font-family: 'Poppins', 'Hind Siliguri', sans-serif; color: var(--text-main); padding-bottom: 100px; user-select: none; }

        /* SPLASH SCREEN */
        #splash-screen { position: fixed; inset: 0; background: var(--bg-body); z-index: 6000; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .growing-tree { font-size: 0px; color: var(--primary); margin-bottom: 25px; animation: growTree 2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes growTree { 0% { font-size: 0px; opacity: 0; transform: translateY(60px); } 100% { font-size: 100px; opacity: 1; transform: translateY(0); } }

        /* AUTH LOGIN */
        #auth-view { position: fixed; inset: 0; background: #111827; z-index: 5000; display: none; justify-content: center; align-items: center; padding: 25px; }
        .login-box { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); padding: 40px 30px; border-radius: 30px; width: 100%; max-width: 380px; text-align: center; border: 1px solid rgba(255,255,255,0.1); color: white; box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        .login-box input { width: 100%; padding: 15px; margin-bottom: 15px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: white; text-align: center; font-size: 16px; }
        .login-box button { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 15px; font-weight: 700; font-size: 16px; cursor: pointer; box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3); }

        /* DASHBOARD */
        .header { position: sticky; top: 0; background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #e5e7eb; z-index: 500; }
        .header h2 { margin: 0; font-size: 24px; color: var(--primary); font-weight: 800; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; }
        .stat-card { background: white; padding: 25px 15px; border-radius: 25px; text-align: center; box-shadow: var(--card-shadow); border-bottom: 4px solid var(--primary); }
        .stat-card h1 { margin: 5px 0; font-size: 26px; font-weight: 800; }
        .stat-card p { margin: 0; font-size: 11px; font-weight: 700; color: #6B7280; text-transform: uppercase; }

        .profit-card { background: linear-gradient(135deg, #1F2937, #111827); color: white; padding: 25px; border-radius: 30px; margin: 0 20px 25px; text-align: center; box-shadow: 0 15px 40px rgba(0,0,0,0.2); }
        .profit-card h1 { font-size: 36px; margin: 5px 0; font-weight: 800; }

        .menu-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 0 20px; margin-bottom: 30px; }
        .menu-item { background: white; padding: 15px 5px; border-radius: 20px; text-align: center; cursor: pointer; border: 1px solid #f3f4f6; transition: 0.2s; box-shadow: 0 5px 15px rgba(0,0,0,0.03); }
        .menu-item:active { transform: scale(0.95); background: #ecfdf5; }
        .menu-item i { font-size: 24px; margin-bottom: 8px; display: block; }
        .menu-item span { font-size: 10px; font-weight: 700; color: #4b5563; }

        /* LISTS & CARDS */
        .list-area { padding: 0 20px 30px; }
        .card { background: white; border-radius: 25px; padding: 20px; border: 1px solid #e5e7eb; box-shadow: var(--card-shadow); margin-bottom: 15px; }
        
        .user-row { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-radius: 15px; background: #f9fafb; margin-bottom: 10px; border: 1px solid #eee; }
        .badge { padding: 4px 10px; border-radius: 10px; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        .badge-pending { background: #FEF3C7; color: #D97706; }
        .badge-success { background: #D1FAE5; color: #059669; }
        .badge-danger { background: #FEE2E2; color: #EF4444; }

        /* MODALS */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 2000; display: none; justify-content: center; align-items: center; padding: 20px; }
        .modal-box { background: white; width: 100%; max-width: 400px; padding: 30px; border-radius: 30px; box-shadow: 0 30px 60px rgba(0,0,0,0.3); max-height: 85vh; overflow-y: auto; }
        .inp { width: 100%; padding: 15px; border: 1.5px solid #e5e7eb; border-radius: 15px; margin-bottom: 15px; font-size: 15px; background: #f9fafb; }
        .btn-full { width: 100%; padding: 15px; border: none; border-radius: 15px; font-weight: 700; cursor: pointer; margin-bottom: 10px; font-size: 15px; }
        .btn-approve { background: var(--primary); color: white; }
        .btn-reject { background: var(--danger); color: white; }

        /* NAVIGATION */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(255,255,255,0.95); padding: 12px 20px; display: flex; justify-content: space-around; border-top: 1px solid #e5e7eb; z-index: 1000; backdrop-filter: blur(10px); border-radius: 30px 30px 0 0; box-shadow: 0 -10px 30px rgba(0,0,0,0.05); }
        .nav-btn { text-align: center; color: #6b7280; font-size: 10px; font-weight: 700; cursor: pointer; transition: 0.3s; }
        .nav-btn.active { color: var(--primary); transform: translateY(-5px); }
        .nav-btn i { font-size: 24px; margin-bottom: 5px; display: block; }
    </style>
</head>
<body>

    <div id="splash-screen">
        <i class="fas fa-tree growing-tree"></i>
        <h1 style="color:var(--text-main);font-weight:900;margin:0;font-size:35px">‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ó‡¶æ‡¶õ</h1>
        <small style="color:var(--text-muted);font-weight:700">ADMIN PANEL V5.2</small>
    </div>

    <div id="auth-view">
        <div class="login-box">
            <i class="fas fa-shield-alt" style="font-size:50px;color:var(--primary);margin-bottom:20px"></i>
            <h2 style="margin-bottom:10px">Admin Access</h2>
            <p style="opacity:0.6;margin-bottom:30px">‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡ßü‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            <input id="u_name" type="text" placeholder="Username">
            <input id="u_pass" type="password" placeholder="Password">
            <button onclick="adminLogin()">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <div id="admin-dashboard" style="display:none">
        
        <div class="header">
            <h2>‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ó‡¶æ‡¶õ <span style="font-size:12px;color:#999">ADMIN</span></h2>
            <div onclick="location.reload()" style="width:40px;height:40px;background:#f3f4f6;border-radius:50%;display:flex;justify-content:center;align-items:center;cursor:pointer"><i class="fas fa-sync-alt" style="color:var(--primary)"></i></div>
        </div>

        <div id="home-view" class="view-panel">
            <div class="stats-grid">
                <div class="stat-card"><h1 id="stat-users">0</h1><p>‡¶Æ‡ßã‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</p></div>
                <div class="stat-card" style="border-color:#3b82f6"><h1 id="stat-bal">‡ß≥0</h1><p>‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p></div>
                <div class="stat-card" style="border-color:#10b981"><h1 id="stat-dep" style="color:#10b981">‡ß≥0</h1><p>‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</p></div>
                <div class="stat-card" style="border-color:#ef4444"><h1 id="stat-wd" style="color:#ef4444">‡ß≥0</h1><p>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</p></div>
            </div>

            <div class="profit-card">
                <small style="opacity:0.7;text-transform:uppercase;letter-spacing:2px">‡¶®‡ßá‡¶ü ‡¶™‡ßç‡¶∞‡¶´‡¶ø‡¶ü (Net Profit)</small>
                <h1 id="stat-profit">‡ß≥0</h1>
            </div>

            <div class="menu-grid">
                <div class="menu-item" onclick="showSection('users')"><i class="fas fa-users" style="color:#3b82f6"></i><span>‡¶á‡¶â‡¶ú‡¶æ‡¶∞</span></div>
                <div class="menu-item" onclick="showSection('deposits')"><i class="fas fa-wallet" style="color:#10b981"></i><span>‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</span></div>
                <div class="menu-item" onclick="showSection('withdraws')"><i class="fas fa-money-check-alt" style="color:#ef4444"></i><span>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</span></div>
                <div class="menu-item" onclick="showSection('tasks')"><i class="fas fa-check-double" style="color:#8b5cf6"></i><span>‡¶ú‡¶¨ ‡¶ö‡ßá‡¶ï</span></div>
                <div class="menu-item" onclick="showSection('history')"><i class="fas fa-history" style="color:#6b7280"></i><span>‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø</span></div>
                <div class="menu-item" onclick="showSection('settings')"><i class="fas fa-cog" style="color:#1f2937"></i><span>‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</span></div>
                <div class="menu-item" onclick="adminLogout()"><i class="fas fa-power-off" style="color:red"></i><span>‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</span></div>
            </div>

            <div class="list-area">
                <div class="card">
                    <h3 style="margin-bottom:15px;font-size:18px">‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®</h3>
                    <div id="recent-hist-list">‡¶≤‡ßã‡¶°‡¶ø‡¶Ç...</div>
                </div>
            </div>
        </div>

        <div id="dynamic-view" class="view-panel" style="display:none;padding:20px">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:25px">
                <h2 id="page-title" style="margin:0;font-weight:800;color:var(--text-main)">...</h2>
                <button onclick="backHome()" style="background:#374151;color:white;border:none;padding:8px 20px;border-radius:12px;font-weight:700">‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï</button>
            </div>
            <div id="page-content"></div>
        </div>

        <div class="bottom-nav">
            <div class="nav-btn active" onclick="backHome()"><i class="fas fa-home"></i>‡¶π‡ßã‡¶Æ</div>
            <div class="nav-btn" onclick="showSection('users')"><i class="fas fa-users"></i>‡¶á‡¶â‡¶ú‡¶æ‡¶∞</div>
            <div class="nav-btn" onclick="showSection('tasks')"><i class="fas fa-check-circle"></i>‡¶ú‡¶¨</div>
            <div class="nav-btn" onclick="showSection('settings')"><i class="fas fa-cog"></i>‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</div>
        </div>
    </div>

    <div id="user-modal" class="modal">
        <div class="modal-box">
            <h3 id="m-user-name">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶è‡¶°‡¶ø‡¶ü</h3>
            <p id="m-user-phone" style="font-size:12px;color:#666;margin-bottom:20px">...</p>
            <input id="e-bal" class="inp" type="number" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏">
            <input id="e-pass" class="inp" type="text" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
            <div style="display:flex;gap:10px">
                <button class="btn-full" id="ban-btn" onclick="toggleBan()" style="background:#374151;color:white">‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button class="btn-full btn-approve" onclick="saveUserUpdate()">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
            <button onclick="closeModal('user-modal')" style="width:100%;background:transparent;border:none;color:#999;cursor:pointer;margin-top:10px">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>
    <script>
        // 1. FIREBASE CONFIGURATION
        const firebaseConfig = { 
            apiKey: "AIzaSyDgI-d8iwWr40tmknbY6jhH0oRb2Tvg4d0", 
            authDomain: "takar-gach-a1d84.firebaseapp.com", 
            databaseURL: "https://takar-gach-a1d84-default-rtdb.firebaseio.com", 
            projectId: "takar-gach-a1d84", 
            storageBucket: "takar-gach-a1d84.firebasestorage.app", 
            messagingSenderId: "637802367074", 
            appId: "1:637802367074:web:2e7f6c0670ec47f3a1693b" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let USERS = {}, GLOBAL_HISTORY = [];

        // 2. AUTHENTICATION (JIHAD / 198373)
        function adminLogin() {
            const u = document.getElementById('u_name').value;
            const p = document.getElementById('u_pass').value;
            
            if(u === "JIHAD" && p === "198373") {
                sessionStorage.setItem('admin_token', 'SECURE_ACCESS_V5');
                location.reload();
            } else {
                Swal.fire('Error', 'Username or Password Incorrect!', 'error');
            }
        }

        window.onload = () => {
            setTimeout(() => {
                document.getElementById('splash-screen').style.display = 'none';
                if(sessionStorage.getItem('admin_token') === 'SECURE_ACCESS_V5') {
                    document.getElementById('admin-dashboard').style.display = 'block';
                    initData();
                } else {
                    document.getElementById('auth-view').style.display = 'flex';
                }
            }, 2000);
        };

        // 3. DATA LOADING & PROCESSING
        function initData() {
            db.ref('users').on('value', snap => {
                USERS = snap.val() || {};
                processData();
            });
        }

        function processData() {
            let totalUsers = 0, totalBal = 0, totalDep = 0, totalWd = 0;
            GLOBAL_HISTORY = [];

            Object.keys(USERS).forEach(uid => {
                const u = USERS[uid];
                totalUsers++;
                totalBal += (u.balance || 0);

                if(u.history) {
                    Object.keys(u.history).forEach(hid => {
                        const h = u.history[hid];
                        // Add to Global History Array
                        GLOBAL_HISTORY.push({
                            ...h,
                            uid: uid,
                            hid: hid,
                            userName: u.name,
                            userPhone: u.phone
                        });

                        // Calculate Stats
                        if(h.status === 'Success') {
                            if(h.type.includes('Buy')) totalDep += parseInt(h.amount);
                            if(h.type === 'Withdraw') totalWd += parseInt(h.amount);
                        }
                    });
                }
            });

            // Sort History by Date (Newest First)
            GLOBAL_HISTORY.sort((a, b) => new Date(b.date) - new Date(a.date));

            // Update UI Stats
            document.getElementById('stat-users').innerText = totalUsers;
            document.getElementById('stat-bal').innerText = '‡ß≥' + totalBal;
            document.getElementById('stat-dep').innerText = '‡ß≥' + totalDep;
            document.getElementById('stat-wd').innerText = '‡ß≥' + totalWd;
            document.getElementById('stat-profit').innerText = '‡ß≥' + (totalDep - totalWd);

            // Render Recent History on Home
            renderRecentHistory();
            
            // Refresh current view if active
            const currentSection = document.getElementById('page-title').innerText;
            if(document.getElementById('dynamic-view').style.display === 'block') {
                if(currentSection.includes('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü')) renderReqs('Buy');
                else if(currentSection.includes('‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞')) renderReqs('Withdraw');
                else if(currentSection.includes('‡¶ú‡¶¨')) renderReqs('Task');
                else if(currentSection.includes('‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø')) renderFullHistory();
                else if(currentSection.includes('‡¶á‡¶â‡¶ú‡¶æ‡¶∞')) renderUsers();
            }
        }

        function renderRecentHistory() {
            const c = document.getElementById('recent-hist-list');
            if(GLOBAL_HISTORY.length === 0) return c.innerHTML = '<p style="text-align:center;color:#999">‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶®‡ßá‡¶á</p>';
            
            c.innerHTML = GLOBAL_HISTORY.slice(0, 10).map(h => `
                <div class="user-row">
                    <div><b>${h.userName}</b><br><small>${h.type} ‚Ä¢ ${h.date.split(',')[0]}</small></div>
                    <div style="text-align:right">
                        <b>‡ß≥${h.amount}</b><br>
                        <span class="badge ${h.status==='Success'?'badge-success':(h.status==='Pending'?'badge-pending':'badge-danger')}">${h.status}</span>
                    </div>
                </div>
            `).join('');
        }

        // 4. NAVIGATION & SECTIONS
        function showSection(sec) {
            document.getElementById('home-view').style.display = 'none';
            document.getElementById('dynamic-view').style.display = 'block';
            const title = document.getElementById('page-title');
            
            if(sec === 'users') { title.innerText = '‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü'; renderUsers(); }
            else if(sec === 'deposits') { title.innerText = '‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü'; renderReqs('Buy'); }
            else if(sec === 'withdraws') { title.innerText = '‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü'; renderReqs('Withdraw'); }
            else if(sec === 'tasks') { title.innerText = '‡¶ú‡¶¨ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®'; renderReqs('Task'); }
            else if(sec === 'history') { title.innerText = '‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø'; renderFullHistory(); }
            else if(sec === 'settings') { title.innerText = '‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏'; renderSettings(); }
        }

        function backHome() {
            document.getElementById('dynamic-view').style.display = 'none';
            document.getElementById('home-view').style.display = 'block';
        }

        // 5. USER MANAGEMENT
        function renderUsers() {
            const c = document.getElementById('page-content');
            c.innerHTML = `<input type="text" class="inp" placeholder="‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." onkeyup="filterUser(this.value)"><div id="u-list"></div>`;
            const list = document.getElementById('u-list');
            
            Object.values(USERS).reverse().forEach(u => {
                list.innerHTML += `
                <div class="user-row u-item" data-s="${u.name} ${u.phone}">
                    <div><b>${u.name}</b> ${u.banned ? 'üî¥' : 'üü¢'}<br><small>${u.phone}</small></div>
                    <div style="text-align:right"><b>‡ß≥${u.balance}</b><br><button class="btn-full" style="padding:5px 15px;font-size:12px;width:auto;margin:0" onclick="editUser('${u.phone}')">Manage</button></div>
                </div>`;
            });
        }

        function editUser(phone) {
            const u = USERS[phone];
            document.getElementById('m-user-name').innerText = u.name;
            document.getElementById('m-user-phone').innerText = phone;
            document.getElementById('e-bal').value = u.balance;
            document.getElementById('e-pass').value = u.pass;
            document.getElementById('ban-btn').innerText = u.banned ? "‡¶Ü‡¶®‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®" : "‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";
            document.getElementById('ban-btn').style.background = u.banned ? "#10B981" : "#EF4444";
            openModal('user-modal');
        }

        function saveUserUpdate() {
            const phone = document.getElementById('m-user-phone').innerText;
            db.ref('users/'+phone).update({
                balance: parseInt(document.getElementById('e-bal').value),
                pass: document.getElementById('e-pass').value
            });
            closeModal('user-modal'); Swal.fire('Saved!', '', 'success');
        }

        function toggleBan() {
            const phone = document.getElementById('m-user-phone').innerText;
            const status = USERS[phone].banned || false;
            db.ref('users/'+phone).update({ banned: !status });
            closeModal('user-modal'); Swal.fire('Done!', '', 'success');
        }

        // 6. REQUEST HANDLING (VIP, WITHDRAW, TASK)
        function renderReqs(type) {
            const list = GLOBAL_HISTORY.filter(h => h.type.includes(type) && h.status === 'Pending');
            const c = document.getElementById('page-content');
            
            if(list.length === 0) return c.innerHTML = '<p style="text-align:center;padding:50px;color:#999">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á</p>';
            
            c.innerHTML = list.map(h => `
                <div class="card">
                    <div style="display:flex;justify-content:space-between"><b>${h.userName}</b> <span class="badge badge-pending">${h.type}</span></div>
                    <div style="margin:15px 0;font-size:14px;color:#555">
                        ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£: <b>‡ß≥${h.amount}</b><br>
                        ‡¶§‡¶•‡ßç‡¶Ø: ${h.trx || h.sender || 'N/A'}<br>
                        ${h.proof ? `‡¶™‡ßç‡¶∞‡ßÅ‡¶´: <a href="${h.proof}" target="_blank" style="color:blue">‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</a>` : ''}
                    </div>
                    <div style="display:flex;gap:10px">
                        <button class="btn-full btn-approve" onclick="approveReq('${h.uid}', '${h.hid}', '${h.type}', ${h.amount}, ${h.validity||0})">Approve</button>
                        <button class="btn-full btn-reject" onclick="rejectReq('${h.uid}', '${h.hid}')">Reject</button>
                    </div>
                </div>
            `).join('');
        }

        function approveReq(uid, hid, type, amount, validity) {
            Swal.fire({title:'‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?', showCancelButton:true, confirmButtonText:'‡¶π‡ßç‡¶Ø‡¶æ‡¶Å'}).then(res => {
                if(res.isConfirmed) {
                    const updates = {};
                    updates[`users/${uid}/history/${hid}/status`] = "Success";
                    
                    if(type.includes('Buy')) { // VIP Approval
                        updates[`users/${uid}/isVip`] = true;
                        updates[`users/${uid}/currentPlan`] = type.replace('Buy ', '');
                        updates[`users/${uid}/vipExpire`] = Date.now() + (validity * 86400000); // Days to Ms
                    } else if(type.includes('Task')) { // Task Approval
                        const curBal = USERS[uid].balance || 0;
                        updates[`users/${uid}/balance`] = curBal + parseInt(amount);
                    }
                    // Withdraw balance is deducted beforehand, so no balance update needed here.

                    db.ref().update(updates);
                    Swal.fire('Success', '‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
                }
            });
        }

        function rejectReq(uid, hid) {
            Swal.fire({title:'‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£', input:'text', showCancelButton:true, confirmButtonText:'‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü'}).then(res => {
                if(res.value) {
                    db.ref(`users/${uid}/history/${hid}`).update({
                        status: "Rejected",
                        reason: res.value
                    });
                    
                    // Optional: Refund if Withdraw is rejected
                    const h = USERS[uid].history[hid];
                    if(h.type === 'Withdraw') {
                        db.ref(`users/${uid}/balance`).set((USERS[uid].balance || 0) + parseInt(h.amount) + 5); // Refund + Charge
                    }

                    Swal.fire('Rejected', '‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡•§', 'error');
                }
            });
        }

        // 7. FULL HISTORY
        function renderFullHistory() {
            const c = document.getElementById('page-content');
            c.innerHTML = '<div class="card" style="padding:10px">' + GLOBAL_HISTORY.map(h => `
                <div class="user-row" style="border-bottom:1px solid #eee">
                    <div><b>${h.userName}</b><br><small>${h.type}</small></div>
                    <div style="text-align:right"><b>‡ß≥${h.amount}</b><br><span style="font-size:10px;color:${h.status=='Success'?'green':'red'}">${h.status}</span></div>
                </div>
            `).join('') + '</div>';
        }

        // 8. SETTINGS
        function renderSettings() {
            db.ref('settings').once('value', s => {
                const v = s.val() || {};
                document.getElementById('page-content').innerHTML = `
                <div class="card">
                    <label>‡¶®‡ßã‡¶ü‡¶ø‡¶∂</label><textarea id="s-not" class="inp" style="height:80px">${v.notice||''}</textarea>
                    <label>‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</label><input id="s-bk" class="inp" value="${v.bkash||''}">
                    <label>‡¶®‡¶ó‡¶¶</label><input id="s-ng" class="inp" value="${v.nagad||''}">
                    <button class="btn-full btn-approve" onclick="saveSet()">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>`;
            });
        }
        function saveSet(){
            db.ref('settings').update({
                notice: document.getElementById('s-not').value,
                bkash: document.getElementById('s-bk').value,
                nagad: document.getElementById('s-ng').value
            });
            Swal.fire('Saved!', '', 'success');
        }

        // UTILS
        function openModal(id) { document.getElementById(id).style.display='flex'; }
        function closeModal(id) { document.getElementById(id).style.display='none'; }
        function adminLogout() { sessionStorage.clear(); location.reload(); }
        function filterUser(v) {
            const t = v.toLowerCase();
            document.querySelectorAll('.u-item').forEach(e => {
                e.style.display = e.getAttribute('data-s').toLowerCase().includes(t) ? 'flex' : 'none';
            });
        }
    </script>
</body>
</html>
