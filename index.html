<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin V8 - Professional</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; outline: none; font-family: 'Poppins', 'Hind Siliguri', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: #f3f4f6; margin: 0; color: #1f2937; height: 100vh; display: flex; flex-direction: column; }

        /* TOAST */
        #toast-box { position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { background: white; padding: 15px 20px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 12px; animation: slideIn 0.3s; pointer-events: auto; border-left: 5px solid #10b981; font-size: 14px; font-weight: 500; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* LOGIN */
        #login-view { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #ffffff; z-index: 5000; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .login-box { width: 90%; max-width: 350px; text-align: center; }
        .login-logo { font-size: 50px; color: #10b981; margin-bottom: 20px; }
        
        /* DASHBOARD LAYOUT */
        .header { background: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #e5e7eb; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        .brand { font-weight: 700; font-size: 20px; color: #064e3b; display: flex; align-items: center; gap: 10px; }
        
        .main-content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 80px; }
        .page { display: none; animation: fadeUp 0.3s; }
        .page.active { display: block; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* CARDS & STATS */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 16px; border: 1px solid #e5e7eb; position: relative; overflow: hidden; }
        .stat-num { font-size: 28px; font-weight: 700; color: #1f2937; margin: 0; }
        .stat-label { font-size: 13px; color: #6b7280; font-weight: 500; }
        .stat-icon { position: absolute; right: -10px; bottom: -10px; font-size: 60px; opacity: 0.1; color: #10b981; }

        .card { background: white; border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid #e5e7eb; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .card-title { font-size: 16px; font-weight: 600; margin: 0 0 15px 0; color: #374151; display: flex; align-items: center; gap: 8px; }

        /* INPUTS */
        .inp-group { margin-bottom: 15px; }
        .label { display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 5px; }
        .inp { width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 10px; font-size: 14px; background: #f9fafb; transition: 0.2s; }
        .inp:focus { border-color: #10b981; background: white; box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1); }
        
        /* BUTTONS */
        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px; font-weight: 600; font-size: 14px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: #10b981; color: white; } .btn-primary:active { background: #059669; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-icon { padding: 8px; border-radius: 8px; font-size: 14px; width: auto; }

        /* LIST ITEMS */
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #f3f4f6; border-radius: 12px; margin-bottom: 10px; background: #f9fafb; transition: 0.2s; }
        .list-item:hover { border-color: #10b981; background: white; }

        /* BOTTOM NAV */
        .nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 15px; border-top: 1px solid #e5e7eb; z-index: 100; box-shadow: 0 -5px 20px rgba(0,0,0,0.03); }
        .nav-item { color: #9ca3af; font-size: 20px; cursor: pointer; transition: 0.2s; padding: 10px; border-radius: 12px; }
        .nav-item.active { color: #10b981; background: #ecfdf5; }

        /* MODAL */
        .modal-bg { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center; backdrop-filter: blur(3px); }
        .modal { background: white; width: 90%; max-width: 350px; border-radius: 20px; padding: 25px; animation: popIn 0.3s; }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    </style>
</head>
<body>
    <div id="toast-box"></div>

    <div id="login-view">
        <div class="login-box">
            <i class="fas fa-cube login-logo"></i>
            <h2 style="margin:0 0 10px 0;">Admin V8</h2>
            <p style="color:#6b7280; margin-bottom: 30px; font-size: 14px;">Professional Control Panel</p>
            <div class="inp-group"><input type="text" id="l-user" class="inp" placeholder="Username"></div>
            <div class="inp-group"><input type="password" id="l-pass" class="inp" placeholder="Password"></div>
            <button class="btn btn-primary" onclick="doLogin()">ACCESS DASHBOARD</button>
        </div>
    </div>

    <div id="main-view" style="display:none;">
        <div class="header">
            <div class="brand"><i class="fas fa-cube"></i> Takar Gach</div>
            <div style="font-size:12px; color:#6b7280;">Super Admin</div>
        </div>

        <div class="main-content">
            <div id="home" class="page active">
                <div class="grid-2">
                    <div class="stat-card">
                        <h1 class="stat-num" id="st-users">0</h1>
                        <span class="stat-label">Total Users</span>
                        <i class="fas fa-users stat-icon"></i>
                    </div>
                    <div class="stat-card">
                        <h1 class="stat-num" id="st-pending" style="color:#f59e0b;">0</h1>
                        <span class="stat-label">Pending</span>
                        <i class="fas fa-clock stat-icon" style="color:#f59e0b;"></i>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title"><i class="fas fa-bullhorn" style="color:#10b981;"></i> Update Notice</div>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="notice-txt" class="inp" placeholder="Write notice here..." style="margin:0;">
                        <button class="btn btn-primary" style="width:auto;" onclick="updateNotice()">Post</button>
                    </div>
                </div>

                <h4 style="margin: 15px 0 10px 0; color:#6b7280;">Payment Requests</h4>
                <div id="req-list"></div>
            </div>

            <div id="users" class="page">
                <div class="card">
                    <input type="text" id="search-inp" class="inp" placeholder="üîç Search User (Phone)" onkeyup="searchUser()" style="margin:0;">
                </div>
                <div id="user-result"></div>
            </div>

            <div id="tasks" class="page">
                <div class="card" style="border-left: 4px solid #ec4899;">
                    <div class="card-title" style="color:#ec4899;"><i class="fas fa-crown"></i> Create VIP Plan</div>
                    <div class="inp-group"><input type="text" id="p-name" class="inp" placeholder="Plan Name (e.g. Platinum)"></div>
                    <div class="grid-2" style="margin-bottom:0;">
                        <div class="inp-group"><label class="label">Price</label><input type="number" id="p-price" class="inp" placeholder="500"></div>
                        <div class="inp-group"><label class="label">Daily Income</label><input type="number" id="p-daily" class="inp" placeholder="25"></div>
                    </div>
                    <div class="inp-group"><label class="label">Validity (Days)</label><input type="number" id="p-valid" class="inp" placeholder="30"></div>
                    <button class="btn" style="background:#ec4899; color:white;" onclick="addPlan()">Create Plan</button>
                </div>
                
                <h4 style="margin:20px 0 10px 0;">Current Plans</h4>
                <div id="plan-list"></div>

                <hr style="border:0; border-top:1px solid #e5e7eb; margin:30px 0;">

                <div class="card">
                    <div class="card-title"><i class="fas fa-tasks" style="color:#3b82f6;"></i> Add Social Task</div>
                    <div class="inp-group"><input type="text" id="t-title" class="inp" placeholder="Task Title (e.g. Follow Page)"></div>
                    <div class="grid-2" style="margin-bottom:0;">
                        <div class="inp-group"><label class="label">Reward</label><input type="number" id="t-reward" class="inp" placeholder="Tk"></div>
                        <div class="inp-group">
                            <label class="label">Platform</label>
                            <select id="t-type" class="inp">
                                <option value="telegram">Telegram</option>
                                <option value="youtube">YouTube</option>
                                <option value="facebook">Facebook</option>
                                <option value="instagram">Instagram</option>
                                <option value="tiktok">TikTok</option>
                                <option value="twitter">Twitter</option>
                            </select>
                        </div>
                    </div>
                    <div class="inp-group"><input type="text" id="t-link" class="inp" placeholder="Link URL"></div>
                    <button class="btn btn-primary" onclick="addTask()">Publish Task</button>
                </div>
                <h4 style="margin:20px 0 10px 0;">Live Tasks</h4>
                <div id="task-list"></div>
            </div>

            <div id="settings" class="page">
                <div class="card">
                    <div class="card-title">‚öôÔ∏è App Configuration</div>
                    
                    <div class="inp-group">
                        <label class="label">Bkash Number</label>
                        <div style="display:flex; gap:5px;">
                            <input type="text" id="set-bkash" class="inp" style="margin:0;">
                            <button class="btn btn-primary" style="width:auto;" onclick="saveSet('bkash')">Save</button>
                        </div>
                    </div>

                    <div class="inp-group">
                        <label class="label">Nagad Number</label>
                        <div style="display:flex; gap:5px;">
                            <input type="text" id="set-nagad" class="inp" style="margin:0;">
                            <button class="btn btn-primary" style="width:auto;" onclick="saveSet('nagad')">Save</button>
                        </div>
                    </div>

                    <div class="inp-group">
                        <label class="label">Support Link</label>
                        <div style="display:flex; gap:5px;">
                            <input type="text" id="set-support" class="inp" style="margin:0;">
                            <button class="btn btn-primary" style="width:auto;" onclick="saveSet('support')">Save</button>
                        </div>
                    </div>

                    <div style="display:flex; justify-content:space-between; align-items:center; background:#fee2e2; padding:15px; border-radius:12px; margin-top:20px;">
                        <div style="color:#991b1b; font-weight:600;">Maintenance Mode</div>
                        <input type="checkbox" id="maint-check" onchange="toggleMaint()" style="width:20px; height:20px;">
                    </div>
                </div>
                <button class="btn btn-danger" onclick="location.reload()">Logout</button>
            </div>
        </div>

        <div class="nav">
            <div class="nav-item active" onclick="nav('home', this)"><i class="fas fa-th-large"></i></div>
            <div class="nav-item" onclick="nav('users', this)"><i class="fas fa-users"></i></div>
            <div class="nav-item" onclick="nav('tasks', this)"><i class="fas fa-layer-group"></i></div>
            <div class="nav-item" onclick="nav('settings', this)"><i class="fas fa-cog"></i></div>
        </div>
    </div>

    <div id="user-modal" class="modal-bg">
        <div class="modal">
            <div style="text-align:right;"><i class="fas fa-times" style="cursor:pointer; color:#9ca3af;" onclick="document.getElementById('user-modal').style.display='none'"></i></div>
            <div style="text-align:center; margin-bottom:20px;">
                <div style="width:60px; height:60px; background:#d1fae5; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; color:#10b981; font-size:24px; margin-bottom:10px;"><i class="fas fa-user"></i></div>
                <h3 id="m-name" style="margin:0; color:#1f2937;">Name</h3>
                <span id="m-plan" style="background:#f3f4f6; padding:3px 10px; border-radius:20px; font-size:12px; color:#6b7280;">Free Plan</span>
            </div>
            <div style="background:#f9fafb; padding:15px; border-radius:12px; margin-bottom:20px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:8px;"><span style="color:#6b7280; font-size:13px;">Phone</span> <b id="m-phone" style="font-size:13px;">...</b></div>
                <div style="display:flex; justify-content:space-between; margin-bottom:8px;"><span style="color:#6b7280; font-size:13px;">Password</span> <b id="m-pass" style="font-size:13px; color:#ef4444;">...</b></div>
                <div style="display:flex; justify-content:space-between;"><span style="color:#6b7280; font-size:13px;">Balance</span> <b id="m-bal" style="font-size:15px; color:#10b981;">0</b></div>
            </div>
            <div class="grid-2">
                <button class="btn btn-primary" onclick="editBal('add')">+ Add</button>
                <button class="btn btn-danger" onclick="editBal('sub')">- Cut</button>
            </div>
            <input type="hidden" id="m-uid">
        </div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyDgI-d8iwWr40tmknbY6jhH0oRb2Tvg4d0", authDomain: "takar-gach-a1d84.firebaseapp.com", databaseURL: "https://takar-gach-a1d84-default-rtdb.firebaseio.com", projectId: "takar-gach-a1d84", storageBucket: "takar-gach-a1d84.firebasestorage.app", messagingSenderId: "637802367074", appId: "1:637802367074:web:2e7f6c0670ec47f3a1693b", measurementId: "G-0QL9LB7BSK" };
        try { firebase.initializeApp(firebaseConfig); } catch(e) {}
        const db = firebase.database();

        function toast(m, t='s') {
            const b = document.getElementById('toast-box');
            const el = document.createElement('div');
            el.className = 'toast';
            el.style.borderLeftColor = t==='e'?'#ef4444':'#10b981';
            el.innerHTML = `<i class="fas ${t==='e'?'fa-exclamation-circle':'fa-check-circle'}" style="color:${t==='e'?'#ef4444':'#10b981'}"></i> ${m}`;
            b.appendChild(el); setTimeout(()=>el.remove(), 3000);
        }

        function doLogin() {
            if(document.getElementById('l-user').value === 'JIHAD' && document.getElementById('l-pass').value === '198373ZA') {
                document.getElementById('login-view').style.display='none';
                document.getElementById('main-view').style.display='flex';
                init();
            } else toast('Invalid Credentials', 'e');
        }

        function nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
        }

        function init() {
            // USERS & REQUESTS
            db.ref('users').on('value', s => {
                const u = s.val() || {};
                document.getElementById('st-users').innerText = Object.keys(u).length;
                let p = 0; const rl = document.getElementById('req-list'); rl.innerHTML='';
                
                Object.keys(u).forEach(uid => {
                    if(u[uid].history) {
                        Object.keys(u[uid].history).forEach(k => {
                            const h = u[uid].history[k];
                            if(h.status === 'Pending') {
                                p++;
                                rl.innerHTML += `
                                <div class="list-item">
                                    <div><b style="font-size:14px;">${u[uid].name}</b><br><small style="color:#6b7280;">${h.type} - ‡ß≥${h.amount}</small></div>
                                    <div style="display:flex; gap:5px;">
                                        <button class="btn-icon btn-primary" onclick="setStatus('${uid}','${k}','Success','${h.type}')"><i class="fas fa-check"></i></button>
                                        <button class="btn-icon btn-danger" onclick="setStatus('${uid}','${k}','Rejected','${h.type}')"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>`;
                            }
                        });
                    }
                });
                if(p===0) rl.innerHTML='<p style="text-align:center; color:#d1d5db;">No pending requests</p>';
                document.getElementById('st-pending').innerText = p;
            });

            // LOAD TASKS & PLANS
            db.ref('settings/tasks').on('value', s => {
                const l = document.getElementById('task-list'); l.innerHTML='';
                const t = s.val() || {};
                Object.keys(t).forEach(k => {
                    l.innerHTML += `<div class="list-item"><div><b>${t[k].title}</b><br><small class="stat-label">‡ß≥${t[k].reward}</small></div><i class="fas fa-trash" style="color:#ef4444; cursor:pointer;" onclick="db.ref('settings/tasks/${k}').remove()"></i></div>`;
                });
            });

            db.ref('settings/vipPlans').on('value', s => {
                const l = document.getElementById('plan-list'); l.innerHTML='';
                const p = s.val() || {};
                Object.keys(p).forEach(k => {
                    l.innerHTML += `<div class="list-item" style="border-left:4px solid #ec4899;"><div><b>${p[k].name}</b><br><small>‡ß≥${p[k].price} | ${p[k].validity} Days</small></div><i class="fas fa-trash" style="color:#ef4444; cursor:pointer;" onclick="db.ref('settings/vipPlans/${k}').remove()"></i></div>`;
                });
            });

            // SETTINGS
            db.ref('settings/config').once('value', s => {
                const c = s.val() || {};
                if(c.bkash) document.getElementById('set-bkash').value = c.bkash;
                if(c.nagad) document.getElementById('set-nagad').value = c.nagad;
                if(c.support) document.getElementById('set-support').value = c.support;
                if(c.maint) document.getElementById('maint-check').checked = c.maint;
            });
        }

        // ACTIONS
        function updateNotice() { db.ref('settings/notice').set(document.getElementById('notice-txt').value); toast('Notice Updated'); }
        
        function addTask() {
            const t=document.getElementById('t-title').value, r=document.getElementById('t-reward').value, l=document.getElementById('t-link').value, ty=document.getElementById('t-type').value;
            if(!t||!r) return toast('Fill all fields', 'e');
            const colors = {telegram:'#229ED9', youtube:'red', facebook:'#1877F2', instagram:'#E1306C', tiktok:'#000000', twitter:'#1DA1F2'};
            db.ref('settings/tasks').push({ title:t, reward:parseInt(r), link:l, type:ty, icon:ty, color:colors[ty] });
            toast('Task Published');
        }

        function addPlan() {
            const n=document.getElementById('p-name').value, p=document.getElementById('p-price').value, d=document.getElementById('p-daily').value, v=document.getElementById('p-valid').value;
            if(!n||!p) return toast('Fill all fields', 'e');
            db.ref('settings/vipPlans').push({ name:n, price:parseInt(p), dailyIncome:parseInt(d), validity:parseInt(v) });
            toast('VIP Plan Created');
        }

        function setStatus(uid, k, st, type) {
            if(!confirm('Are you sure?')) return;
            const up={}; up[`users/${uid}/history/${k}/status`] = st;
            if(st==='Success' && type.includes('Buy')) {
                up[`users/${uid}/isVip`] = true;
                up[`users/${uid}/currentPlan`] = type.replace('Buy ', '');
                up[`users/${uid}/vipExpiry`] = Date.now() + (30*86400000); 
            }
            db.ref().update(up); toast('Status Updated');
        }

        function saveSet(k) { db.ref('settings/config/'+k).set(document.getElementById('set-'+k).value); toast('Saved!'); }
        function toggleMaint() { const s=document.getElementById('maint-check').checked; db.ref('settings/config/maint').set(s); toast('Maintenance '+(s?'ON':'OFF')); }

        function searchUser() {
            const q=document.getElementById('search-inp').value;
            const r=document.getElementById('user-result'); r.innerHTML='';
            if(q.length<5) return;
            db.ref('users/'+q).once('value', s=>{
                if(s.exists()){
                    const u=s.val();
                    r.innerHTML=`<div class="list-item" onclick="openU('${q}','${u.name}','${u.phone}','${u.pass}',${u.balance},'${u.currentPlan||'Free'}')" style="cursor:pointer;"><b>${u.name}</b> <b style="color:#10b981;">‡ß≥${u.balance}</b></div>`;
                } else r.innerHTML='<p style="text-align:center; color:#9ca3af;">Not found</p>';
            });
        }

        function openU(uid,n,p,pass,b,plan) {
            document.getElementById('m-uid').value=uid;
            document.getElementById('m-name').innerText=n;
            document.getElementById('m-phone').innerText=p;
            document.getElementById('m-pass').innerText=pass;
            document.getElementById('m-bal').innerText=b;
            document.getElementById('m-plan').innerText=plan;
            document.getElementById('user-modal').style.display='flex';
        }

        function editBal(act) {
            const uid=document.getElementById('m-uid').value;
            const cur=parseInt(document.getElementById('m-bal').innerText);
            const amt=prompt('Enter Amount:'); if(!amt) return;
            const nb = act==='add'?cur+parseInt(amt):cur-parseInt(amt);
            db.ref('users/'+uid).update({balance:nb});
            document.getElementById('m-bal').innerText=nb; toast('Balance Updated');
        }
    </script>
</body>
</html>

