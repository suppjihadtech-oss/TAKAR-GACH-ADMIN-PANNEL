<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Takar Gach Admin V3.1 Platinum</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #10b981; --dark: #0f172a; --dark-sec: #1e293b; --light: #f1f5f9; --white: #ffffff;
            --sidebar-w: 260px;
        }
        * { box-sizing: border-box; outline: none; text-decoration: none; font-family: 'Inter', 'Hind Siliguri', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--light); height: 100vh; overflow: hidden; display: flex; color: var(--dark); }

        /* --- AUTH SCREEN --- */
        #auth-view { position: fixed; inset: 0; background: var(--dark); z-index: 9999; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .login-box { background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(10px); padding: 40px 30px; border-radius: 20px; width: 100%; max-width: 350px; text-align: center; color: white; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .inp { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #334155; border-radius: 10px; font-size: 15px; background: #0f172a; color: white; transition: 0.3s; }
        .inp:focus { border-color: var(--primary); }
        .btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3); }
        .btn:active { transform: scale(0.98); }

        /* --- SIDEBAR (SCREENSHOT STYLE) --- */
        .sidebar {
            position: fixed; top: 0; left: -280px; width: var(--sidebar-w); height: 100%; 
            background: var(--dark); color: white; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            z-index: 1000; display: flex; flex-direction: column;
            box-shadow: 5px 0 15px rgba(0,0,0,0.2); padding-right: 15px;
        }
        .sidebar.active { left: 0; }
        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(3px); z-index: 900; display: none; }
        .sidebar-overlay.active { display: block; }

        .brand { padding: 30px 25px; font-size: 22px; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        
        .menu { padding: 10px 0; flex: 1; overflow-y: auto; }
        .menu-item { 
            padding: 14px 25px; margin-bottom: 5px; cursor: pointer; 
            display: flex; align-items: center; gap: 15px; color: #94a3b8; font-size: 15px; font-weight: 600; transition: 0.2s;
        }
        /* ACTIVE STYLE LIKE SCREENSHOT */
        .menu-item.active { 
            background: var(--primary); color: white; 
            border-radius: 0 50px 50px 0; /* Unique shape */
            box-shadow: 5px 0 15px rgba(16, 185, 129, 0.4);
        }
        .menu-item:hover:not(.active) { color: white; }

        /* --- MAIN CONTENT --- */
        .main-content { flex: 1; display: flex; flex-direction: column; height: 100%; transition: 0.3s; }
        .header {
            height: 70px; background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); 
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.03); z-index: 100;
        }
        
        .content-body { flex: 1; overflow-y: auto; padding: 20px; }
        
        /* --- CARDS & LISTS --- */
        .card { 
            background: white; border-radius: 20px; padding: 25px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.03); margin-bottom: 20px; 
            border: 1px solid white; position: relative; overflow: hidden;
        }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .stat-box { 
            background: linear-gradient(135deg, #ffffff, #f8fafc); padding: 20px; 
            border-radius: 18px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
            border-bottom: 4px solid var(--primary); 
        }
        .stat-box h2 { margin: 0; font-size: 28px; color: var(--dark); font-weight: 800; }
        .stat-box p { margin: 5px 0 0; font-size: 13px; color: #64748b; font-weight: 700; }

        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: white; border-radius: 15px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.02); border: 1px solid #f1f5f9; }
        .list-info h4 { margin: 0; font-size: 16px; color: var(--dark); font-weight: 700; }
        .list-info p { margin: 4px 0 0; font-size: 13px; color: #64748b; }
        
        /* --- BADGES & BUTTONS --- */
        .badge { padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 800; text-transform: uppercase; }
        .badge-vip { background: #fffbeb; color: #d97706; }
        .badge-ban { background: #fef2f2; color: #ef4444; }
        
        .btn-sm { padding: 8px 12px; border-radius: 8px; font-size: 12px; border: none; color: white; font-weight: 600; cursor: pointer; margin-left: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn-g { background: #10b981; } .btn-r { background: #ef4444; } .btn-b { background: #3b82f6; }

        /* --- RADIO SELECTOR (SCREENSHOT STYLE) --- */
        .radio-group { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
        .radio-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 15px; background: #1e293b; border-radius: 10px;
            color: white; cursor: pointer; transition: 0.2s;
        }
        .radio-item:hover { background: #334155; }
        .radio-item input { accent-color: var(--primary); width: 18px; height: 18px; }

        /* --- MODAL --- */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 2000; display: none; justify-content: center; align-items: center; padding: 20px; }
        .modal-box { background: white; width: 100%; max-width: 400px; padding: 30px; border-radius: 24px; animation: popUp 0.3s; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        @keyframes popUp { from{transform:scale(0.9);opacity:0} to{transform:scale(1);opacity:1} }
    </style>
</head>
<body>

    <div id="auth-view">
        <div class="login-box">
            <i class="fas fa-tree" style="font-size: 60px; color: var(--primary); margin-bottom: 20px;"></i>
            <h2 style="margin:0 0 20px;">Admin Panel</h2>
            <input id="u" class="inp" placeholder="Username">
            <input id="p" type="password" class="inp" placeholder="Password">
            <button class="btn" onclick="login()">Login Dashboard</button>
        </div>
    </div>

    <div id="dashboard" style="display:none; width:100%; height:100%">
        <div class="sidebar-overlay" onclick="toggleMenu()"></div>
        
        <div class="sidebar" id="sidebar">
            <div class="brand"><i class="fas fa-leaf"></i> টাকার গাছ</div>
            <div class="menu">
                <div class="menu-item active" onclick="nav('dash',this)"><i class="fas fa-th-large"></i> ড্যাশবোর্ড</div>
                <div class="menu-item" onclick="nav('users',this)"><i class="fas fa-users"></i> ইউজার লিস্ট</div>
                <div class="menu-item" onclick="nav('job_reqs',this)"><i class="fas fa-briefcase"></i> জব রিকোয়েস্ট <span id="job-c" class="badge badge-vip" style="display:none; margin-left:auto">0</span></div>
                <div class="menu-item" onclick="nav('deposits',this)"><i class="fas fa-arrow-circle-down"></i> ডিপোজিট <span id="dep-c" class="badge badge-vip" style="display:none; margin-left:auto">0</span></div>
                <div class="menu-item" onclick="nav('withdraws',this)"><i class="fas fa-arrow-circle-up"></i> উইথড্র <span id="wd-c" class="badge badge-vip" style="display:none; margin-left:auto">0</span></div>
                <div class="menu-item" onclick="nav('tasks',this)"><i class="fas fa-tasks"></i> টাস্ক ম্যানেজ</div>
                <div class="menu-item" onclick="nav('settings',this)"><i class="fas fa-cogs"></i> সেটিংস</div>
                <div class="menu-item" style="color:#ef4444; margin-top:30px" onclick="logout()"><i class="fas fa-sign-out-alt"></i> লগ আউট</div>
            </div>
        </div>

        <div class="main-content">
            <div class="header">
                <i class="fas fa-bars" style="font-size:22px; color:var(--dark); cursor:pointer" onclick="toggleMenu()"></i>
                <h3 id="pg-title" style="margin:0; font-size:18px; color:var(--dark)">ড্যাশবোর্ড</h3>
                <div style="width:20px"></div>
            </div>
            <div class="content-body" id="main-body"></div>
        </div>
    </div>

    <div id="user-modal" class="modal"><div class="modal-box">
        <h3 style="margin-top:0">ইউজার এডিট</h3>
        <input type="hidden" id="edit-uid">
        <p style="margin-bottom:5px; font-weight:600; color:#64748b">ব্যালেন্স</p>
        <input id="edit-bal" type="number" class="inp" style="background:#f1f5f9; color:black; border:1px solid #cbd5e1">
        
        <p style="margin-bottom:5px; font-weight:600; color:#64748b">VIP & Plan</p>
        <select id="edit-vip" class="inp" style="background:#f1f5f9; color:black; border:1px solid #cbd5e1">
            <option value="false">Free User</option>
            <option value="true">VIP User</option>
        </select>
        <input id="edit-plan" class="inp" style="background:#f1f5f9; color:black; border:1px solid #cbd5e1; margin-top:-10px" placeholder="Plan Name (e.g. Platinum)">

        <div style="display:flex; gap:10px; margin-top:15px">
            <button id="btn-ban" class="btn" style="background:#ef4444" onclick="toggleBan()">Ban User</button>
            <button class="btn" onclick="saveUser()">Update</button>
        </div>
        <button onclick="document.getElementById('user-modal').style.display='none'" style="background:none; border:none; color:#94a3b8; width:100%; margin-top:15px; font-size:13px">Close</button>
    </div></div>

    <script>
        // CONFIG
        const firebaseConfig = { apiKey: "AIzaSyDgI-d8iwWr40tmknbY6jhH0oRb2Tvg4d0", authDomain: "takar-gach-a1d84.firebaseapp.com", databaseURL: "https://takar-gach-a1d84-default-rtdb.firebaseio.com", projectId: "takar-gach-a1d84", storageBucket: "takar-gach-a1d84.firebasestorage.app", messagingSenderId: "637802367074", appId: "1:637802367074:web:2e7f6c0670ec47f3a1693b", measurementId: "G-0QL9LB7BSK" };
        firebase.initializeApp(firebaseConfig); const db = firebase.database();
        const CRED = { u: 'JIHAD', p: '198373' };

        window.onload = () => { if(sessionStorage.getItem('adm_ok')) showDash(); };

        function login(){
            const u = document.getElementById('u').value, p = document.getElementById('p').value;
            if(u===CRED.u && p===CRED.p) { sessionStorage.setItem('adm_ok',true); showDash(); }
            else Swal.fire('Error','Invalid Info','error');
        }
        function logout(){ sessionStorage.removeItem('adm_ok'); location.reload(); }
        function showDash(){ document.getElementById('auth-view').style.display='none'; document.getElementById('dashboard').style.display='block'; loadPage('dash'); count(); }
        function toggleMenu(){ document.getElementById('sidebar').classList.toggle('active'); document.querySelector('.sidebar-overlay').classList.toggle('active'); }

        function nav(p,e){
            document.querySelectorAll('.menu-item').forEach(i=>i.classList.remove('active'));
            if(e) e.classList.add('active');
            toggleMenu(); loadPage(p);
        }

        // --- PAGE LOADER ---
        function loadPage(page){
            const c = document.getElementById('main-body');
            c.innerHTML = '<div style="text-align:center;padding:50px"><i class="fas fa-circle-notch fa-spin fa-2x" style="color:var(--primary)"></i></div>';
            const t = document.getElementById('pg-title');

            if(page === 'dash'){
                t.innerText = "ওভারভিউ";
                db.ref('users').once('value', s=>{
                    const u = s.val()||{};
                    let bal = 0; Object.values(u).forEach(x=>bal+=(x.balance||0));
                    c.innerHTML = `
                    <div class="stat-grid">
                        <div class="stat-box"><h2>${Object.keys(u).length}</h2><p>মোট ইউজার</p></div>
                        <div class="stat-box" style="border-color:#3b82f6"><h2>৳${bal}</h2><p>ইউজার ব্যালেন্স</p></div>
                    </div>
                    <div class="card">
                        <h3 style="margin-top:0; color:#334155">নতুন জয়েনিং</h3>
                        ${Object.values(u).slice(-8).reverse().map(x=>`<div class="list-item"><div class="list-info"><h4>${x.name}</h4><p>${x.phone}</p></div><b style="color:var(--primary)">৳${x.balance}</b></div>`).join('')}
                    </div>`;
                });
            }
            else if(page === 'users'){
                t.innerText = "ইউজার লিস্ট";
                db.ref('users').once('value',s=>{
                    const u = s.val()||{};
                    c.innerHTML = `<input onkeyup="search(this)" class="inp" placeholder="ফোন নাম্বার দিয়ে খুঁজুন..." style="background:white; color:black; border:1px solid #cbd5e1; margin-bottom:15px">
                    <div id="u-list">${Object.keys(u).map(k=>`
                        <div class="list-item user-row" data-ph="${u[k].phone}">
                            <div class="list-info">
                                <h4>${u[k].name} ${u[k].isVip?'<span class="badge badge-vip">VIP</span>':''} ${u[k].banned?'<span class="badge badge-ban">BAN</span>':''}</h4>
                                <p>${u[k].phone} • ৳${u[k].balance}</p>
                            </div>
                            <button class="btn-sm btn-b" onclick="openUserModal('${k}')"><i class="fas fa-pen"></i></button>
                        </div>`).join('')}</div>`;
                });
            }
            else if(page === 'job_reqs' || page === 'deposits' || page === 'withdraws'){
                let type = page==='job_reqs'?'Task Reward':(page==='deposits'?'Buy':'Withdraw');
                t.innerText = page==='job_reqs'?'জব রিকোয়েস্ট':(page==='deposits'?'ডিপোজিট':'উইথড্র');
                
                db.ref('users').once('value',s=>{
                    let htm = ''; let has = false; const u = s.val()||{};
                    Object.keys(u).forEach(uid=>{
                        const h = u[uid].history||{};
                        Object.keys(h).forEach(hid=>{
                            const tr = h[hid];
                            if(tr.status==='Pending'){
                                let match = false;
                                if(type==='Buy' && tr.type.includes('Buy')) match=true;
                                if(type==='Withdraw' && tr.type==='Withdraw') match=true;
                                if(type==='Task Reward' && tr.type==='Task Reward') match=true;

                                if(match){
                                    has = true;
                                    htm += `
                                    <div class="card" style="border-left:5px solid ${type==='Withdraw'?'#ef4444':'#10b981'}">
                                        <div style="display:flex; justify-content:space-between; margin-bottom:10px">
                                            <b>${u[uid].name}</b> <b style="color:var(--primary)">৳${tr.amount}</b>
                                        </div>
                                        <div style="font-size:13px; color:#64748b; margin-bottom:15px; background:#f8fafc; padding:10px; border-radius:10px; border:1px solid #e2e8f0">
                                            ${type==='Task Reward' ? `<b>Proof:</b> ${tr.proof}` : (type==='Buy' ? `Plan: ${tr.type}<br>TrxID: ${tr.trx}<br>Sender: ${tr.sender}` : `Method: ${tr.method}<br>To: ${tr.trx}`)}
                                            <br><small style="color:#94a3b8; font-size:11px; margin-top:5px; display:block">${tr.date}</small>
                                        </div>
                                        <div style="display:flex; gap:10px">
                                            <button class="btn-sm btn-g" style="flex:1; padding:10px" onclick="act('${uid}','${hid}','Success','${tr.type}',${tr.amount})">Approve</button>
                                            <button class="btn-sm btn-r" style="flex:1; padding:10px" onclick="act('${uid}','${hid}','Rejected','${tr.type}',${tr.amount})">Reject</button>
                                        </div>
                                    </div>`;
                                }
                            }
                        });
                    });
                    c.innerHTML = has?htm:'<div style="text-align:center;padding:50px;color:#94a3b8">কোনো পেন্ডিং রিকোয়েস্ট নেই</div>';
                });
            }
            else if(page === 'tasks'){
                t.innerText = "টাস্ক সেটআপ";
                c.innerHTML = `
                <div class="card" style="background:#0f172a; color:white; border:none">
                    <h3 style="margin-top:0; color:#fff">নতুন টাস্ক</h3>
                    <input id="t-ti" class="inp" placeholder="Task Title">
                    <div style="display:flex; gap:10px; margin-bottom:10px">
                        <input id="t-rw" type="number" class="inp" placeholder="Reward (Tk)" style="margin:0">
                        <input id="t-ln" class="inp" placeholder="Link" style="margin:0">
                    </div>
                    
                    <p style="font-size:13px; color:#94a3b8; margin-bottom:5px">Target Audience:</p>
                    <div class="radio-group">
                        <label class="radio-item"><input type="radio" name="target" value="free" checked> Free User</label>
                        <label class="radio-item"><input type="radio" name="target" value="vip"> All VIP</label>
                        <label class="radio-item"><input type="radio" name="target" value="silver"> Silver</label>
                        <label class="radio-item"><input type="radio" name="target" value="gold"> Gold</label>
                        <label class="radio-item"><input type="radio" name="target" value="platinum"> Platinum</label>
                        <label class="radio-item"><input type="radio" name="target" value="diamond"> Diamond</label>
                    </div>
                    <button class="btn" style="margin-top:15px" onclick="addTask()">Publish Task</button>
                </div>
                <div id="tk-list"></div>`;
                db.ref('settings/tasks').on('value',s=>{
                    const t=s.val()||{};
                    document.getElementById('tk-list').innerHTML = Object.keys(t).map(k=>`<div class="list-item"><div><b>${t[k].title}</b> <span class="badge" style="background:#e2e8f0; color:#475569">${t[k].target.toUpperCase()}</span><br><small style="color:#10b981; font-weight:700">+ ৳${t[k].reward}</small></div><button class="btn-sm btn-r" onclick="delTask('${k}')"><i class="fas fa-trash"></i></button></div>`).join('');
                });
            }
            else if(page === 'settings'){
                t.innerText = "অ্যাপ সেটিংস";
                db.ref('settings').once('value',s=>{
                    const v = s.val()||{};
                    c.innerHTML = `
                    <div class="card">
                        <p style="font-weight:600; color:#64748b; margin-bottom:5px">পেমেন্ট নাম্বার</p>
                        <input id="s-bk" class="inp" style="background:white;color:black;border:1px solid #cbd5e1" value="${v.config?.bkash||''}" placeholder="Bkash">
                        <input id="s-ng" class="inp" style="background:white;color:black;border:1px solid #cbd5e1" value="${v.config?.nagad||''}" placeholder="Nagad">
                        
                        <p style="font-weight:600; color:#64748b; margin-bottom:5px; margin-top:15px">নোটিশ বোর্ড</p>
                        <textarea id="s-nt" class="inp" style="background:white;color:black;border:1px solid #cbd5e1" rows="4">${v.notice||''}</textarea>
                        <button class="btn" onclick="saveSet()">Save Changes</button>
                    </div>`;
                });
            }
        }

        // --- ACTIONS ---
        function addTask(){
            const ti = document.getElementById('t-ti').value;
            const rw = document.getElementById('t-rw').value;
            const ln = document.getElementById('t-ln').value;
            const tg = document.querySelector('input[name="target"]:checked').value;
            
            if(!ti || !rw || !ln) return Swal.fire('Error','সব তথ্য দিন');
            db.ref('settings/tasks').push({ title:ti, reward:parseInt(rw), link:ln, target:tg }); 
            Swal.fire('Success','টাস্ক যুক্ত হয়েছে','success');
            document.getElementById('t-ti').value='';
        }
        function delTask(k){ db.ref('settings/tasks/'+k).remove(); }

        function act(uid, hid, st, type, amt){
            db.ref(`users/${uid}/history/${hid}`).update({status:st});
            if(st==='Success'){
                if(type.includes('Buy')) db.ref(`users/${uid}`).update({isVip:true, currentPlan:type.replace('Buy ',''), vipExpire:Date.now()+(30*86400000)});
                else if(type==='Task Reward') db.ref(`users/${uid}/balance`).transaction(b=>(b||0)+parseInt(amt));
            } else if(st==='Rejected' && type==='Withdraw'){
                db.ref(`users/${uid}/balance`).transaction(b=>(b||0)+parseInt(amt));
            }
            Swal.fire('Updated'); loadPage(type==='Task Reward'?'job_reqs':(type==='Withdraw'?'withdraws':'deposits')); count();
        }

        function saveSet(){
            db.ref('settings/config').update({ bkash: document.getElementById('s-bk').value, nagad: document.getElementById('s-ng').value });
            db.ref('settings').update({ notice: document.getElementById('s-nt').value });
            Swal.fire('Saved!');
        }

        // --- USER MANAGE ---
        let currentEditUser = '';
        function openUserModal(uid){
            currentEditUser = uid;
            db.ref('users/'+uid).once('value',s=>{
                const u = s.val();
                document.getElementById('edit-uid').value = uid;
                document.getElementById('edit-bal').value = u.balance;
                document.getElementById('edit-vip').value = u.isVip ? 'true' : 'false';
                document.getElementById('edit-plan').value = u.currentPlan || '';
                
                const banBtn = document.getElementById('btn-ban');
                banBtn.innerText = u.banned ? "Unban User" : "Ban User";
                banBtn.style.background = u.banned ? "#10b981" : "#ef4444";
                
                document.getElementById('user-modal').style.display = 'flex';
            });
        }

        function saveUser(){
            const b = parseInt(document.getElementById('edit-bal').value);
            const v = document.getElementById('edit-vip').value === 'true';
            const p = document.getElementById('edit-plan').value;
            db.ref('users/'+currentEditUser).update({balance:b, isVip:v, currentPlan:p});
            document.getElementById('user-modal').style.display='none';
            Swal.fire('Updated'); loadPage('users');
        }

        function toggleBan(){
            db.ref('users/'+currentEditUser).once('value',s=>{
                const st = s.val().banned ? false : true;
                db.ref('users/'+currentEditUser).update({banned:st});
                document.getElementById('user-modal').style.display='none';
                Swal.fire(st ? 'Banned!' : 'Unbanned!'); loadPage('users');
            });
        }

        function count(){
            db.ref('users').once('value',s=>{
                let d=0, w=0, j=0; const u=s.val()||{};
                Object.values(u).forEach(x=>{ 
                    if(x.history) Object.values(x.history).forEach(h=>{ 
                        if(h.status==='Pending'){ 
                            if(h.type==='Withdraw') w++; 
                            else if(h.type==='Task Reward') j++;
                            else if(h.type.includes('Buy')) d++; 
                        } 
                    }) 
                });
                const setBad = (id,v) => { document.getElementById(id).innerText=v; document.getElementById(id).style.display=v>0?'inline-block':'none'; };
                setBad('dep-c',d); setBad('wd-c',w); setBad('job-c',j);
            });
        }
        function search(e){
            const v = e.value.toLowerCase();
            document.querySelectorAll('.user-row').forEach(r => r.style.display = r.dataset.ph.includes(v)?'flex':'none');
        }
    </script>
</body>
</html>

