<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ó‡¶æ‡¶õ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® V5.1 Ultimate</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           1. CORE DESIGN CONFIGURATION
           ========================================= */
        :root {
            --primary: #10b981; 
            --primary-dark: #047857;
            --accent: #F59E0B;
            --danger: #EF4444;
            --bg-body: #F3F4F6;
            --text-main: #111827;
            --text-muted: #6B7280;
            --card-shadow: 0 10px 25px rgba(0,0,0,0.05);
            --radius-xl: 30px;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg-body); font-family: 'Poppins', 'Hind Siliguri', sans-serif; color: var(--text-main); padding-bottom: 110px; user-select: none; }

        /* --- SPLASH SCREEN --- */
        #splash-screen { position: fixed; inset: 0; background: var(--bg-body); z-index: 6000; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .growing-tree { font-size: 0px; color: var(--primary); margin-bottom: 25px; animation: growTree 2.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; transform-origin: bottom center; }
        @keyframes growTree { 0% { font-size: 0px; opacity: 0; transform: translateY(60px); } 100% { font-size: 110px; opacity: 1; transform: translateY(0); } }

        /* --- AUTH LOGIN --- */
        #auth-view { position: fixed; inset: 0; background: linear-gradient(135deg, #1f2937, #111827); z-index: 5000; display: none; justify-content: center; align-items: center; padding: 25px; }
        .login-box { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); padding: 40px 30px; border-radius: 35px; width: 100%; max-width: 380px; text-align: center; border: 1px solid rgba(255,255,255,0.15); color: white; }
        .login-box input { width: 100%; padding: 16px; margin-bottom: 15px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.2); color: white; font-size: 16px; text-align: center; }
        .login-box button { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 16px; font-weight: 800; cursor: pointer; font-size: 16px; box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3); }

        /* --- DASHBOARD HEADER --- */
        .header { position: sticky; top: 0; background: rgba(255,255,255,0.8); backdrop-filter: blur(15px); padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); z-index: 500; }
        .header h2 { margin: 0; font-weight: 800; font-size: 22px; color: var(--primary); }

        /* --- STATISTICS GRID --- */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; }
        .stat-card { background: white; padding: 25px 15px; border-radius: 28px; text-align: center; box-shadow: var(--card-shadow); border-bottom: 5px solid var(--primary); transition: 0.3s; }
        .stat-card h1 { margin: 5px 0; font-size: 28px; font-weight: 800; color: var(--text-main); }
        .stat-card p { margin: 0; font-size: 11px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }

        .profit-card { background: linear-gradient(135deg, #1F2937, #111827); color: white; padding: 30px; border-radius: 35px; margin: 0 20px 25px; text-align: center; box-shadow: 0 15px 35px rgba(0,0,0,0.15); }
        .profit-card h1 { font-size: 38px; margin: 10px 0; font-weight: 800; }

        /* --- DASHBOARD MENU --- */
        .menu-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; padding: 0 20px; margin-bottom: 30px; }
        .menu-item { background: white; padding: 18px 5px; border-radius: 22px; text-align: center; cursor: pointer; border: 1px solid #f1f1f1; transition: 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.02); }
        .menu-item:active { transform: scale(0.9); background: #ECFDF5; }
        .menu-item i { font-size: 26px; margin-bottom: 10px; display: block; }
        .menu-item span { font-size: 10px; font-weight: 700; color: var(--text-muted); }

        /* --- USER & REQUEST LISTS --- */
        .list-area { padding: 0 20px 30px; }
        .card { background: white; border-radius: 28px; padding: 25px; border: 1px solid var(--border); box-shadow: var(--card-shadow); margin-bottom: 20px; }
        .user-row { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-radius: 18px; background: #f9fafb; margin-bottom: 10px; border: 1px solid #eee; }
        
        .badge { padding: 5px 12px; border-radius: 12px; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        .badge-pending { background: #FEF3C7; color: #D97706; }
        .badge-success { background: #D1FAE5; color: #059669; }
        .badge-danger { background: #FEE2E2; color: #EF4444; }

        /* --- BOTTOM NAV --- */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); padding: 12px 20px; display: flex; justify-content: space-around; border-top: 1px solid var(--border); border-radius: 35px 35px 0 0; z-index: 1000; box-shadow: 0 -10px 30px rgba(0,0,0,0.05); }
        .nav-btn { text-align: center; color: var(--text-muted); font-size: 10px; font-weight: 700; cursor: pointer; transition: 0.3s; }
        .nav-btn.active { color: var(--primary); }
        .nav-btn.active i { transform: translateY(-8px); filter: drop-shadow(0 5px 10px rgba(16,185,129,0.3)); }
        .nav-btn i { font-size: 24px; margin-bottom: 5px; display: block; }

        /* MODALS */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(8px); z-index: 2000; display: none; justify-content: center; align-items: center; padding: 25px; }
        .modal-box { background: white; width: 100%; max-width: 420px; padding: 35px; border-radius: 35px; box-shadow: 0 30px 60px rgba(0,0,0,0.3); max-height: 85vh; overflow-y: auto; }
        .inp { width: 100%; padding: 15px; border: 1.5px solid var(--border); border-radius: 16px; margin-bottom: 15px; font-size: 15px; background: #f9fafb; }
        .btn-full { width: 100%; padding: 16px; border: none; border-radius: 16px; font-weight: 800; font-size: 15px; cursor: pointer; margin-bottom: 10px; }
        
        /* FORM BUTTONS */
        .btn-approve { background: var(--primary); color: white; box-shadow: 0 8px 15px rgba(16, 185, 129, 0.2); }
        .btn-reject { background: var(--danger); color: white; box-shadow: 0 8px 15px rgba(239, 68, 68, 0.2); }
    </style>
</head>
<body>

    <div id="splash-screen">
        <i class="fas fa-tree growing-tree"></i>
        <h1 style="color:var(--text-main);font-weight:900;margin:0;font-size:35px">‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ó‡¶æ‡¶õ</h1>
        <small style="color:var(--text-muted);font-weight:700">ADMIN SUPREME V5.1</small>
    </div>

    <div id="auth-view">
        <div class="login-box">
            <div style="width:90px;height:90px;background:rgba(255,255,255,0.1);border-radius:50%;margin:0 auto 25px;display:flex;justify-content:center;align-items:center;font-size:40px;color:var(--primary);border:1px solid rgba(255,255,255,0.2)">
                <i class="fas fa-user-lock"></i>
            </div>
            <h2 style="margin-bottom:10px">Admin Login</h2>
            <p style="opacity:0.6;margin-bottom:30px;font-size:14px">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶∞‡¶ø‡¶ü‡¶ø ‡¶ï‡¶ø ‡¶¶‡¶ø‡¶®</p>
            <input id="u_name" type="text" placeholder="Username (JIHAD)">
            <input id="u_pass" type="password" placeholder="Password (198373)">
            <button onclick="checkAuth()">‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <div id="admin-dashboard" style="display:none">
        
        <div class="header">
            <h2>‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ó‡¶æ‡¶õ <small style="font-size:10px;color:var(--text-muted)">ADMIN</small></h2>
            <div onclick="location.reload()" style="width:40px;height:40px;background:#f3f4f6;border-radius:50%;display:flex;justify-content:center;align-items:center;cursor:pointer">
                <i class="fas fa-sync-alt" style="color:var(--primary)"></i>
            </div>
        </div>

        <div id="home-view" class="view-panel">
            <div class="stats-grid">
                <div class="stat-card"><h1 id="stat-users">0</h1><p>‡¶Æ‡ßã‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</p></div>
                <div class="stat-card" style="border-color:#3b82f6"><h1 id="stat-bal">‡ß≥0</h1><p>‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p></div>
                <div class="stat-card" style="border-color:#10b981"><h1 id="stat-dep" style="color:#10b981">‡ß≥0</h1><p>‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</p></div>
                <div class="stat-card" style="border-color:#ef4444"><h1 id="stat-wd" style="color:#ef4444">‡ß≥0</h1><p>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</p></div>
            </div>

            <div class="profit-card">
                <small style="opacity:0.7;text-transform:uppercase;letter-spacing:2px">‡¶®‡ßá‡¶ü ‡¶™‡ßç‡¶∞‡¶´‡¶ø‡¶ü (Net Profit)</small>
                <h1 id="stat-profit">‡ß≥0</h1>
            </div>

            <div class="menu-grid">
                <div class="menu-item" onclick="showSection('users')"><i class="fas fa-users" style="color:#3b82f6"></i><span>‡¶á‡¶â‡¶ú‡¶æ‡¶∞</span></div>
                <div class="menu-item" onclick="showSection('deposits')"><i class="fas fa-wallet" style="color:#10b981"></i><span>‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</span></div>
                <div class="menu-item" onclick="showSection('withdraws')"><i class="fas fa-money-check-alt" style="color:#ef4444"></i><span>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</span></div>
                <div class="menu-item" onclick="showSection('tasks')"><i class="fas fa-tasks" style="color:#8b5cf6"></i><span>‡¶ú‡¶¨ ‡¶ö‡ßá‡¶ï</span></div>
                <div class="menu-item" onclick="showSection('plans')"><i class="fas fa-crown" style="color:#f59e0b"></i><span>‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®</span></div>
                <div class="menu-item" onclick="showSection('history')"><i class="fas fa-history" style="color:#6b7280"></i><span>‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø</span></div>
                <div class="menu-item" onclick="showSection('settings')"><i class="fas fa-cog" style="color:#1f2937"></i><span>‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</span></div>
                <div class="menu-item" onclick="adminLogout()"><i class="fas fa-power-off" style="color:red"></i><span>‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</span></div>
            </div>

            <div class="list-area">
                <div class="card">
                    <h3 style="margin-bottom:15px;font-size:18px">‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®</h3>
                    <div id="recent-hist-list">‡¶≤‡ßã‡¶°‡¶ø‡¶Ç...</div>
                </div>
            </div>
        </div>

        <div id="dynamic-view" class="view-panel" style="display:none;padding:20px">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:25px">
                <h2 id="page-title" style="margin:0;font-weight:800;color:var(--text-main)">...</h2>
                <button onclick="backHome()" style="background:#374151;color:white;border:none;padding:8px 20px;border-radius:12px;font-weight:700">‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï</button>
            </div>
            <div id="page-content"></div>
        </div>

        <div class="bottom-nav">
            <div class="nav-btn active" onclick="backHome()"><i class="fas fa-home"></i>‡¶π‡ßã‡¶Æ</div>
            <div class="nav-btn" onclick="showSection('users')"><i class="fas fa-users"></i>‡¶á‡¶â‡¶ú‡¶æ‡¶∞</div>
            <div class="nav-btn" onclick="showSection('tasks')"><i class="fas fa-check-double"></i>‡¶ú‡¶¨</div>
            <div class="nav-btn" onclick="showSection('settings')"><i class="fas fa-cog"></i>‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</div>
        </div>
    </div>

    <div id="user-modal" class="modal">
        <div class="modal-box">
            <h3 id="m-user-name">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶è‡¶°‡¶ø‡¶ü</h3>
            <p id="m-user-phone" style="font-size:12px;color:var(--text-muted);margin-bottom:20px">...</p>
            <input id="e-bal" class="inp" type="number" placeholder="‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏">
            <input id="e-pass" class="inp" type="text" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
            <div style="display:flex;gap:10px">
                <button class="btn-full" id="ban-btn" onclick="toggleBan()" style="background:#374151;color:white">‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button class="btn-full btn-approve" onclick="saveUserUpdate()">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
            <button onclick="closeModal('user-modal')" style="width:100%;background:transparent;border:none;color:#999;cursor:pointer;margin-top:10px">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <script>
        // FIREBASE INIT
        const firebaseConfig = { apiKey: "AIzaSyDgI-d8iwWr40tmknbY6jhH0oRb2Tvg4d0", authDomain: "takar-gach-a1d84.firebaseapp.com", databaseURL: "https://takar-gach-a1d84-default-rtdb.firebaseio.com", projectId: "takar-gach-a1d84", storageBucket: "takar-gach-a1d84.firebasestorage.app", messagingSenderId: "637802367074", appId: "1:637802367074:web:2e7f6c0670ec47f3a1693b" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let USERS = {}, GLOBAL_HISTORY = [];

        // --- AUTH CHECK (JIHAD / 198373) ---
        function checkAuth() {
            const u = document.getElementById('u_name').value;
            const p = document.getElementById('u_pass').value;
            if(u === "JIHAD" && p === "198373") {
                sessionStorage.setItem('isAdmin', 'true');
                location.reload();
            } else {
                Swal.fire('Error', '‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤!', 'error');
            }
        }

        window.onload = () => {
            setTimeout(() => {
                document.getElementById('splash-screen').style.display = 'none';
                if(sessionStorage.getItem('isAdmin')) {
                    document.getElementById('admin-dashboard').style.display = 'block';
                    loadData();
                } else {
                    document.getElementById('auth-view').style.display = 'flex';
                }
            }, 2000);
        };

        // --- DATA LOADING & STATS ---
        function loadData() {
            db.ref('users').on('value', snap => {
                USERS = snap.val() || {};
                renderStats();
                processHistory();
                if(document.getElementById('home-view').style.display !== 'none') renderRecentHistory();
            });
        }

        function renderStats() {
            let totalUsers = 0, totalBal = 0, totalDep = 0, totalWd = 0;
            Object.values(USERS).forEach(u => {
                totalUsers++;
                totalBal += (u.balance || 0);
                if(u.history) {
                    Object.values(u.history).forEach(h => {
                        if(h.status === 'Success') {
                            if(h.type.includes('Buy')) totalDep += (h.amount || 0);
                            if(h.type === 'Withdraw') totalWd += (h.amount || 0);
                        }
                    });
                }
            });
            document.getElementById('stat-users').innerText = totalUsers;
            document.getElementById('stat-bal').innerText = '‡ß≥' + totalBal;
            document.getElementById('stat-dep').innerText = '‡ß≥' + totalDep;
            document.getElementById('stat-wd').innerText = '‡ß≥' + totalWd;
            document.getElementById('stat-profit').innerText = '‡ß≥' + (totalDep - totalWd);
        }

        // --- HISTORY ENGINE (FIXED LOAD PROBLEM) ---
        function processHistory() {
            GLOBAL_HISTORY = [];
            Object.keys(USERS).forEach(uId => {
                if(USERS[uId].history) {
                    Object.keys(USERS[uId].history).forEach(hId => {
                        GLOBAL_HISTORY.push({
                            ...USERS[uId].history[hId],
                            uid: uId,
                            hid: hId,
                            userName: USERS[uId].name
                        });
                    });
                }
            });
            GLOBAL_HISTORY.sort((a,b) => new Date(b.date) - new Date(a.date));
        }

        function renderRecentHistory() {
            const container = document.getElementById('recent-hist-list');
            if(GLOBAL_HISTORY.length === 0) {
                container.innerHTML = '<p style="text-align:center;padding:20px;color:#999">‡¶ï‡ßã‡¶®‡ßã ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø ‡¶®‡ßá‡¶á</p>';
                return;
            }
            container.innerHTML = GLOBAL_HISTORY.slice(0, 10).map(h => `
                <div class="user-row">
                    <div><b>${h.userName}</b><br><small>${h.type} ‚Ä¢ ${h.date.split(',')[0]}</small></div>
                    <div style="text-align:right">
                        <b>‡ß≥${h.amount}</b><br>
                        <span class="badge ${h.status==='Success'?'badge-success':(h.status==='Pending'?'badge-pending':'badge-danger')}">${h.status}</span>
                    </div>
                </div>
            `).join('');
        }

        // --- SECTION NAVIGATION ---
        function showSection(sec) {
            document.getElementById('home-view').style.display = 'none';
            document.getElementById('dynamic-view').style.display = 'block';
            const content = document.getElementById('page-content');
            const title = document.getElementById('page-title');
            content.innerHTML = '<p style="text-align:center">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>';

            if(sec === 'users') {
                title.innerText = "‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü";
                renderUsers();
            } else if(sec === 'deposits') {
                title.innerText = "‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü";
                renderReqs('Buy');
            } else if(sec === 'withdraws') {
                title.innerText = "‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü";
                renderReqs('Withdraw');
            } else if(sec === 'tasks') {
                title.innerText = "‡¶ú‡¶¨ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®";
                renderReqs('Task Reward');
            } else if(sec === 'history') {
                title.innerText = "‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø";
                renderFullHistory();
            } else if(sec === 'settings') {
                title.innerText = "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏";
                renderSettings();
            }
        }

        function backHome() {
            document.getElementById('dynamic-view').style.display = 'none';
            document.getElementById('home-view').style.display = 'block';
            renderRecentHistory();
        }

        // --- USER MGMT ---
        function renderUsers() {
            let html = '<input type="text" class="inp" placeholder="‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." onkeyup="searchUser(this.value)">';
            html += '<div id="user-list-container">';
            Object.values(USERS).reverse().forEach(u => {
                html += `
                <div class="user-row u-item" data-search="${u.name} ${u.phone}">
                    <div><b>${u.name} ${u.banned?'üõë':''}</b><br><small>${u.phone}</small></div>
                    <div style="text-align:right"><b>‡ß≥${u.balance}</b><br><button class="btn-sm" style="background:var(--primary);color:white;border:none;border-radius:5px;padding:4px 10px;cursor:pointer" onclick="openUserEdit('${u.phone}')">‡¶è‡¶°‡¶ø‡¶ü</button></div>
                </div>`;
            });
            html += '</div>';
            document.getElementById('page-content').innerHTML = html;
        }

        function openUserEdit(phone) {
            const u = USERS[phone];
            document.getElementById('m-user-name').innerText = u.name;
            document.getElementById('m-user-phone').innerText = phone;
            document.getElementById('e-bal').value = u.balance;
            document.getElementById('e-pass').value = u.pass;
            document.getElementById('ban-btn').innerText = u.banned ? "‡¶Ü‡¶®‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®" : "‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";
            openModal('user-modal');
        }

        function saveUserUpdate() {
            const phone = document.getElementById('m-user-phone').innerText;
            const bal = parseFloat(document.getElementById('e-bal').value);
            const pass = document.getElementById('e-pass').value;
            db.ref('users/'+phone).update({ balance: bal, pass: pass });
            closeModal('user-modal');
            Swal.fire('‡¶∏‡¶´‡¶≤', '‡¶§‡¶•‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
        }

        function toggleBan() {
            const phone = document.getElementById('m-user-phone').innerText;
            const currentStatus = USERS[phone].banned || false;
            db.ref('users/'+phone).update({ banned: !currentStatus });
            closeModal('user-modal');
            Swal.fire('‡¶∏‡¶´‡¶≤', '‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
        }

        // --- REQUEST ACTIONS ---
        function renderReqs(type) {
            const reqs = GLOBAL_HISTORY.filter(h => h.type.includes(type) && h.status === 'Pending');
            if(reqs.length === 0) {
                document.getElementById('page-content').innerHTML = '<p style="text-align:center;padding:50px;color:#999">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á</p>';
                return;
            }
            document.getElementById('page-content').innerHTML = reqs.map(r => `
                <div class="card">
                    <div style="display:flex;justify-content:space-between"><b>${r.userName}</b> <span class="badge badge-pending">${r.type}</span></div>
                    <div style="margin:15px 0;font-size:14px;color:#555">
                        ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£: <b>‡ß≥${r.amount}</b><br>
                        TrxID/Num: <b style="color:var(--primary)">${r.trx || r.sender || 'N/A'}</b><br>
                        ${r.proof ? `‡¶™‡ßç‡¶∞‡ßÅ‡¶´: <a href="${r.proof}" target="_blank">‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</a>` : ''}
                    </div>
                    <div style="display:flex;gap:10px">
                        <button class="btn-full btn-approve" onclick="approveReq('${r.uid}', '${r.hid}', ${r.amount}, '${r.type}', ${r.validity||0})">‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠</button>
                        <button class="btn-full btn-reject" onclick="rejectReq('${r.uid}', '${r.hid}')">‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü</button>
                    </div>
                </div>
            `).join('');
        }

        function approveReq(uId, hId, amount, type, validity) {
            const update = {};
            update[`users/${uId}/history/${hId}/status`] = "Success";
            if(type.includes('Buy')) {
                update[`users/${uId}/isVip`] = true;
                update[`users/${uId}/currentPlan`] = type.replace('Buy ', '');
                update[`users/${uId}/vipExpire`] = Date.now() + (validity * 86400000);
            } else if(type === 'Task Reward') {
                update[`users/${uId}/balance`] = (USERS[uId].balance || 0) + amount;
            }
            db.ref().update(update);
            Swal.fire('‡¶∏‡¶´‡¶≤', '‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü‡¶ü‡¶ø ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
            backHome();
        }

        function rejectReq(uId, hId) {
            Swal.fire({
                title: '‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®',
                input: 'text',
                inputPlaceholder: '‡¶≠‡ßÅ‡¶≤ TrxID / ‡¶∏‡ßç‡¶™‡ßç‡¶Ø‡¶æ‡¶Æ...',
                showCancelButton: true,
                confirmButtonText: '‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®'
            }).then((res) => {
                if(res.value) {
                    db.ref(`users/${uId}/history/${hId}`).update({ status: "Rejected", reason: res.value });
                    Swal.fire('‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶°', '‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶¨‡ßá', 'error');
                    backHome();
                }
            });
        }

        // --- FULL HISTORY ---
        function renderFullHistory() {
            document.getElementById('page-content').innerHTML = `
                <div class="card" style="padding:10px;max-height:600px;overflow-y:auto">
                    ${GLOBAL_HISTORY.map(h => `
                        <div class="user-row">
                            <div><b>${h.userName}</b><br><small>${h.type} ‚Ä¢ ${h.date}</small></div>
                            <div style="text-align:right"><b>‡ß≥${h.amount}</b><br><small style="color:${h.status==='Success'?'green':'red'}">${h.status}</small></div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

       // --- SETTINGS SECTION (REVISED & PROFESSIONAL) ---
function renderSettings() {
    db.ref('settings').once('value', snapshot => {
        const settings = snapshot.val() || {};
        document.getElementById('page-content').innerHTML = `
        <div class="card" style="animation: slideIn 0.5s ease-out;">
            <h3 style="margin-bottom:20px; color:var(--primary); display:flex; align-items:center; gap:10px;">
                <i class="fas fa-sliders-h"></i> ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
            </h3>
            
            <div style="margin-bottom:20px;">
                <label style="font-weight:700; font-size:13px; color:var(--text-muted); display:block; margin-bottom:8px;">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ (Marquee Text)</label>
                <textarea id="s-notice" class="inp" style="height:100px; resize:none; border-radius:15px;" placeholder="‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">${settings.notice || ''}</textarea>
            </div>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:20px;">
                <div>
                    <label style="font-weight:700; font-size:13px; color:var(--text-muted); display:block; margin-bottom:8px;">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞</label>
                    <input id="s-bkash" class="inp" value="${settings.bkash || ''}" placeholder="017xxxxxxxx">
                </div>
                <div>
                    <label style="font-weight:700; font-size:13px; color:var(--text-muted); display:block; margin-bottom:8px;">‡¶®‡¶ó‡¶¶ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞</label>
                    <input id="s-nagad" class="inp" value="${settings.nagad || ''}" placeholder="018xxxxxxxx">
                </div>
            </div>

            <div class="user-row" style="background:var(--primary-light); border:none; margin-bottom:25px;">
                <div>
                    <b style="color:var(--primary-dark);">‡¶Ö‡¶´‡¶ø‡¶∏ ‡¶ü‡¶æ‡¶á‡¶Æ / ‡¶Æ‡ßá‡¶á‡¶®‡¶ü‡ßá‡¶®‡ßá‡¶®‡ßç‡¶∏</b><br>
                    <small style="color:var(--primary-dark); opacity:0.8;">‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶∞‡¶æ ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá ‡¶®‡¶æ</small>
                </div>
                <label class="switch">
                    <input type="checkbox" id="s-maint" ${settings.maintenance ? 'checked' : ''}>
                    <span class="slider"></span>
                </label>
            </div>

            <button class="btn-full btn-approve" onclick="saveAdminSettings()" style="height:60px; font-size:16px;">
                <i class="fas fa-save" style="margin-right:10px;"></i> ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
        </div>

        <div class="card" style="margin-top:25px; border-left:5px solid var(--accent);">
            <h3 style="margin-bottom:20px; color:var(--accent);">üí∞ ‡¶∞‡¶ø‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h3>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                <div>
                    <label style="font-weight:700; font-size:12px;">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ (‡ß≥)</label>
                    <input id="s-ref" type="number" class="inp" value="${settings.config?.refBonus || 2}">
                </div>
                <div>
                    <label style="font-weight:700; font-size:12px;">‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ (‡ß≥)</label>
                    <input id="s-min" type="number" class="inp" value="${settings.config?.minWithdraw || 20}">
                </div>
            </div>
            <button class="btn-full" onclick="saveRewardSettings()" style="background:var(--accent); color:white; margin-top:10px;">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶∞‡¶ø‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°</button>
        </div>
        `;
    });
}

// --- SAVE SETTINGS LOGIC ---
function saveAdminSettings() {
    const data = {
        notice: document.getElementById('s-notice').value,
        bkash: document.getElementById('s-bkash').value,
        nagad: document.getElementById('s-nagad').value,
        maintenance: document.getElementById('s-maint').checked
    };
    
    db.ref('settings').update(data).then(() => {
        Swal.fire({
            title: '‡¶∏‡¶´‡¶≤!',
            text: '‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§',
            icon: 'success',
            confirmButtonColor: '#10b981'
        });
    });
}

function saveRewardSettings() {
    const config = {
        refBonus: parseInt(document.getElementById('s-ref').value),
        minWithdraw: parseInt(document.getElementById('s-min').value)
    };
    
    db.ref('settings/config').update(config).then(() => {
        Swal.fire('‡¶∏‡¶´‡¶≤!', '‡¶∞‡¶ø‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§', 'success');
    });
}

// --- üíé VIP PLAN MANAGEMENT ---
function renderPlanSettings() {
    const content = document.getElementById('page-content');
    db.ref('settings/vipPlans').on('value', snapshot => {
        const plans = snapshot.val() || {};
        let html = `
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 style="margin:0;">VIP ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü</h3>
                <button class="btn-sm" style="background:var(--primary); padding:10px 20px;" onclick="openPlanModal()">+ ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®</button>
            </div>
            <div style="display:grid; grid-template-columns: 1fr; gap:15px;">
        `;
        
        Object.keys(plans).forEach(key => {
            const p = plans[key];
            html += `
                <div class="user-row" style="background:white; padding:20px;">
                    <div>
                        <b style="font-size:18px;">${p.name}</b><br>
                        <small style="color:var(--primary); font-weight:700;">‡ß≥${p.price} | Daily: ‡ß≥${p.dailyIncome}</small><br>
                        <small style="color:var(--text-muted);">‡¶Æ‡ßá‡ßü‡¶æ‡¶¶: ${p.validity} ‡¶¶‡¶ø‡¶®</small>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <button class="btn-sm" style="background:#EF4444;" onclick="deletePlan('${key}')"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `;
        });
        
        html += `</div>`;
        content.innerHTML = html;
    });
}

function openPlanModal() {
    Swal.fire({
        title: '‡¶®‡¶§‡ßÅ‡¶® VIP ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®',
        html: `
            <input id="p-name" class="swal2-input" placeholder="‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶®‡¶æ‡¶Æ (‡¶Ø‡ßá‡¶Æ‡¶®: GOLD)">
            <input id="p-price" type="number" class="swal2-input" placeholder="‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶¶‡¶æ‡¶Æ (‡ß≥)">
            <input id="p-income" type="number" class="swal2-input" placeholder="‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶Ü‡ßü (‡ß≥)">
            <input id="p-val" type="number" class="swal2-input" placeholder="‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ (‡¶¶‡¶ø‡¶®)">
        `,
        confirmButtonText: '‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®',
        showCancelButton: true,
        preConfirm: () => {
            return {
                name: document.getElementById('p-name').value,
                price: parseInt(document.getElementById('p-price').value),
                dailyIncome: parseInt(document.getElementById('p-income').value),
                validity: parseInt(document.getElementById('p-val').value)
            }
        }
    }).then(result => {
        if(result.isConfirmed) {
            db.ref('settings/vipPlans').push(result.value);
            Swal.fire('‡¶∏‡¶´‡¶≤!', '‡¶®‡¶§‡ßÅ‡¶® VIP ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§', 'success');
        }
    });
}

// --- üìã HISTORY LOADER FIX (FAST & RELIABLE) ---
function renderFullHistory() {
    const container = document.getElementById('page-content');
    if (GLOBAL_HISTORY.length === 0) {
        container.innerHTML = `
            <div style="text-align:center; padding:100px 20px; color:var(--text-muted);">
                <i class="fas fa-history" style="font-size:50px; opacity:0.2; margin-bottom:20px;"></i>
                <p>‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>
            </div>
        `;
        return;
    }

    let html = `
        <div class="card" style="padding:10px; border-radius:25px;">
            <table style="width:100%; border-collapse:collapse; font-size:13px;">
                <thead>
                    <tr style="text-align:left; border-bottom:2px solid #eee;">
                        <th style="padding:15px;">‡¶á‡¶â‡¶ú‡¶æ‡¶∞</th>
                        <th style="padding:15px;">‡¶ß‡¶∞‡¶£</th>
                        <th style="padding:15px;">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
                        <th style="padding:15px;">‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th>
                    </tr>
                </thead>
                <tbody>
    `;

    GLOBAL_HISTORY.forEach(h => {
        let statusColor = h.status === 'Success' ? '#10B981' : (h.status === 'Pending' ? '#F59E0B' : '#EF4444');
        html += `
            <tr style="border-bottom:1px solid #f1f1f1;">
                <td style="padding:15px;"><b>${h.userName}</b><br><small>${h.uid}</small></td>
                <td style="padding:15px;">${h.type}</td>
                <td style="padding:15px;"><b>‡ß≥${h.amount}</b></td>
                <td style="padding:15px;"><span style="color:${statusColor}; font-weight:800;">${h.status}</span></td>
            </tr>
        `;
    });

    html += `</tbody></table></div>`;
    container.innerHTML = html;
}

// --- üõ†Ô∏è HELPER FUNCTIONS ---
function openModal(id) {
    document.getElementById(id).style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

function closeModal(id) {
    document.getElementById(id).style.display = 'none';
    document.body.style.overflow = 'auto';
}

function adminLogout() {
    Swal.fire({
        title: '‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü?',
        text: "‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶ö‡¶æ‡¶®?",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#EF4444',
        confirmButtonText: '‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, ‡¶¨‡ßá‡¶∞ ‡¶π‡¶¨‡ßã'
    }).then((result) => {
        if (result.isConfirmed) {
            sessionStorage.clear();
            location.reload();
        }
    });
}

function searchUser(query) {
    const filter = query.toLowerCase();
    const rows = document.querySelectorAll('.u-item');
    rows.forEach(row => {
        const text = row.getAttribute('data-search').toLowerCase();
        row.style.display = text.includes(filter) ? 'flex' : 'none';
    });
}

// --- üìà ANIMATION ON LOAD ---
document.addEventListener('DOMContentLoaded', () => {
    // Add smooth hover effects to menu items
    const menuItems = document.querySelectorAll('.menu-item');
    menuItems.forEach(item => {
        item.addEventListener('mouseenter', () => playTickSound());
    });
});

function playTickSound() {
    // Optional: Add a subtle audio feedback for a pro feel
}

</script>
</body>
</html>
 
