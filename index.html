<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>টাকার গাছ Admin Panel V2.0 Pro</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #10b981; --dark: #111827; --light: #f3f4f6; --white: #ffffff;
            --sidebar-w: 260px; --header-h: 65px;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        * { box-sizing: border-box; outline: none; text-decoration: none; font-family: 'Inter', 'Hind Siliguri', sans-serif; }
        body { margin: 0; background: var(--light); height: 100vh; overflow: hidden; display: flex; }

        /* --- AUTH SCREEN --- */
        #auth-view { position: fixed; inset: 0; background: var(--dark); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: var(--white); padding: 40px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
        .inp { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #e5e7eb; border-radius: 10px; font-size: 15px; background: #f9fafb; }
        .btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; transition: 0.3s; }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }

        /* --- SIDEBAR --- */
        .sidebar { 
            width: var(--sidebar-w); background: var(--dark); color: white; 
            display: flex; flex-direction: column; transition: 0.3s; 
            position: fixed; height: 100%; z-index: 1000; left: 0;
        }
        .brand { height: var(--header-h); display: flex; align-items: center; padding: 0 25px; font-size: 20px; font-weight: 800; border-bottom: 1px solid rgba(255,255,255,0.1); color: var(--primary); }
        .menu { flex: 1; padding: 20px 15px; overflow-y: auto; }
        .menu-item { 
            padding: 12px 15px; margin-bottom: 8px; border-radius: 12px; cursor: pointer; 
            display: flex; align-items: center; gap: 12px; color: #9ca3af; transition: 0.2s; font-size: 14px; font-weight: 500;
        }
        .menu-item:hover, .menu-item.active { background: var(--primary); color: white; box-shadow: 0 5px 15px rgba(16, 185, 129, 0.2); }
        
        /* --- MAIN CONTENT --- */
        .main { flex: 1; margin-left: var(--sidebar-w); display: flex; flex-direction: column; height: 100%; transition: 0.3s; background: #F3F4F6; }
        .header { 
            height: var(--header-h); background: var(--white); display: flex; align-items: center; 
            justify-content: space-between; padding: 0 25px; border-bottom: 1px solid #e5e7eb; box-shadow: var(--shadow);
        }
        .content { flex: 1; padding: 25px; overflow-y: auto; }

        /* --- RESPONSIVE --- */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 900; display: none; }
        .mobile-toggle { display: none; font-size: 24px; cursor: pointer; color: var(--dark); }
        
        @media (max-width: 768px) {
            .sidebar { left: -100%; }
            .sidebar.active { left: 0; }
            .main { margin-left: 0; }
            .mobile-toggle { display: block; }
            .overlay.active { display: block; }
        }

        /* --- CARDS & TABLES --- */
        .grid-4 { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--white); padding: 25px; border-radius: 16px; box-shadow: var(--shadow); display: flex; justify-content: space-between; align-items: center; border-left: 5px solid var(--primary); }
        .stat-card h3 { margin: 0; font-size: 28px; font-weight: 800; color: var(--dark); }
        .stat-card p { margin: 5px 0 0; color: #6b7280; font-size: 13px; font-weight: 600; }
        
        .card { background: var(--white); border-radius: 16px; padding: 25px; box-shadow: var(--shadow); margin-bottom: 20px; border: 1px solid #e5e7eb; overflow-x: auto; }
        .card h3 { margin-top: 0; color: var(--dark); border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 20px; }

        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #f3f4f6; font-size: 14px; }
        th { background: #f9fafb; font-weight: 700; color: #374151; text-transform: uppercase; font-size: 12px; }
        tr:hover { background: #f9fafb; }

        /* --- UTILS --- */
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 700; }
        .badge-p { background: #FEF3C7; color: #D97706; } /* Pending */
        .badge-s { background: #D1FAE5; color: #059669; } /* Success */
        .badge-r { background: #FEE2E2; color: #DC2626; } /* Reject */

        .btn-sm { padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; border: none; color: white; margin-right: 5px; }
        .btn-g { background: #10b981; }
        .btn-r { background: #ef4444; }
        .btn-b { background: #3b82f6; }

        /* Select Input */
        select.inp { appearance: none; background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23007CB2%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E"); background-repeat: no-repeat; background-position: right .7em top 50%; background-size: .65em auto; }
    </style>
</head>
<body>

    <div id="auth-view">
        <div class="login-box">
            <i class="fas fa-shield-alt" style="font-size: 50px; color: var(--primary); margin-bottom: 20px;"></i>
            <h2>Admin Panel V2.0</h2>
            <input id="u" class="inp" placeholder="Username">
            <input id="p" type="password" class="inp" placeholder="Password">
            <button class="btn" onclick="login()">Login Dashboard</button>
        </div>
    </div>

    <div id="dashboard" style="display:none; width:100%">
        <div class="overlay" onclick="toggleSidebar()"></div>

        <div class="sidebar" id="sidebar">
            <div class="brand">
                <i class="fas fa-tree" style="margin-right:10px"></i> টাকার গাছ
            </div>
            <div class="menu">
                <div class="menu-item active" onclick="nav('dash',this)"><i class="fas fa-th-large"></i> Dashboard</div>
                <div class="menu-item" onclick="nav('users',this)"><i class="fas fa-users"></i> All Users</div>
                <div class="menu-item" onclick="nav('deposits',this)"><i class="fas fa-arrow-circle-down"></i> Deposits <span id="dep-c" class="badge badge-p" style="margin-left:auto; display:none">0</span></div>
                <div class="menu-item" onclick="nav('withdraws',this)"><i class="fas fa-arrow-circle-up"></i> Withdraws <span id="wd-c" class="badge badge-p" style="margin-left:auto; display:none">0</span></div>
                <div class="menu-item" onclick="nav('tasks',this)"><i class="fas fa-tasks"></i> Task Manager</div>
                <div class="menu-item" onclick="nav('settings',this)"><i class="fas fa-cogs"></i> App Settings</div>
            </div>
            <div style="padding:20px; margin-top:auto">
                <button class="btn" style="background:rgba(255,255,255,0.1); font-size:12px" onclick="logout()">LOGOUT</button>
            </div>
        </div>

        <div class="main">
            <div class="header">
                <div style="display:flex; align-items:center; gap:15px">
                    <i class="fas fa-bars mobile-toggle" onclick="toggleSidebar()"></i>
                    <h3 id="pg-title" style="margin:0; font-size:18px">Overview</h3>
                </div>
                <div style="display:flex; align-items:center; gap:10px">
                    <span class="badge badge-s">Admin</span>
                    <i class="fas fa-user-circle" style="font-size:30px; color:var(--dark)"></i>
                </div>
            </div>
            <div class="content" id="main-body"></div>
        </div>
    </div>

    <script>
        // CONFIG
        const firebaseConfig = { apiKey: "AIzaSyDgI-d8iwWr40tmknbY6jhH0oRb2Tvg4d0", authDomain: "takar-gach-a1d84.firebaseapp.com", databaseURL: "https://takar-gach-a1d84-default-rtdb.firebaseio.com", projectId: "takar-gach-a1d84", storageBucket: "takar-gach-a1d84.firebasestorage.app", messagingSenderId: "637802367074", appId: "1:637802367074:web:2e7f6c0670ec47f3a1693b", measurementId: "G-0QL9LB7BSK" };
        firebase.initializeApp(firebaseConfig); const db = firebase.database();
        const CRED = { u: 'JIHAD', p: '198373' };

        window.onload = () => { if(sessionStorage.getItem('adm_ok')) showDash(); };

        function login(){
            const u = document.getElementById('u').value, p = document.getElementById('p').value;
            if(u===CRED.u && p===CRED.p) { sessionStorage.setItem('adm_ok',true); showDash(); }
            else Swal.fire('Error','Invalid Credentials','error');
        }
        function logout(){ sessionStorage.removeItem('adm_ok'); location.reload(); }
        function showDash(){ document.getElementById('auth-view').style.display='none'; document.getElementById('dashboard').style.display='flex'; loadPage('dash'); count(); }
        function toggleSidebar(){ document.getElementById('sidebar').classList.toggle('active'); document.querySelector('.overlay').classList.toggle('active'); }

        function nav(p,e){
            document.querySelectorAll('.menu-item').forEach(i=>i.classList.remove('active'));
            if(e) e.classList.add('active');
            if(window.innerWidth<768) toggleSidebar();
            loadPage(p);
        }

        function loadPage(page){
            const c = document.getElementById('main-body');
            c.innerHTML = '<div style="text-align:center;padding:50px"><i class="fas fa-circle-notch fa-spin fa-2x" style="color:var(--primary)"></i></div>';
            const t = document.getElementById('pg-title');

            if(page === 'dash'){
                t.innerText = "Dashboard";
                db.ref('users').once('value', s=>{
                    const u = s.val()||{};
                    let bal = 0; Object.values(u).forEach(x=>bal+=(x.balance||0));
                    c.innerHTML = `
                    <div class="grid-4">
                        <div class="stat-card"><div><h3>${Object.keys(u).length}</h3><p>Total Users</p></div><i class="fas fa-users fa-2x" style="color:#3b82f6"></i></div>
                        <div class="stat-card" style="border-color:#10b981"><div><h3>৳${bal}</h3><p>User Balance</p></div><i class="fas fa-wallet fa-2x" style="color:#10b981"></i></div>
                    </div>
                    <div class="card">
                        <h3>Recent Joins</h3>
                        <table><thead><tr><th>Name</th><th>Phone</th><th>Balance</th></tr></thead><tbody>${Object.values(u).slice(-5).reverse().map(x=>`<tr><td>${x.name}</td><td>${x.phone}</td><td>৳${x.balance}</td></tr>`).join('')}</tbody></table>
                    </div>`;
                });
            }
            else if(page === 'tasks'){
                t.innerText = "Task Manager";
                c.innerHTML = `
                <div class="card">
                    <h3>Add New Task</h3>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px">
                        <input id="t-ti" class="inp" placeholder="Task Title (e.g. Subscribe Channel)">
                        <input id="t-rw" type="number" class="inp" placeholder="Reward (Tk)">
                        <input id="t-ln" class="inp" placeholder="Link (YouTube/Telegram/FB)">
                        <select id="t-ty" class="inp"><option value="free">Free Task</option><option value="vip">VIP Task</option></select>
                    </div>
                    <button class="btn" style="margin-top:10px" onclick="addTask()">Add Task</button>
                </div>
                <div class="card"><h3>Active Tasks</h3><table id="task-t"></table></div>`;
                db.ref('settings/tasks').on('value',s=>{
                    const t = s.val()||{};
                    document.getElementById('task-t').innerHTML = `<thead><tr><th>Title</th><th>Reward</th><th>Type</th><th>Link</th><th>Action</th></tr></thead><tbody>` + 
                    Object.keys(t).map(k=>`<tr><td>${t[k].title}</td><td>৳${t[k].reward}</td><td><span class="badge ${t[k].target=='vip'?'badge-p':'badge-s'}">${t[k].target.toUpperCase()}</span></td><td style="font-size:10px;max-width:100px;overflow:hidden">${t[k].link}</td><td><button class="btn-sm btn-r" onclick="delTask('${k}')">Del</button></td></tr>`).join('') + `</tbody>`;
                });
            }
            else if(page === 'users'){
                t.innerText = "User Management";
                db.ref('users').once('value',s=>{
                    const u = s.val()||{};
                    c.innerHTML = `
                    <div class="card">
                        <input onkeyup="search(this)" class="inp" placeholder="Search by Phone..." style="max-width:300px">
                        <table><thead><tr><th>Name/UID</th><th>Phone</th><th>Balance</th><th>Action</th></tr></thead><tbody id="u-list">${Object.keys(u).map(k=>`<tr><td>${u[k].name}<br><small>${u[k].uid}</small></td><td>${u[k].phone}</td><td>৳${u[k].balance}</td><td><button class="btn-sm btn-b" onclick="edit('${k}',${u[k].balance})">Edit</button> <button class="btn-sm btn-r" onclick="del('${k}')">Del</button></td></tr>`).join('')}</tbody></table>
                    </div>`;
                });
            }
            else if(page === 'deposits' || page === 'withdraws'){
                const type = page==='deposits'?'Buy':'Withdraw';
                t.innerText = page.toUpperCase() + " Requests";
                db.ref('users').once('value',s=>{
                    let htm = `<thead><tr><th>User</th><th>Details</th><th>Trx/Num</th><th>Action</th></tr></thead><tbody>`;
                    let has = false;
                    const u = s.val()||{};
                    Object.keys(u).forEach(uid=>{
                        const h = u[uid].history||{};
                        Object.keys(h).forEach(hid=>{
                            const tr = h[hid];
                            if(tr.status==='Pending' && ((type==='Buy' && tr.type.includes('Buy')) || (type==='Withdraw' && tr.type==='Withdraw'))){
                                has = true;
                                htm += `<tr><td>${u[uid].name}<br><small>${u[uid].phone}</small></td><td>${tr.type}<br><b>৳${tr.amount}</b></td><td>${tr.trx||tr.sender||tr.method}</td><td><button class="btn-sm btn-g" onclick="act('${uid}','${hid}','Success','${tr.type}',${tr.amount})">✔</button> <button class="btn-sm btn-r" onclick="act('${uid}','${hid}','Rejected','${tr.type}',${tr.amount})">✖</button></td></tr>`;
                            }
                        });
                    });
                    c.innerHTML = `<div class="card"><table>${has?htm:'<tr><td colspan="4" style="text-align:center">No Pending Requests</td></tr>'}</tbody></table></div>`;
                });
            }
            else if(page === 'settings'){
                t.innerText = "Settings";
                db.ref('settings').once('value',s=>{
                    const v = s.val()||{};
                    c.innerHTML = `
                    <div class="card" style="max-width:500px">
                        <h3>Payment Numbers</h3>
                        <label>Bkash:</label><input id="s-bk" class="inp" value="${v.config?.bkash||''}">
                        <label>Nagad:</label><input id="s-ng" class="inp" value="${v.config?.nagad||''}">
                        <h3>Notice Board</h3>
                        <textarea id="s-nt" class="inp" rows="3">${v.notice||''}</textarea>
                        <button class="btn" onclick="saveSet()">Save Changes</button>
                    </div>`;
                });
            }
        }

        // ACTIONS
        function addTask(){
            const d = {
                title: document.getElementById('t-ti').value,
                reward: parseInt(document.getElementById('t-rw').value),
                link: document.getElementById('t-ln').value,
                target: document.getElementById('t-ty').value
            };
            if(!d.title) return Swal.fire('Error','Fill all fields');
            db.ref('settings/tasks').push(d); Swal.fire('Added','Task Live!','success');
        }
        function delTask(k){ db.ref('settings/tasks/'+k).remove(); }

        function act(uid, hid, st, type, amt){
            db.ref(`users/${uid}/history/${hid}`).update({status:st});
            if(st==='Success' && type.includes('Buy')){
                db.ref(`users/${uid}`).update({isVip:true, currentPlan:type.replace('Buy ',''), vipExpire:Date.now()+(30*86400000)});
            } else if(st==='Rejected' && type==='Withdraw'){
                db.ref(`users/${uid}/balance`).transaction(b=>(b||0)+parseInt(amt));
            }
            Swal.fire('Done', 'Status Updated', 'success'); loadPage(type==='Withdraw'?'withdraws':'deposits'); count();
        }

        function saveSet(){
            db.ref('settings/config').update({ bkash: document.getElementById('s-bk').value, nagad: document.getElementById('s-ng').value });
            db.ref('settings').update({ notice: document.getElementById('s-nt').value });
            Swal.fire('Saved');
        }

        function edit(uid, old){
            Swal.fire({title:'Update Balance', input:'number', inputValue:old}).then(res=>{
                if(res.value){ db.ref('users/'+uid).update({balance:parseInt(res.value)}); loadPage('users'); }
            });
        }
        function del(uid){ if(confirm('Delete user?')) db.ref('users/'+uid).remove().then(()=>loadPage('users')); }

        function count(){
            db.ref('users').once('value',s=>{
                let d=0, w=0; const u=s.val()||{};
                Object.values(u).forEach(x=>{ if(x.history) Object.values(x.history).forEach(h=>{ if(h.status==='Pending'){ if(h.type==='Withdraw')w++; else d++; } }) });
                document.getElementById('dep-c').innerText=d; document.getElementById('dep-c').style.display=d>0?'inline-block':'none';
                document.getElementById('wd-c').innerText=w; document.getElementById('wd-c').style.display=w>0?'inline-block':'none';
            });
        }
        function search(e){
            const v = e.value.toLowerCase();
            document.querySelectorAll('#u-list tr').forEach(r => r.style.display = r.innerText.toLowerCase().includes(v)?'':'none');
        }
    </script>
</body>
</html>

