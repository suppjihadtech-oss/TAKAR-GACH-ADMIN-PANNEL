<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ó‡¶æ‡¶õ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® V7.0</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #10b981; --primary-dark: #047857; --bg-body: #F0F2F5; --text-main: #111827; --text-muted: #6B7280; --shadow: 0 4px 20px rgba(0,0,0,0.05); }
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg-body); font-family: 'Inter', 'Hind Siliguri', sans-serif; color: var(--text-main); padding-bottom: 90px; user-select: none; }

        /* GROWING TREE SPLASH */
        #splash-screen { position: fixed; inset: 0; background: var(--bg-body); z-index: 6000; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .growing-tree { font-size: 0px; color: var(--primary); margin-bottom: 20px; animation: growTree 2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; transform-origin: bottom center; }
        @keyframes growTree { 0% { font-size: 0px; opacity: 0; transform: translateY(50px); } 30% { font-size: 40px; opacity: 0.5; } 60% { font-size: 70px; opacity: 0.8; } 100% { font-size: 90px; opacity: 1; transform: translateY(0); } }

        #auth-view { position: fixed; inset: 0; background: var(--bg-body); z-index: 5000; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .login-box { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); padding: 40px 30px; border-radius: 24px; width: 100%; max-width: 350px; text-align: center; border: 1px solid white; box-shadow: var(--shadow); }
        .inp { width: 100%; padding: 14px; margin-bottom: 15px; border: 1px solid #E5E7EB; border-radius: 12px; background: #F9FAFB; font-size: 15px; transition: 0.3s; }
        .inp:focus { border-color: var(--primary); background: white; }
        .btn { width: 100%; padding: 14px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border: none; border-radius: 12px; font-weight: 700; font-size: 16px; cursor: pointer; box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3); }
        .btn:active { transform: scale(0.98); }

        .header { position: sticky; top: 0; background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(10px); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.05); z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        .content-area { padding: 15px; display: none; animation: fadeIn 0.3s; }
        .content-area.active { display: block; }
        @keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }

        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-box { background: white; padding: 20px; border-radius: 16px; text-align: center; box-shadow: var(--shadow); border-bottom: 4px solid var(--primary); }
        .menu-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .menu-btn { background: white; border: 1px solid #F3F4F6; border-radius: 16px; padding: 15px 5px; text-align: center; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 90px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .menu-btn:active { transform: scale(0.95); background: #ECFDF5; border-color: var(--primary); }
        .card { background: white; border-radius: 16px; padding: 20px; margin-bottom: 15px; box-shadow: var(--shadow); border: 1px solid #F3F4F6; }
        
        /* SWITCH TOGGLE */
        .switch { position: relative; display: inline-block; width: 45px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(21px); }
        /* Red switch for maintenance */
        .switch-red input:checked + .slider { background-color: #EF4444; }

        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(255,255,255,0.95); border-top: 1px solid #E5E7EB; padding: 10px 15px; display: flex; justify-content: space-around; z-index: 1000; padding-bottom: 15px; backdrop-filter: blur(10px); border-radius: 20px 20px 0 0; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); }
        .nav-item { text-align: center; color: var(--text-muted); cursor: pointer; transition: 0.2s; position: relative; }
        .nav-item.active { color: var(--primary); transform: translateY(-5px); }
        .nav-badge { position: absolute; top: -5px; right: -5px; background: #EF4444; color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; font-weight: bold; }
        
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 2000; display: none; justify-content: center; align-items: center; padding: 20px; }
        .modal-box { background: white; width: 100%; max-width: 400px; padding: 25px; border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        .btn-sm { padding: 6px 12px; border-radius: 8px; font-size: 12px; border: none; color: white; cursor: pointer; margin-left: 5px; font-weight: 600; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #F9FAFB; border-radius: 12px; margin-bottom: 8px; border: 1px solid #E5E7EB; }
        .badge { padding: 3px 10px; border-radius: 20px; font-size: 10px; font-weight: 700; text-transform: uppercase; }
        .badge-vip { background: #FEF3C7; color: #D97706; } .badge-success { background: #D1FAE5; color: #059669; } .badge-reject { background: #FEE2E2; color: #DC2626; }
    </style>
</head>
<body>

    <div id="splash-screen"><i class="fas fa-tree growing-tree"></i><h1 style="color:var(--text-main);margin:0">‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ó‡¶æ‡¶õ</h1><small style="color:var(--text-muted)">‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ V7.0</small></div>

    <div id="auth-view" style="display:none"><div class="login-box"><i class="fas fa-user-shield" style="font-size:50px;color:var(--primary);margin-bottom:20px"></i><h2 style="margin:0 0 20px">‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®</h2><input id="u" class="inp" placeholder="‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ"><input id="p" type="password" class="inp" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°"><button class="btn" onclick="login()">‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button></div></div>

    <div id="dashboard" style="display:none">
        <div class="header"><h2><i class="fas fa-tree" style="color:var(--primary)"></i> ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ó‡¶æ‡¶õ</h2><div onclick="location.reload()" style="background:#F3F4F6;padding:8px;border-radius:50%;cursor:pointer"><i class="fas fa-sync-alt" style="color:var(--primary)"></i></div></div>

        <div id="home-view" class="content-area active">
            <div class="stat-grid">
                <div class="stat-box"><h1 id="total-u">0</h1><p>‡¶Æ‡ßã‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</p></div>
                <div class="stat-box" style="border-color:#3b82f6"><h1 id="total-b">‡ß≥0</h1><p>‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p></div>
                <div class="stat-box" style="border-color:#10b981"><h1 id="total-dep" style="color:#10b981">‡ß≥0</h1><p>‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</p></div>
                <div class="stat-box" style="border-color:#ef4444"><h1 id="total-wd" style="color:#ef4444">‡ß≥0</h1><p>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</p></div>
            </div>
            <div style="background:linear-gradient(135deg,#1F2937,#111827);padding:15px;border-radius:16px;text-align:center;color:white;margin-bottom:20px"><small>‡¶®‡¶ø‡¶ü ‡¶™‡ßç‡¶∞‡¶´‡¶ø‡¶ü</small><h1 id="net-profit" style="margin:5px 0">‡ß≥0</h1></div>
            <div class="menu-grid">
                <div class="menu-btn" onclick="nav('users')"><i class="fas fa-users"></i><span>‡¶á‡¶â‡¶ú‡¶æ‡¶∞</span></div>
                <div class="menu-btn" onclick="nav('plans')"><i class="fas fa-crown"></i><span>VIP ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®</span></div>
                <div class="menu-btn" onclick="nav('deposits')"><i class="fas fa-arrow-down"></i><span>‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</span></div>
                <div class="menu-btn" onclick="nav('withdraws')"><i class="fas fa-arrow-up"></i><span>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</span></div>
                <div class="menu-btn" onclick="nav('tasks')"><i class="fas fa-tasks"></i><span>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</span></div>
                <div class="menu-btn" onclick="nav('job_reqs')"><i class="fas fa-briefcase"></i><span>‡¶ú‡¶¨ ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠‡¶æ‡¶≤</span></div>
                <div class="menu-btn" onclick="nav('history')"><i class="fas fa-history" style="color:#F59E0B"></i><span>‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø</span></div>
                <div class="menu-btn" onclick="nav('settings')"><i class="fas fa-cogs"></i><span>‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</span></div>
            </div>
            <div class="card"><h3>‡¶®‡¶§‡ßÅ‡¶® ‡¶ú‡ßü‡ßá‡¶®‡¶ø‡¶Ç</h3><div id="recent-list"></div></div>
            <button class="btn" style="background:#EF4444;margin-top:20px" onclick="logout()">‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</button>
        </div>

        <div id="dynamic-view" class="content-area">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px"><h3 id="page-title" style="margin:0;color:var(--primary)">...</h3><button class="btn-sm" style="background:#374151" onclick="goHome()">‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï</button></div>
            <div id="page-content"></div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" onclick="goHome()"><i class="fas fa-home"></i><span>‡¶π‡ßã‡¶Æ</span></div>
            <div class="nav-item" onclick="nav('users')"><i class="fas fa-users"></i><span>‡¶á‡¶â‡¶ú‡¶æ‡¶∞</span></div>
            <div class="nav-item" onclick="nav('job_reqs')"><i class="fas fa-check-circle"></i><span>‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠‡¶æ‡¶≤</span><span id="nav-badge" class="nav-badge" style="display:none">0</span></div>
            <div class="nav-item" onclick="nav('history')"><i class="fas fa-history"></i><span>‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø</span></div>
        </div>
    </div>

    <div id="user-modal" class="modal"><div class="modal-box"><h3>‡¶è‡¶°‡¶ø‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</h3><input type="hidden" id="e-uid"><label>‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</label><input id="e-bal" type="number" class="inp"><label>‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®</label><input id="e-plan" class="inp"><label>‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°</label><input id="e-pass" class="inp"><div style="display:flex;gap:10px;margin-top:10px"><button class="btn" style="background:#EF4444" onclick="doBan()" id="ban-btn">‡¶¨‡ßç‡¶Ø‡¶æ‡¶®</button><button class="btn" onclick="saveUser()">‡¶∏‡ßá‡¶≠</button></div><button onclick="closeModal('user-modal')" style="background:transparent;border:none;color:#999;width:100%;margin-top:10px">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button></div></div>
    <div id="plan-modal" class="modal"><div class="modal-box"><h3>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®</h3><input id="p-name" class="inp" placeholder="‡¶®‡¶æ‡¶Æ"><input id="p-price" type="number" class="inp" placeholder="‡¶¶‡¶æ‡¶Æ"><input id="p-inc" type="number" class="inp" placeholder="‡¶á‡¶®‡¶ï‡¶æ‡¶Æ"><input id="p-val" type="number" class="inp" placeholder="‡¶Æ‡ßá‡ßü‡¶æ‡¶¶"><button class="btn" onclick="savePlan()">‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button><button onclick="closeModal('plan-modal')" style="background:transparent;border:none;color:#999;width:100%;margin-top:10px">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button></div></div>
    <div id="detail-modal" class="modal"><div class="modal-box"><h3 style="text-align:center">‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</h3><div id="rec-content"></div><button onclick="closeModal('detail-modal')" class="btn" style="margin-top:20px">‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá</button></div></div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyDgI-d8iwWr40tmknbY6jhH0oRb2Tvg4d0", authDomain: "takar-gach-a1d84.firebaseapp.com", databaseURL: "https://takar-gach-a1d84-default-rtdb.firebaseio.com", projectId: "takar-gach-a1d84", storageBucket: "takar-gach-a1d84.firebasestorage.app", messagingSenderId: "637802367074", appId: "1:637802367074:web:2e7f6c0670ec47f3a1693b", measurementId: "G-0QL9LB7BSK" };
        firebase.initializeApp(firebaseConfig); const db = firebase.database();
        const CRED = { u: 'JIHAD', p: '198373' };

        window.onload = () => { setTimeout(() => { document.getElementById('splash-screen').style.display='none'; if(sessionStorage.getItem('adm_ok')) showDash(); else document.getElementById('auth-view').style.display='flex'; }, 3000); };
        function login(){ const u=document.getElementById('u').value, p=document.getElementById('p').value; if(u===CRED.u && p===CRED.p) { sessionStorage.setItem('adm_ok',true); showDash(); } else Swal.fire('‡¶≠‡ßÅ‡¶≤','‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡ßü','error'); }
        function logout(){ sessionStorage.removeItem('adm_ok'); location.reload(); }
        function showDash(){ document.getElementById('auth-view').style.display='none'; document.getElementById('dashboard').style.display='block'; loadHomeData(); count(); }
        function goHome(){ document.getElementById('dynamic-view').classList.remove('active'); document.getElementById('home-view').classList.add('active'); loadHomeData(); }

        function loadHomeData(){
            db.ref('users').once('value', s=>{
                const u = s.val()||{}; let bal=0, dep=0, wd=0;
                Object.values(u).forEach(x=>{ bal+=(x.balance||0); if(x.history) Object.values(x.history).forEach(h=>{ if(h.status==='Success'){ if(h.type.includes('Buy')) dep+=parseInt(h.amount); else if(h.type==='Withdraw') wd+=parseInt(h.amount); } }); });
                document.getElementById('total-u').innerText = Object.keys(u).length; document.getElementById('total-b').innerText = '‡ß≥'+bal; document.getElementById('total-dep').innerText = '‡ß≥'+dep; document.getElementById('total-wd').innerText = '‡ß≥'+wd; document.getElementById('net-profit').innerText = '‡ß≥'+(dep-wd);
                document.getElementById('recent-list').innerHTML = Object.values(u).slice(-5).reverse().map(x=>`<div class="list-item"><div><b>${x.name}</b><br><small>${x.phone}</small></div><b style="color:var(--primary)">‡ß≥${x.balance}</b></div>`).join('');
            });
        }

        let allHistoryData=[];
        function nav(page){
            document.getElementById('home-view').classList.remove('active'); document.getElementById('dynamic-view').classList.add('active');
            const cont = document.getElementById('page-content'); const title = document.getElementById('page-title');
            cont.innerHTML = '<div style="text-align:center;padding:50px"><i class="fas fa-circle-notch fa-spin fa-2x" style="color:var(--primary)"></i></div>';

            if(page==='users'){
                title.innerText="‡¶∏‡¶ï‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞";
                db.ref('users').once('value',s=>{ const u=s.val()||{}; cont.innerHTML = `<input onkeyup="search(this)" class="inp" placeholder="‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..."><div id="u-list">${Object.keys(u).map(k=>`<div class="list-item user-row" data-ph="${u[k].phone}"><div><b>${u[k].name}</b> ${u[k].isVip?'<span class="badge badge-vip">VIP</span>':''}<br><small>${u[k].phone}</small></div><div><b style="color:var(--primary)">‡ß≥${u[k].balance}</b> <button class="btn-sm" style="background:#3b82f6" onclick="editU('${k}')"><i class="fas fa-pen"></i></button></div></div>`).join('')}</div>`; });
            }
            else if(page==='history'){
                title.innerText="‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø";
                db.ref('users').once('value',s=>{
                    const u=s.val()||{}; let histList=[]; allHistoryData=[];
                    Object.keys(u).forEach(uid=>{ const h=u[uid].history||{}; Object.keys(h).forEach(hid=>{ if(h[hid].status!=='Pending'){ histList.push({...h[hid],uid:uid,name:u[uid].name,phone:u[uid].phone}); } }); });
                    histList.reverse(); allHistoryData=histList;
                    cont.innerHTML = histList.length ? histList.map((x,i)=>`<div class="card" style="display:flex;justify-content:space-between;align-items:center;padding:15px"><div><b>${x.type}</b><br><small>${x.name} (${x.phone})</small></div><div style="text-align:right"><b>‡ß≥${x.amount}</b><br><span class="badge ${x.status==='Success'?'badge-success':'badge-reject'}">${x.status}</span> <button class="btn-sm" style="background:#3b82f6;padding:2px 6px" onclick="showReceipt(${i})">View</button></div></div>`).join('') : '<p style="text-align:center;color:#999">‡¶´‡¶æ‡¶Å‡¶ï‡¶æ</p>';
                });
            }
            else if(page==='deposits'||page==='withdraws'||page==='job_reqs'){
                const type = page==='job_reqs'?'Job':(page==='deposits'?'Deposit':'Withdraw'); title.innerText = type+' ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü';
                db.ref('users').once('value',s=>{
                    let htm=''; const u=s.val()||{};
                    Object.keys(u).forEach(uid=>{
                        const h=u[uid].history||{};
                        Object.keys(h).forEach(hid=>{
                            const tr=h[hid];
                            if(tr.status==='Pending'){
                                let show=false; if(type==='Job'&&tr.type==='Task Reward')show=true; if(type==='Deposit'&&tr.type.includes('Buy'))show=true; if(type==='Withdraw'&&tr.type==='Withdraw')show=true;
                                if(show) htm+=`<div class="card"><div style="display:flex;justify-content:space-between;margin-bottom:10px"><b>${u[uid].name}</b> <b style="color:var(--primary)">‡ß≥${tr.amount}</b></div><div style="background:#F9FAFB;padding:10px;border-radius:8px;font-size:12px;color:#666;margin-bottom:10px">${type==='Job'?`Proof: ${tr.proof}`:`Details: ${tr.trx||tr.sender} ${tr.validity?`<br>Validity: ${tr.validity} Days`:''}`}</div><div style="display:flex;gap:10px"><button class="btn" style="flex:1;background:#10b981" onclick="act('${uid}','${hid}','Success','${tr.type}',${tr.amount})">Approve</button><button class="btn" style="flex:1;background:#ef4444" onclick="act('${uid}','${hid}','Rejected','${tr.type}',${tr.amount})">Reject</button></div></div>`;
                            }
                        });
                    });
                    cont.innerHTML = htm || '<p style="text-align:center;color:#999">‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶®‡ßá‡¶á</p>';
                });
            }
            else if(page==='plans'){
                title.innerText="‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®"; cont.innerHTML=`<button class="btn" style="width:100%;margin-bottom:15px" onclick="document.getElementById('plan-modal').style.display='flex'">+ ‡¶®‡¶§‡ßÅ‡¶®</button><div id="p-list"></div>`;
                db.ref('settings/vipPlans').on('value',s=>{ cont.querySelector('#p-list').innerHTML=Object.keys(s.val()||{}).map(k=>{const p=s.val()[k]; return `<div class="card" style="text-align:center;border:1px solid var(--primary)"><h3 style="margin:0">${p.name}</h3><h1 style="color:var(--primary)">‡ß≥${p.price}</h1><small>‡¶á‡¶®‡¶ï‡¶æ‡¶Æ: ‡ß≥${p.dailyIncome} | ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶: ${p.validity} ‡¶¶‡¶ø‡¶®</small><button class="btn-sm" style="background:#ef4444;display:block;margin:10px auto" onclick="delPlan('${k}')">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button></div>`}).join(''); });
            }
            else if(page==='settings'){
                title.innerText="‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏";
                db.ref('settings').once('value',s=>{
                    const v=s.val()||{}; const cfg=v.config||{};
                    const maint=v.maintenance?'checked':''; const lang=v.language==='en'?'checked':'';
                    cont.innerHTML=`
                    <div class="card" style="border:2px solid #EF4444"><h3>‚ö†Ô∏è ‡¶á‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡ßá‡¶®‡ßç‡¶∏‡¶ø</h3><div style="display:flex;justify-content:space-between"><span>‡¶Æ‡ßá‡¶á‡¶®‡¶ü‡ßá‡¶®‡ßá‡¶®‡ßç‡¶∏ ‡¶Æ‡ßã‡¶° (App OFF)</span><label class="switch switch-red"><input type="checkbox" id="s-maint" ${maint}><span class="slider round"></span></label></div></div>
                    <div class="card"><h3>üåê ‡¶≠‡¶æ‡¶∑‡¶æ ‡¶ì ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™</h3><div style="display:flex;justify-content:space-between"><span>App Language (Eng/Ban)</span><label class="switch"><input type="checkbox" id="s-lang" ${lang}><span class="slider round"></span></label></div></div>
                    <div class="card"><h3>‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï</h3><input id="s-sup" class="inp" value="${cfg.supportLink||''}"><input id="s-ch" class="inp" value="${cfg.channelLink||''}"><input id="s-grp" class="inp" value="${cfg.groupLink||''}"></div>
                    <div class="card"><h3>‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞</h3><input id="s-bk" class="inp" value="${cfg.bkash||''}"><input id="s-ng" class="inp" value="${cfg.nagad||''}"></div>
                    <div class="card"><h3>‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü</h3><input id="s-minW" class="inp" value="${cfg.minWithdraw||20}"><input id="s-wch" class="inp" value="${cfg.withdrawCharge||5}"><input id="s-ref" class="inp" value="${cfg.refBonus||2}"></div>
                    <div class="card"><h3>‡¶®‡ßã‡¶ü‡¶ø‡¶∂</h3><textarea id="s-nt" class="inp" rows="4">${v.notice||''}</textarea><button class="btn" onclick="saveSet()">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>`;
                });
            }
            else if(page==='tasks'){
                title.innerText="‡¶ü‡¶æ‡¶∏‡ßç‡¶ï"; cont.innerHTML=`<div class="card"><h3>‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</h3><input id="t-ti" class="inp" placeholder="‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ"><input id="t-rw" type="number" class="inp" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ"><input id="t-ln" class="inp" placeholder="‡¶≤‡¶ø‡¶Ç‡¶ï"><input id="t-hint" class="inp" placeholder="‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶á‡¶®‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶æ‡¶ï‡¶∂‡¶®"><select id="t-tg" class="inp"><option value="free">‡¶´‡ßç‡¶∞‡¶ø</option><option value="vip">‡¶∏‡¶ï‡¶≤ VIP</option><option value="bronze">Bronze</option><option value="silver">Silver</option><option value="gold">Gold</option></select><button class="btn" onclick="addTask()">‡¶è‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button></div><div id="t-list"></div>`;
                db.ref('settings/tasks').on('value',s=>{ cont.querySelector('#t-list').innerHTML=Object.keys(s.val()||{}).map(k=>`<div class="list-item"><b>${s.val()[k].title}</b><button class="btn-sm" style="background:#ef4444" onclick="delTask('${k}')">X</button></div>`).join(''); });
            }
        }

        // --- CORE ACTIONS (FIXED VALIDITY) ---
        function act(uid, hid, st, type, amt){
            if(st==='Rejected'){
                Swal.fire({title:'‡¶ï‡¶æ‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®',input:'text',showCancelButton:true}).then(r=>{
                    if(r.isConfirmed){
                        const re = r.value||'‡¶Ö‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü';
                        db.ref(`users/${uid}/history/${hid}`).update({status:st,reason:re});
                        if(type==='Withdraw') db.ref(`users/${uid}/balance`).transaction(b=>(b||0)+parseInt(amt));
                        Swal.fire('Rejected','','success'); nav(type==='Task Reward'?'job_reqs':(type==='Withdraw'?'withdraws':'deposits'));
                    }
                });
            } else {
                db.ref(`users/${uid}/history/${hid}`).once('value',s=>{
                    const req = s.val()||{};
                    db.ref(`users/${uid}/history/${hid}`).update({status:st});
                    if(st==='Success'){
                        if(type.includes('Buy')){
                            const days = req.validity ? parseInt(req.validity) : 30; // üî• GET REAL VALIDITY
                            db.ref(`users/${uid}`).update({isVip:true, currentPlan:type.replace('Buy ',''), vipExpire:Date.now()+(days*86400000)});
                        } else if(type==='Task Reward') db.ref(`users/${uid}/balance`).transaction(b=>(b||0)+parseInt(amt));
                    }
                    Swal.fire('Success','','success'); nav(type==='Task Reward'?'job_reqs':(type==='Withdraw'?'withdraws':'deposits'));
                });
            }
        }

        function saveSet(){
            db.ref('settings').update({ maintenance:document.getElementById('s-maint').checked, language:document.getElementById('s-lang').checked?'en':'bn', notice:document.getElementById('s-nt').value });
            db.ref('settings/config').update({ bkash:document.getElementById('s-bk').value, nagad:document.getElementById('s-ng').value, supportLink:document.getElementById('s-sup').value, channelLink:document.getElementById('s-ch').value, groupLink:document.getElementById('s-grp').value, minWithdraw:parseInt(document.getElementById('s-minW').value), withdrawCharge:parseInt(document.getElementById('s-wch').value), refBonus:parseInt(document.getElementById('s-ref').value) });
            Swal.fire('‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
        }

        function savePlan(){ const n=document.getElementById('p-name').value, p=document.getElementById('p-price').value, i=document.getElementById('p-inc').value, v=document.getElementById('p-val').value; if(!n)return; db.ref('settings/vipPlans').push({name:n,price:parseInt(p),dailyIncome:parseInt(i),validity:parseInt(v)}); closeModal('plan-modal'); }
        function delPlan(k){ if(confirm('Delete?')) db.ref('settings/vipPlans/'+k).remove(); }
        function addTask(){ const t=document.getElementById('t-ti').value, r=document.getElementById('t-rw').value, l=document.getElementById('t-ln').value, tg=document.getElementById('t-tg').value, h=document.getElementById('t-hint').value; if(!t)return; db.ref('settings/tasks').push({title:t,reward:parseInt(r),link:l,target:tg,proofHint:h}); Swal.fire('Done'); }
        function delTask(k){ db.ref('settings/tasks/'+k).remove(); }
        let editUid=''; function editU(uid){ editUid=uid; db.ref('users/'+uid).once('value',s=>{ const u=s.val(); document.getElementById('e-bal').value=u.balance; document.getElementById('e-plan').value=u.currentPlan||''; document.getElementById('e-pass').value=''; document.getElementById('ban-btn').innerText=u.banned?"‡¶Ü‡¶®‡¶¨‡ßç‡¶Ø‡¶æ‡¶®":"‡¶¨‡ßç‡¶Ø‡¶æ‡¶®"; document.getElementById('user-modal').style.display='flex'; }); }
        function saveUser(){ let d={balance:parseInt(document.getElementById('e-bal').value),currentPlan:document.getElementById('e-plan').value,isVip:!!document.getElementById('e-plan').value}; if(document.getElementById('e-pass').value)d.pass=document.getElementById('e-pass').value; db.ref('users/'+editUid).update(d); closeModal('user-modal'); Swal.fire('Saved'); nav('users'); }
        function doBan(){ db.ref('users/'+editUid).update({banned:document.getElementById('ban-btn').innerText==="‡¶¨‡ßç‡¶Ø‡¶æ‡¶®"}); closeModal('user-modal'); nav('users'); }
        function showReceipt(i){ const d=allHistoryData[i]; const r=d.reason?`<br><b style="color:red">Reason: ${d.reason}</b>`:''; document.getElementById('rec-content').innerHTML=`<p><b>User:</b> ${d.name} (${d.phone})</p><p><b>Type:</b> ${d.type}</p><p><b>Amount:</b> ‡ß≥${d.amount}</p><p><b>Status:</b> ${d.status}</p><p><b>Proof/Trx:</b> ${d.proof||d.trx}</p>${r}`; document.getElementById('detail-modal').style.display='flex'; }
        function closeModal(id){ document.getElementById(id).style.display='none'; }
        function count(){ db.ref('users').once('value',s=>{ let c=0; const u=s.val()||{}; Object.values(u).forEach(x=>{ if(x.history) Object.values(x.history).forEach(h=>{ if(h.status==='Pending' && h.type!=='Task Reward') c++; }) }); const b=document.getElementById('nav-badge'); b.innerText=c; b.style.display=c>0?'block':'none'; }); }
        function search(e){ const v=e.value.toLowerCase(); document.querySelectorAll('.user-row').forEach(r=>r.style.display=r.dataset.ph.includes(v)?'flex':'none'); }
    </script>
</body>
</html>

