<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin V4.1 - JIHAD</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Hind+Siliguri:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg: #0b1120;
            --card: rgba(30, 41, 59, 0.7);
            --primary: #00e5ff;
            --accent: #d946ef;
            --text: #f8fafc;
            --text-gray: #94a3b8;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: 'Rajdhani', sans-serif; background: var(--bg); color: var(--text); padding-bottom: 80px; overflow-x: hidden; }
        
        /* LOGIN SCREEN */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0b1120; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; background-image: radial-gradient(circle at 50% 50%, #1e293b 0%, #0b1120 100%); }
        .login-box { background: rgba(255,255,255,0.05); padding: 30px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); width: 85%; max-width: 350px; text-align: center; backdrop-filter: blur(10px); box-shadow: 0 0 30px rgba(0, 229, 255, 0.1); }
        .login-inp { width: 100%; padding: 15px; margin: 10px 0; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; color: var(--primary); font-size: 16px; text-align: center; font-weight: bold; letter-spacing: 1px; }
        .login-btn { width: 100%; padding: 15px; background: linear-gradient(45deg, var(--primary), #2979ff); border: none; border-radius: 10px; color: #000; font-weight: 800; font-size: 16px; cursor: pointer; text-transform: uppercase; margin-top: 10px; box-shadow: 0 5px 15px rgba(0, 229, 255, 0.3); transition: 0.2s; }
        .login-btn:active { transform: scale(0.95); }

        /* HEADER */
        .top-bar { padding: 20px; display: flex; justify-content: space-between; align-items: center; background: rgba(11, 17, 32, 0.9); backdrop-filter: blur(5px); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .brand { font-size: 24px; font-weight: 700; color: var(--primary); letter-spacing: 1px; }
        .logout-btn { color: var(--accent); font-size: 20px; cursor: pointer; }

        /* SECTIONS */
        .section { display: none; padding: 15px; animation: fadeIn 0.4s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* CARDS */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.05); text-align: center; }
        .stat-card h2 { margin: 0; font-size: 32px; color: var(--text); }
        .stat-card p { margin: 5px 0 0; color: var(--text-gray); font-size: 12px; text-transform: uppercase; letter-spacing: 1px; }
        .icon-glow { font-size: 24px; margin-bottom: 5px; filter: drop-shadow(0 0 5px currentColor); }

        /* INPUTS & TABLES */
        .box { background: var(--card); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.05); }
        .inp-field { width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white; margin-bottom: 10px; font-family: 'Hind Siliguri', sans-serif; }
        .action-btn { width: 100%; padding: 12px; background: var(--primary); border: none; border-radius: 8px; color: #000; font-weight: bold; cursor: pointer; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; color: var(--text-gray); font-size: 11px; text-transform: uppercase; padding: 5px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        td { padding: 10px 5px; font-size: 13px; border-bottom: 1px solid rgba(255,255,255,0.05); font-family: 'Hind Siliguri', sans-serif; }
        
        .status-btn { padding: 5px 10px; border-radius: 5px; border: none; cursor: pointer; font-size: 12px; font-weight: bold; margin-right: 5px; }
        .bg-green { background: #10b981; color: white; }
        .bg-red { background: #ef4444; color: white; }

        /* BOTTOM NAVIGATION */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #0f172a; border-top: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-around; padding: 12px 0; z-index: 999; backdrop-filter: blur(10px); }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--text-gray); font-size: 10px; cursor: pointer; transition: 0.3s; width: 25%; }
        .nav-item i { font-size: 20px; margin-bottom: 4px; transition: 0.3s; }
        .nav-item.active { color: var(--primary); }
        .nav-item.active i { transform: translateY(-3px); filter: drop-shadow(0 0 5px var(--primary)); }

    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <i class="fas fa-fingerprint" style="font-size: 50px; color: var(--primary); margin-bottom: 20px;"></i>
            <h2 style="margin: 0 0 20px 0; font-family: 'Rajdhani'; letter-spacing: 2px;">SECURE ACCESS</h2>
            <input type="text" id="l-user" class="login-inp" placeholder="USERNAME">
            <input type="password" id="l-pass" class="login-inp" placeholder="PASSWORD">
            <button class="login-btn" onclick="doLogin()">UNLOCK</button>
            <p id="msg" style="color: #ef4444; margin-top: 10px; font-size: 12px;"></p>
        </div>
    </div>

    <div id="admin-panel" style="display: none;">
        
        <div class="top-bar">
            <div class="brand"><i class="fas fa-tree"></i> ADMIN v4</div>
            <i class="fas fa-power-off logout-btn" onclick="location.reload()"></i>
        </div>

        <div id="dashboard" class="section active">
            <div class="grid">
                <div class="stat-card">
                    <i class="fas fa-users icon-glow" style="color: #3b82f6;"></i>
                    <h2 id="st-users">...</h2>
                    <p>Total Users</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-clock icon-glow" style="color: #f59e0b;"></i>
                    <h2 id="st-pending">...</h2>
                    <p>Pending</p>
                </div>
            </div>

            <div class="box">
                <h3 style="margin-top:0; color:var(--primary);">üì¢ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂</h3>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="notice-txt" class="inp-field" placeholder="‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." style="margin:0;">
                    <button class="action-btn" style="width: auto;" onclick="updateNotice()">Send</button>
                </div>
            </div>
        </div>

        <div id="tasks" class="section">
            <div class="box">
                <h3 style="margin-top:0;">‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</h3>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="text" id="t-title" class="inp-field" placeholder="‡¶ü‡¶æ‡¶á‡¶ü‡ßá‡¶≤">
                    <input type="number" id="t-reward" class="inp-field" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ">
                </div>
                <input type="text" id="t-link" class="inp-field" placeholder="‡¶≤‡¶ø‡¶Ç‡¶ï (https://)">
                <select id="t-type" class="inp-field" style="background:#0b1120;">
                    <option value="telegram">Telegram</option>
                    <option value="youtube">YouTube</option>
                    <option value="facebook">Facebook</option>
                </select>
                <button class="action-btn" onclick="addTask()">PUBLISH TASK</button>
            </div>

            <div class="box" style="padding: 10px;">
                <h3 style="margin: 10px;">üìã ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</h3>
                <table id="task-table">
                    <thead><tr><th>Task</th><th>Tk</th><th>Del</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div id="users" class="section">
            <div class="box">
                <h3 style="margin-top:0;">üë• ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</h3>
                <input type="text" id="search-user" class="inp-field" placeholder="‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ (01...)" onkeyup="searchUser()">
                <div id="user-result"></div>
            </div>
        </div>

        <div id="requests" class="section">
            <div class="box" style="padding: 10px;">
                <h3 style="margin: 10px;">üí∏ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü</h3>
                <table id="req-table">
                    <thead><tr><th>User</th><th>Method</th><th>Amt</th><th>Action</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" onclick="nav('dashboard', this)">
                <i class="fas fa-chart-pie"></i>
                <span>Home</span>
            </div>
            <div class="nav-item" onclick="nav('tasks', this)">
                <i class="fas fa-list-check"></i>
                <span>Tasks</span>
            </div>
            <div class="nav-item" onclick="nav('users', this)">
                <i class="fas fa-search"></i>
                <span>Users</span>
            </div>
            <div class="nav-item" onclick="nav('requests', this)">
                <i class="fas fa-bell"></i>
                <span>Reqs</span>
            </div>
        </div>

    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyDgI-d8iwWr40tmknbY6jhH0oRb2Tvg4d0", authDomain: "takar-gach-a1d84.firebaseapp.com", databaseURL: "https://takar-gach-a1d84-default-rtdb.firebaseio.com", projectId: "takar-gach-a1d84", storageBucket: "takar-gach-a1d84.firebasestorage.app", messagingSenderId: "637802367074", appId: "1:637802367074:web:2e7f6c0670ec47f3a1693b", measurementId: "G-0QL9LB7BSK" };
        
        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
        } catch(e) {
            alert("‚ö†Ô∏è Internet Error or Firebase Issue! Please reload.");
        }

        // 1. LOGIN SYSTEM (FIXED)
        function doLogin() {
            var u = document.getElementById('l-user').value.trim();
            var p = document.getElementById('l-pass').value.trim();
            
            if(u === 'JIHAD' && p === '198373ZA') {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                initData();
            } else {
                alert("‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°!\n\nUsername: JIHAD (‡¶¨‡ßú ‡¶π‡¶æ‡¶§‡ßá‡¶∞)\nPassword: 198373ZA");
                document.getElementById('msg').innerText = "WRONG CREDENTIALS!";
            }
        }

        // NAV LOGIC
        function nav(id, el) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }

        // 2. DATA LOAD
        function initData() {
            if(!db) return;

            // Stats & Requests
            db.ref('users').on('value', s => {
                const users = s.val() || {};
                document.getElementById('st-users').innerText = Object.keys(users).length;
                
                let pending = 0;
                const tbody = document.querySelector('#req-table tbody');
                tbody.innerHTML = '';

                Object.keys(users).forEach(uid => {
                    const u = users[uid];
                    if(u.history) {
                        Object.keys(u.history).forEach(k => {
                            const h = u.history[k];
                            if(h.status === 'Pending') {
                                pending++;
                                const isBuy = h.type.includes('Buy');
                                tbody.innerHTML += `
                                <tr>
                                    <td>${u.name}<br><small style="color:#64748b">${u.phone}</small></td>
                                    <td><span style="color:${isBuy?'var(--accent)':'var(--primary)'}">${h.type}</span><br><small>${h.method||'Trx'}</small></td>
                                    <td style="font-weight:bold;">${h.amount}</td>
                                    <td>
                                        <button class="status-btn bg-green" onclick="setStatus('${uid}','${k}','Success','${h.type}')">‚úî</button>
                                        <button class="status-btn bg-red" onclick="setStatus('${uid}','${k}','Rejected','${h.type}')">‚úò</button>
                                    </td>
                                </tr>`;
                            }
                        });
                    }
                });
                document.getElementById('st-pending').innerText = pending;
            });

            // Tasks Load
            db.ref('settings/tasks').on('value', s => {
                const tasks = s.val() || {};
                const tbody = document.querySelector('#task-table tbody');
                tbody.innerHTML = '';
                Object.keys(tasks).forEach(key => {
                    const t = tasks[key];
                    tbody.innerHTML += `
                    <tr>
                        <td>${t.title}</td>
                        <td style="color:var(--primary)">${t.reward}</td>
                        <td><button class="status-btn bg-red" onclick="delTask('${key}')"><i class="fas fa-trash"></i></button></td>
                    </tr>`;
                });
            });
        }

        // 3. ACTIONS
        function updateNotice() {
            db.ref('settings/notice').set(document.getElementById('notice-txt').value);
            alert("Notice Updated!");
        }

        function addTask() {
            const title = document.getElementById('t-title').value;
            const reward = parseInt(document.getElementById('t-reward').value);
            const link = document.getElementById('t-link').value;
            const type = document.getElementById('t-type').value;
            
            if(!title || !reward || !link) return alert("Fill all!");
            
            let icon = type === 'youtube' ? 'youtube' : (type === 'telegram' ? 'telegram' : 'facebook');
            let color = type === 'youtube' ? 'red' : (type === 'telegram' ? '#229ED9' : 'blue');

            db.ref('settings/tasks').push({ title, reward, link, type, icon, color });
            alert("Task Added!");
            document.getElementById('t-title').value = '';
            document.getElementById('t-link').value = '';
        }

        function delTask(key) {
            if(confirm("Delete?")) db.ref('settings/tasks/'+key).remove();
        }

        function setStatus(uid, key, status, type) {
            if(!confirm(status + "?")) return;
            const updates = {};
            updates[`users/${uid}/history/${key}/status`] = status;
            if(status === 'Success' && type.includes('Buy')) {
                updates[`users/${uid}/isVip`] = true;
                updates[`users/${uid}/vipExpiry`] = Date.now() + (3*86400000);
            }
            db.ref().update(updates);
        }

        function searchUser() {
            const q = document.getElementById('search-user').value;
            const res = document.getElementById('user-result');
            res.innerHTML = '';
            if(q.length < 5) return;

            db.ref('users/'+q).once('value', s => {
                if(s.exists()) {
                    const u = s.val();
                    res.innerHTML = `
                    <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:10px; margin-top:10px;">
                        <h3 style="margin:0; color:var(--primary)">${u.name} <span style="font-size:10px; background:var(--accent); padding:2px 5px; border-radius:5px; color:black;">${u.isVip?'VIP':'Free'}</span></h3>
                        <p style="font-size:12px; color:var(--text-gray);">${u.phone}</p>
                        <p>Bal: <b style="font-size:18px;">${u.balance}</b></p>
                        <div style="margin-top:5px;">
                            <button class="status-btn bg-green" onclick="editBal('${q}', ${u.balance}, 'add')">+ Add</button>
                            <button class="status-btn bg-red" onclick="editBal('${q}', ${u.balance}, 'sub')">- Cut</button>
                        </div>
                    </div>`;
                } else {
                    res.innerHTML = '<p style="color:var(--text-gray)">No user found</p>';
                }
            });
        }

        function editBal(uid, oldBal, action) {
            const amt = prompt("Amount:");
            if(!amt) return;
            const newBal = action === 'add' ? oldBal + parseInt(amt) : oldBal - parseInt(amt);
            db.ref('users/'+uid).update({ balance: newBal });
            alert("Done!");
            searchUser();
        }
    </script>
</body>
</html>
